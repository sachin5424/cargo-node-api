"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _jsonwebtoken = _interopRequireDefault(require("jsonwebtoken"));

var _bcryptjs = _interopRequireDefault(require("bcryptjs"));

var _customer = _interopRequireDefault(require("../data-base/models/customer"));

var _customerLocation = _interopRequireDefault(require("../data-base/models/customerLocation"));

var _helper = require("../utls/_helper");

var _config = _interopRequireDefault(require("../utls/config"));

var _sendEmail = require("../thrirdParty/emailServices/customer/sendEmail");

var _EmailService = _interopRequireDefault(require("./EmailService"));

var _emailTemplate = _interopRequireDefault(require("../data-base/models/emailTemplate"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

class Service {
  static async customerLogin(data) {
    const response = {
      statusCode: 400,
      message: 'Error!',
      status: false
    };
    const email = data.email;
    const password = data.password;

    try {
      const owner = await _customer.default.findOne({
        email: email,
        isDeleted: false
      });
      let isPasswordMatched = await _bcryptjs.default.compare(password, owner.password);

      if (!isPasswordMatched) {
        throw new Error("Invalid Credentials");
      } else {
        const JWT_EXP_DUR = _config.default.jwt.expDuration;

        const accessToken = _jsonwebtoken.default.sign({
          sub: owner._id.toString(),
          exp: Math.floor(Date.now() / 1000) + JWT_EXP_DUR * 60
        }, _config.default.jwt.secretKey);

        if (!owner.emailVerified) {
          response.statusCode = 401;
          response.message = "Email is not verified. Please verify from the link sent to your email!!";
        } else if (!owner.isActive) {
          response.statusCode = 401;
          response.message = "Your acount is blocked. Please contact admin";
        } else {
          response.statusCode = 200;
          response.status = true;
          response.message = "Loggedin successfully";
          response.data = {
            accessToken
          };
        }
      }
    } catch (e) {
      throw new Error(e.message);
    }

    return response;
  }

  static async verifyEmail(email) {
    const response = {
      statusCode: 400,
      message: 'Error!',
      status: false
    };

    try {
      const owner = await _customer.default.findOne({
        email: email,
        isDeleted: false
      });

      if (owner) {
        if (owner.emailVerified) {
          response.message = "Email is already verified";
        } else {
          owner.emailVerified = true;
          await owner.save();
          response.message = "Email is verified";
        }

        response.statusCode = 200;
        response.status = true;
      } else {
        throw new Error("Invalid path");
      }
    } catch (e) {
      throw new Error(e.message);
    }

    return response;
  }

  static async genForgetPasswordUrl(email) {
    const response = {
      statusCode: 400,
      message: 'Error!',
      status: false
    };

    try {
      const tplData = await _customer.default.findOne({
        email: email,
        isDeleted: false
      });

      if (tplData) {
        try {
          const timeStamp = new Date().getTime() + _config.default.forgetPassExpTime * 60 * 1000;
          const encKey = (0, _helper.encryptData)((0, _helper.encryptData)(timeStamp + '-----' + email));
          const emailTemplate = await _emailTemplate.default.findOne({
            key: 'reset-password-customer'
          });
          const resetPasswordURL = _config.default.baseurls.resetPassword.customer + "/" + encKey; // data = { ...data, resetPasswordURL: resetPasswordURL };

          await _EmailService.default.sendEmail({
            emailIds: [email],
            state: tplData.state,
            district: tplData.district,
            taluk: tplData.taluk,
            emailTemplate: emailTemplate._id,
            to: 'manyCustomers',
            emailData: {
              key: encKey,
              validFor: _config.default.forgetPassExpTime,
              resetPasswordURL: resetPasswordURL
            }
          }); // await sendResetPasswordMail({ key: encKey, email: email, validFor: config.forgetPassExpTime });

          response.message = "A reset password link has been sent to your email. Please check and reset your password.";
          response.statusCode = 200;
          response.status = true;
        } catch (e) {
          throw new Error("Email can not be sent");
        }
      } else {
        throw new Error("This email is not registered with any account");
      }
    } catch (e) {
      throw new Error(e.message);
    }

    return response;
  }

  static async resetPAssword(key, data) {
    const response = {
      statusCode: 400,
      message: 'Error!',
      status: false
    };

    try {
      const decKey = (0, _helper.decryptData)((0, _helper.decryptData)(key));
      const timeStamp = decKey.split('-----')[0];
      const email = decKey.split('-----')[1];
      const cTimeStamp = new Date().getTime();
      const tplData = await _customer.default.findOne({
        email,
        isDeleted: false
      });

      if (timeStamp >= cTimeStamp) {
        if (tplData) {
          tplData.password = data.password;
          await tplData.save();
          response.message = "Password is updated. Try login aganin";
          response.statusCode = 200;
          response.status = true;
        }
      } else {
        response.message = "Time expired";
      }

      return response;
    } catch (e) {
      throw new Error(e);
    }
  }

  static async listCustomer(query, params) {
    const isAll = params.isAll === 'ALL';
    const response = {
      statusCode: 400,
      message: 'Data not found!',
      result: {
        data: [],
        page: query.page * 1 > 0 ? query.page * 1 : 1,
        limit: query.limit * 1 > 0 ? query.limit * 1 : 20,
        total: 0
      },
      isActive: query?.isActive ? query.isActive ? true : false : ''
    };

    try {
      const search = _objectSpread({
        _id: query._id,
        isDeleted: false,
        $or: [{
          firstName: {
            $regex: '.*' + (query?.key || '') + '.*'
          }
        }, {
          lastName: {
            $regex: '.*' + (query?.key || '') + '.*'
          }
        }]
      }, (0, _helper.getAdminFilter)());

      (0, _helper.clearSearch)(search);
      const $aggregate = [{
        $match: search
      }, {
        $sort: {
          _id: -1
        }
      }, {
        "$project": {
          firstName: 1,
          lastName: 1,
          phoneNo: 1,
          email: 1,
          dob: 1,
          address: 1,
          state: 1,
          district: 1,
          taluk: 1,
          zipcode: 1,
          isActive: 1,
          image: {
            url: {
              $concat: [_config.default.applicationFileUrl + 'customer/photo/', "$photo"]
            },
            name: "$photo"
          }
        }
      }];
      const counter = await _customer.default.aggregate([...$aggregate, {
        $count: "total"
      }]);
      response.result.total = counter[0]?.total;

      if (isAll) {
        response.result.page = 1;
        response.result.limit = response.result.total;
      }

      response.result.total = counter[0]?.total;

      if (isAll) {
        response.result.page = 1;
        response.result.limit = response.result.total;
      }

      response.result.data = await _customer.default.aggregate([...$aggregate, {
        $limit: response.result.limit + response.result.limit * (response.result.page - 1)
      }, {
        $skip: response.result.limit * (response.result.page - 1)
      }]);

      if (response.result.data.length) {
        response.message = "Data fetched";
      }

      response.statusCode = 200;
      response.status = true;
      return response;
    } catch (e) {
      throw new Error(e);
    }
  }

  static async saveCustomer(data) {
    const _id = data._id;
    const response = {
      statusCode: 400,
      message: 'Error!',
      status: false
    };

    try {
      const tplData = _id ? await _customer.default.findById(_id) : new _customer.default();
      tplData.firstName = data.firstName;
      tplData.lastName = data.lastName;
      tplData.phoneNo = data.phoneNo;
      tplData.email = data.email;
      !data.password || (tplData.password = data.password);
      tplData.dob = data.dob;
      tplData.photo = await (0, _helper.uploadFile)(data.photo, _config.default.uploadPaths.customer.photo, _customer.default, 'photo', _id);
      tplData.address = data.address;
      tplData.state = data.state;
      tplData.district = data.district;
      tplData.taluk = data.taluk;
      tplData.zipcode = data.zipcode;
      tplData.isActive = data.isActive;
      await tplData.save();
      response.message = _id ? "Customer is Updated" : "A new customer is created";
      response.statusCode = 200;
      response.status = true;
      return response;
    } catch (e) {
      throw new Error(e);
    }
  }

  static async deleteCustomer(_id, cond) {
    (0, _helper.clearSearch)({
      cond
    });
    const response = {
      statusCode: 400,
      message: 'Error!',
      status: false
    };

    try {
      await _customer.default.updateOne(_objectSpread({
        _id
      }, cond), {
        isDeleted: true
      });
      response.message = "Deleted successfully";
      response.statusCode = 200;
      response.status = true;
      return response;
    } catch (e) {
      throw new Error("Can not delete. Something went wrong.");
    }
  }

  static async deleteCustomerPermanent(cond) {
    await _customer.default.deleteOne(_objectSpread({}, cond));
  }

  static async listLocation(query, customer) {
    const response = {
      statusCode: 400,
      message: 'Data not found!',
      data: {
        docs: [],
        page: query.page * 1 > 0 ? query.page * 1 : 1,
        limit: query.limit * 1 > 0 ? query.limit * 1 : 20,
        totalDocs: 0
      },
      status: false
    };

    try {
      const search = {
        _id: query._id,
        isDeleted: false,
        customer
      };
      (0, _helper.clearSearch)(search);
      response.data.docs = await _customerLocation.default.find(search).select('  -__v').limit(response.data.limit).skip(response.data.limit * (response.data.page - 1)).then(async function (data) {
        await _customerLocation.default.count(search).then(count => {
          response.data.totalDocs = count;
        }).catch(err => {
          response.data.totalDocs = 0;
        });
        return data;
      }).catch(err => {
        throw new Error(err.message);
      });

      if (response.data.docs.length) {
        response.message = "Data fetched";
      }

      response.statusCode = 200;
      response.status = true;
      return response;
    } catch (e) {
      throw new Error(e);
    }
  }

  static async saveLocation(data) {
    const _id = data._id;
    const response = {
      statusCode: 400,
      message: 'Error!',
      status: false
    };

    try {
      const tplData = _id ? await _customerLocation.default.findById(_id) : new _customerLocation.default();
      tplData.customer = data.customer;
      tplData.name = data.name;
      tplData.latlong = data.latlong;
      await tplData.save();
      response.message = _id ? "Location is Updated" : "A new location is added";
      response.statusCode = 200;
      response.status = true;
      return response;
    } catch (e) {
      throw new Error(e);
    }
  }

  static async deleteLocation(_id, cond) {
    cond = !cond ? {} : cond;
    const response = {
      statusCode: 400,
      message: 'Error!',
      status: false
    };

    try {
      await _customerLocation.default.updateOne(_objectSpread({
        _id
      }, cond), {
        isDeleted: true
      });
      response.message = "Deleted successfully";
      response.statusCode = 200;
      response.status = true;
      return response;
    } catch (e) {
      throw new Error("Can not delete. Something went wrong.");
    }
  }

}

exports.default = Service;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXJ2aWNlcy9DdXN0b21lclNlcnZpY2UuanMiXSwibmFtZXMiOlsiU2VydmljZSIsImN1c3RvbWVyTG9naW4iLCJkYXRhIiwicmVzcG9uc2UiLCJzdGF0dXNDb2RlIiwibWVzc2FnZSIsInN0YXR1cyIsImVtYWlsIiwicGFzc3dvcmQiLCJvd25lciIsIkN1c3RvbWVyTW9kZWwiLCJmaW5kT25lIiwiaXNEZWxldGVkIiwiaXNQYXNzd29yZE1hdGNoZWQiLCJiY3J5cHQiLCJjb21wYXJlIiwiRXJyb3IiLCJKV1RfRVhQX0RVUiIsImNvbmZpZyIsImp3dCIsImV4cER1cmF0aW9uIiwiYWNjZXNzVG9rZW4iLCJzaWduIiwic3ViIiwiX2lkIiwidG9TdHJpbmciLCJleHAiLCJNYXRoIiwiZmxvb3IiLCJEYXRlIiwibm93Iiwic2VjcmV0S2V5IiwiZW1haWxWZXJpZmllZCIsImlzQWN0aXZlIiwiZSIsInZlcmlmeUVtYWlsIiwic2F2ZSIsImdlbkZvcmdldFBhc3N3b3JkVXJsIiwidHBsRGF0YSIsInRpbWVTdGFtcCIsImdldFRpbWUiLCJmb3JnZXRQYXNzRXhwVGltZSIsImVuY0tleSIsImVtYWlsVGVtcGxhdGUiLCJFbWFpbFRlbXBsYXRlTW9kZWwiLCJrZXkiLCJyZXNldFBhc3N3b3JkVVJMIiwiYmFzZXVybHMiLCJyZXNldFBhc3N3b3JkIiwiY3VzdG9tZXIiLCJFbWFpbFNlcnZpY2VzIiwic2VuZEVtYWlsIiwiZW1haWxJZHMiLCJzdGF0ZSIsImRpc3RyaWN0IiwidGFsdWsiLCJ0byIsImVtYWlsRGF0YSIsInZhbGlkRm9yIiwicmVzZXRQQXNzd29yZCIsImRlY0tleSIsInNwbGl0IiwiY1RpbWVTdGFtcCIsImxpc3RDdXN0b21lciIsInF1ZXJ5IiwicGFyYW1zIiwiaXNBbGwiLCJyZXN1bHQiLCJwYWdlIiwibGltaXQiLCJ0b3RhbCIsInNlYXJjaCIsIiRvciIsImZpcnN0TmFtZSIsIiRyZWdleCIsImxhc3ROYW1lIiwiJGFnZ3JlZ2F0ZSIsIiRtYXRjaCIsIiRzb3J0IiwicGhvbmVObyIsImRvYiIsImFkZHJlc3MiLCJ6aXBjb2RlIiwiaW1hZ2UiLCJ1cmwiLCIkY29uY2F0IiwiYXBwbGljYXRpb25GaWxlVXJsIiwibmFtZSIsImNvdW50ZXIiLCJhZ2dyZWdhdGUiLCIkY291bnQiLCIkbGltaXQiLCIkc2tpcCIsImxlbmd0aCIsInNhdmVDdXN0b21lciIsImZpbmRCeUlkIiwicGhvdG8iLCJ1cGxvYWRQYXRocyIsImRlbGV0ZUN1c3RvbWVyIiwiY29uZCIsInVwZGF0ZU9uZSIsImRlbGV0ZUN1c3RvbWVyUGVybWFuZW50IiwiZGVsZXRlT25lIiwibGlzdExvY2F0aW9uIiwiZG9jcyIsInRvdGFsRG9jcyIsIkN1c3RvbWVyTG9jYXRpb25Nb2RlbCIsImZpbmQiLCJzZWxlY3QiLCJza2lwIiwidGhlbiIsImNvdW50IiwiY2F0Y2giLCJlcnIiLCJzYXZlTG9jYXRpb24iLCJsYXRsb25nIiwiZGVsZXRlTG9jYXRpb24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7OztBQUVlLE1BQU1BLE9BQU4sQ0FBYztBQUVDLGVBQWJDLGFBQWEsQ0FBQ0MsSUFBRCxFQUFPO0FBQzdCLFVBQU1DLFFBQVEsR0FBRztBQUFFQyxNQUFBQSxVQUFVLEVBQUUsR0FBZDtBQUFtQkMsTUFBQUEsT0FBTyxFQUFFLFFBQTVCO0FBQXNDQyxNQUFBQSxNQUFNLEVBQUU7QUFBOUMsS0FBakI7QUFDQSxVQUFNQyxLQUFLLEdBQUdMLElBQUksQ0FBQ0ssS0FBbkI7QUFDQSxVQUFNQyxRQUFRLEdBQUdOLElBQUksQ0FBQ00sUUFBdEI7O0FBRUEsUUFBSTtBQUNBLFlBQU1DLEtBQUssR0FBRyxNQUFNQyxrQkFBY0MsT0FBZCxDQUFzQjtBQUFFSixRQUFBQSxLQUFLLEVBQUVBLEtBQVQ7QUFBZ0JLLFFBQUFBLFNBQVMsRUFBRTtBQUEzQixPQUF0QixDQUFwQjtBQUNBLFVBQUlD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UUFBUSxDQUFDRSxPQUFULEdBQW1CLHNCQUFuQjtBQUNBRixNQUFBQSxRQUFRLENBQUNDLFVBQVQsR0FBc0IsR0FBdEI7QUFDQUQsTUFBQUEsUUFBUSxDQUFDRyxNQUFULEdBQWtCLElBQWxCO0FBQ0EsYUFBT0gsUUFBUDtBQUVILEtBUkQsQ0FRRSxPQUFPK0IsQ0FBUCxFQUFVO0FBQ1IsWUFBTSxJQUFJbEIsS0FBSixDQUFVLHVDQUFWLENBQU47QUFDSDtBQUNKOztBQS9Wd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgand0IGZyb20gXCJqc29ud2VidG9rZW5cIjtcclxuaW1wb3J0IGJjcnlwdCBmcm9tIFwiYmNyeXB0anNcIjtcclxuaW1wb3J0IEN1c3RvbWVyTW9kZWwgZnJvbSBcIi4uL2RhdGEtYmFzZS9tb2RlbHMvY3VzdG9tZXJcIjtcclxuaW1wb3J0IEN1c3RvbWVyTG9jYXRpb25Nb2RlbCBmcm9tIFwiLi4vZGF0YS1iYXNlL21vZGVscy9jdXN0b21lckxvY2F0aW9uXCI7XHJcbmltcG9ydCB7IGNsZWFyU2VhcmNoLCBnZXRBZG1pbkZpbHRlciwgZW5jcnlwdERhdGEsIGRlY3J5cHREYXRhIH0gZnJvbSBcIi4uL3V0bHMvX2hlbHBlclwiO1xyXG5pbXBvcnQgeyB1cGxvYWRGaWxlIH0gZnJvbSBcIi4uL3V0bHMvX2hlbHBlclwiO1xyXG5pbXBvcnQgY29uZmlnIGZyb20gXCIuLi91dGxzL2NvbmZpZ1wiO1xyXG5pbXBvcnQgeyBzZW5kUmVzZXRQYXNzd29yZE1haWwgfSBmcm9tIFwiLi4vdGhyaXJkUGFydHkvZW1haWxTZXJ2aWNlcy9jdXN0b21lci9zZW5kRW1haWxcIjtcclxuaW1wb3J0IEVtYWlsU2VydmljZXMgZnJvbSBcIi4vRW1haWxTZXJ2aWNlXCI7XHJcbmltcG9ydCBFbWFpbFRlbXBsYXRlTW9kZWwgZnJvbSAnLi4vZGF0YS1iYXNlL21vZGVscy9lbWFpbFRlbXBsYXRlJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlcnZpY2Uge1xyXG5cclxuICAgIHN0YXRpYyBhc3luYyBjdXN0b21lckxvZ2luKGRhdGEpIHtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IHsgc3RhdHVzQ29kZTogNDAwLCBtZXNzYWdlOiAnRXJyb3IhJywgc3RhdHVzOiBmYWxzZSB9O1xyXG4gICAgICAgIGNvbnN0IGVtYWlsID0gZGF0YS5lbWFpbDtcclxuICAgICAgICBjb25zdCBwYXNzd29yZCA9IGRhdGEucGFzc3dvcmQ7XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG93bmVyID0gYXdhaXQgQ3VzdG9tZXJNb2RlbC5maW5kT25lKHsgZW1haWw6IGVtYWlsLCBpc0RlbGV0ZWQ6IGZhbHNlIH0pO1xyXG4gICAgICAgICAgICBsZXQgaXNQYXNzd29yZE1hdGNoZWQgPSBhd2FpdCBiY3J5cHQuY29tcGFyZShwYXNzd29yZCwgb3duZXIucGFzc3dvcmQpO1xyXG4gICAgICAgICAgICBpZiAoIWlzUGFzc3dvcmRNYXRjaGVkKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIENyZWRlbnRpYWxzXCIpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgSldUX0VYUF9EVVIgPSBjb25maWcuand0LmV4cER1cmF0aW9uO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSBqd3Quc2lnbih7IHN1Yjogb3duZXIuX2lkLnRvU3RyaW5nKCksIGV4cDogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCkgKyAoKEpXVF9FWFBfRFVSKSAqIDYwKSwgfSwgY29uZmlnLmp3dC5zZWNyZXRLZXkpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghb3duZXIuZW1haWxWZXJpZmllZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c0NvZGUgPSA0MDE7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UubWVzc2FnZSA9IFwiRW1haWwgaXMgbm90IHZlcmlmaWVkLiBQbGVhc2UgdmVyaWZ5IGZyb20gdGhlIGxpbmsgc2VudCB0byB5b3VyIGVtYWlsISFcIjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIW93bmVyLmlzQWN0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzQ29kZSA9IDQwMTtcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5tZXNzYWdlID0gXCJZb3VyIGFjb3VudCBpcyBibG9ja2VkLiBQbGVhc2UgY29udGFjdCBhZG1pblwiO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5zdGF0dXNDb2RlID0gMjAwO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UubWVzc2FnZSA9IFwiTG9nZ2VkaW4gc3VjY2Vzc2Z1bGx5XCI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEgPSB7IGFjY2Vzc1Rva2VuIH07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlLm1lc3NhZ2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBzdGF0aWMgYXN5bmMgdmVyaWZ5RW1haWwoZW1haWwpIHtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IHsgc3RhdHVzQ29kZTogNDAwLCBtZXNzYWdlOiAnRXJyb3IhJywgc3RhdHVzOiBmYWxzZSB9O1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBvd25lciA9IGF3YWl0IEN1c3RvbWVyTW9kZWwuZmluZE9uZSh7IGVtYWlsOiBlbWFpbCwgaXNEZWxldGVkOiBmYWxzZSB9KTtcclxuICAgICAgICAgICAgaWYgKG93bmVyKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob3duZXIuZW1haWxWZXJpZmllZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLm1lc3NhZ2UgPSBcIkVtYWlsIGlzIGFscmVhZHkgdmVyaWZpZWRcIjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3duZXIuZW1haWxWZXJpZmllZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgb3duZXIuc2F2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLm1lc3NhZ2UgPSBcIkVtYWlsIGlzIHZlcmlmaWVkXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXNwb25zZS5zdGF0dXNDb2RlID0gMjAwO1xyXG4gICAgICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzID0gdHJ1ZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgcGF0aFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGUubWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGFzeW5jIGdlbkZvcmdldFBhc3N3b3JkVXJsKGVtYWlsKSB7XHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB7IHN0YXR1c0NvZGU6IDQwMCwgbWVzc2FnZTogJ0Vycm9yIScsIHN0YXR1czogZmFsc2UgfTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCB0cGxEYXRhID0gYXdhaXQgQ3VzdG9tZXJNb2RlbC5maW5kT25lKHsgZW1haWw6IGVtYWlsLCBpc0RlbGV0ZWQ6IGZhbHNlIH0pO1xyXG4gICAgICAgICAgICBpZiAodHBsRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0aW1lU3RhbXAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIGNvbmZpZy5mb3JnZXRQYXNzRXhwVGltZSAqIDYwICogMTAwMDtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBlbmNLZXkgPSBlbmNyeXB0RGF0YShlbmNyeXB0RGF0YSh0aW1lU3RhbXAgKyAnLS0tLS0nICsgZW1haWwpKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBlbWFpbFRlbXBsYXRlID0gYXdhaXQgRW1haWxUZW1wbGF0ZU1vZGVsLmZpbmRPbmUoeyBrZXk6ICdyZXNldC1wYXNzd29yZC1jdXN0b21lcicgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzZXRQYXNzd29yZFVSTCA9IGNvbmZpZy5iYXNldXJscy5yZXNldFBhc3N3b3JkLmN1c3RvbWVyICsgXCIvXCIgKyBlbmNLZXk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZGF0YSA9IHsgLi4uZGF0YSwgcmVzZXRQYXNzd29yZFVSTDogcmVzZXRQYXNzd29yZFVSTCB9O1xyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IEVtYWlsU2VydmljZXMuc2VuZEVtYWlsKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW1haWxJZHM6IFtlbWFpbF0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlOiB0cGxEYXRhLnN0YXRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXN0cmljdDogdHBsRGF0YS5kaXN0cmljdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGFsdWs6IHRwbERhdGEudGFsdWssXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsVGVtcGxhdGU6IGVtYWlsVGVtcGxhdGUuX2lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0bzogJ21hbnlDdXN0b21lcnMnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbWFpbERhdGE6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleTogZW5jS2V5LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRGb3I6IGNvbmZpZy5mb3JnZXRQYXNzRXhwVGltZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2V0UGFzc3dvcmRVUkw6IHJlc2V0UGFzc3dvcmRVUkxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYXdhaXQgc2VuZFJlc2V0UGFzc3dvcmRNYWlsKHsga2V5OiBlbmNLZXksIGVtYWlsOiBlbWFpbCwgdmFsaWRGb3I6IGNvbmZpZy5mb3JnZXRQYXNzRXhwVGltZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5tZXNzYWdlID0gXCJBIHJlc2V0IHBhc3N3b3JkIGxpbmsgaGFzIGJlZW4gc2VudCB0byB5b3VyIGVtYWlsLiBQbGVhc2UgY2hlY2sgYW5kIHJlc2V0IHlvdXIgcGFzc3dvcmQuXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzQ29kZSA9IDIwMDtcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5zdGF0dXMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkVtYWlsIGNhbiBub3QgYmUgc2VudFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGlzIGVtYWlsIGlzIG5vdCByZWdpc3RlcmVkIHdpdGggYW55IGFjY291bnRcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlLm1lc3NhZ2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGFzeW5jIHJlc2V0UEFzc3dvcmQoa2V5LCBkYXRhKSB7XHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB7IHN0YXR1c0NvZGU6IDQwMCwgbWVzc2FnZTogJ0Vycm9yIScsIHN0YXR1czogZmFsc2UgfTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBkZWNLZXkgPSBkZWNyeXB0RGF0YShkZWNyeXB0RGF0YShrZXkpKTtcclxuICAgICAgICAgICAgY29uc3QgdGltZVN0YW1wID0gZGVjS2V5LnNwbGl0KCctLS0tLScpWzBdO1xyXG4gICAgICAgICAgICBjb25zdCBlbWFpbCA9IGRlY0tleS5zcGxpdCgnLS0tLS0nKVsxXTtcclxuICAgICAgICAgICAgY29uc3QgY1RpbWVTdGFtcCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgdHBsRGF0YSA9IGF3YWl0IEN1c3RvbWVyTW9kZWwuZmluZE9uZSh7IGVtYWlsLCBpc0RlbGV0ZWQ6IGZhbHNlIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRpbWVTdGFtcCA+PSBjVGltZVN0YW1wKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHBsRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRwbERhdGEucGFzc3dvcmQgPSBkYXRhLnBhc3N3b3JkO1xyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRwbERhdGEuc2F2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLm1lc3NhZ2UgPSBcIlBhc3N3b3JkIGlzIHVwZGF0ZWQuIFRyeSBsb2dpbiBhZ2FuaW5cIjtcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5zdGF0dXNDb2RlID0gMjAwO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXNwb25zZS5tZXNzYWdlID0gXCJUaW1lIGV4cGlyZWRcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZSlcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGFzeW5jIGxpc3RDdXN0b21lcihxdWVyeSwgcGFyYW1zKSB7XHJcbiAgICAgICAgY29uc3QgaXNBbGwgPSBwYXJhbXMuaXNBbGwgPT09ICdBTEwnO1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0ge1xyXG4gICAgICAgICAgICBzdGF0dXNDb2RlOiA0MDAsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdEYXRhIG5vdCBmb3VuZCEnLFxyXG4gICAgICAgICAgICByZXN1bHQ6IHtcclxuICAgICAgICAgICAgICAgIGRhdGE6IFtdLFxyXG4gICAgICAgICAgICAgICAgcGFnZTogcXVlcnkucGFnZSAqIDEgPiAwID8gcXVlcnkucGFnZSAqIDEgOiAxLFxyXG4gICAgICAgICAgICAgICAgbGltaXQ6IHF1ZXJ5LmxpbWl0ICogMSA+IDAgPyBxdWVyeS5saW1pdCAqIDEgOiAyMCxcclxuICAgICAgICAgICAgICAgIHRvdGFsOiAwLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBpc0FjdGl2ZTogKHF1ZXJ5Py5pc0FjdGl2ZSA/IHF1ZXJ5LmlzQWN0aXZlID8gdHJ1ZSA6IGZhbHNlIDogJycpXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3Qgc2VhcmNoID0ge1xyXG4gICAgICAgICAgICAgICAgX2lkOiBxdWVyeS5faWQsXHJcbiAgICAgICAgICAgICAgICBpc0RlbGV0ZWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgJG9yOiBbXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IHsgJHJlZ2V4OiAnLionICsgKHF1ZXJ5Py5rZXkgfHwgJycpICsgJy4qJyB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3ROYW1lOiB7ICRyZWdleDogJy4qJyArIChxdWVyeT8ua2V5IHx8ICcnKSArICcuKicgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICAgICAgLi4uZ2V0QWRtaW5GaWx0ZXIoKVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgY2xlYXJTZWFyY2goc2VhcmNoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0ICRhZ2dyZWdhdGUgPSBbXHJcbiAgICAgICAgICAgICAgICB7ICRtYXRjaDogc2VhcmNoIH0sXHJcbiAgICAgICAgICAgICAgICB7ICRzb3J0OiB7IF9pZDogLTEgfSB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFwiJHByb2plY3RcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3ROYW1lOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwaG9uZU5vOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZG9iOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZTogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzdHJpY3Q6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhbHVrOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB6aXBjb2RlOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0FjdGl2ZTogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogeyAkY29uY2F0OiBbY29uZmlnLmFwcGxpY2F0aW9uRmlsZVVybCArICdjdXN0b21lci9waG90by8nLCBcIiRwaG90b1wiXSB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCIkcGhvdG9cIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgXTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGNvdW50ZXIgPSBhd2FpdCBDdXN0b21lck1vZGVsLmFnZ3JlZ2F0ZShbLi4uJGFnZ3JlZ2F0ZSwgeyAkY291bnQ6IFwidG90YWxcIiB9XSk7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnJlc3VsdC50b3RhbCA9IGNvdW50ZXJbMF0/LnRvdGFsO1xyXG4gICAgICAgICAgICBpZiAoaXNBbGwpIHtcclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLnJlc3VsdC5wYWdlID0gMTtcclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLnJlc3VsdC5saW1pdCA9IHJlc3BvbnNlLnJlc3VsdC50b3RhbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXNwb25zZS5yZXN1bHQudG90YWwgPSBjb3VudGVyWzBdPy50b3RhbDtcclxuICAgICAgICAgICAgaWYgKGlzQWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXNwb25zZS5yZXN1bHQucGFnZSA9IDE7XHJcbiAgICAgICAgICAgICAgICByZXNwb25zZS5yZXN1bHQubGltaXQgPSByZXNwb25zZS5yZXN1bHQudG90YWw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnJlc3VsdC5kYXRhID0gYXdhaXQgQ3VzdG9tZXJNb2RlbC5hZ2dyZWdhdGUoXHJcbiAgICAgICAgICAgICAgICBbXHJcbiAgICAgICAgICAgICAgICAgICAgLi4uJGFnZ3JlZ2F0ZSxcclxuICAgICAgICAgICAgICAgICAgICB7ICRsaW1pdDogcmVzcG9uc2UucmVzdWx0LmxpbWl0ICsgcmVzcG9uc2UucmVzdWx0LmxpbWl0ICogKHJlc3BvbnNlLnJlc3VsdC5wYWdlIC0gMSkgfSxcclxuICAgICAgICAgICAgICAgICAgICB7ICRza2lwOiByZXNwb25zZS5yZXN1bHQubGltaXQgKiAocmVzcG9uc2UucmVzdWx0LnBhZ2UgLSAxKSB9XHJcbiAgICAgICAgICAgICAgICBdKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5yZXN1bHQuZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLm1lc3NhZ2UgPSBcIkRhdGEgZmV0Y2hlZFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c0NvZGUgPSAyMDA7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcblxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgYXN5bmMgc2F2ZUN1c3RvbWVyKGRhdGEpIHtcclxuICAgICAgICBjb25zdCBfaWQgPSBkYXRhLl9pZDtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IHsgc3RhdHVzQ29kZTogNDAwLCBtZXNzYWdlOiAnRXJyb3IhJywgc3RhdHVzOiBmYWxzZSB9O1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCB0cGxEYXRhID0gX2lkID8gYXdhaXQgQ3VzdG9tZXJNb2RlbC5maW5kQnlJZChfaWQpIDogbmV3IEN1c3RvbWVyTW9kZWwoKTtcclxuXHJcbiAgICAgICAgICAgIHRwbERhdGEuZmlyc3ROYW1lID0gZGF0YS5maXJzdE5hbWU7XHJcbiAgICAgICAgICAgIHRwbERhdGEubGFzdE5hbWUgPSBkYXRhLmxhc3ROYW1lO1xyXG4gICAgICAgICAgICB0cGxEYXRhLnBob25lTm8gPSBkYXRhLnBob25lTm87XHJcbiAgICAgICAgICAgIHRwbERhdGEuZW1haWwgPSBkYXRhLmVtYWlsO1xyXG4gICAgICAgICAgICAoIWRhdGEucGFzc3dvcmQgfHwgKHRwbERhdGEucGFzc3dvcmQgPSBkYXRhLnBhc3N3b3JkKSk7XHJcbiAgICAgICAgICAgIHRwbERhdGEuZG9iID0gZGF0YS5kb2I7XHJcbiAgICAgICAgICAgIHRwbERhdGEucGhvdG8gPSBhd2FpdCB1cGxvYWRGaWxlKGRhdGEucGhvdG8sIGNvbmZpZy51cGxvYWRQYXRocy5jdXN0b21lci5waG90bywgQ3VzdG9tZXJNb2RlbCwgJ3Bob3RvJywgX2lkKTtcclxuICAgICAgICAgICAgdHBsRGF0YS5hZGRyZXNzID0gZGF0YS5hZGRyZXNzO1xyXG4gICAgICAgICAgICB0cGxEYXRhLnN0YXRlID0gZGF0YS5zdGF0ZTtcclxuICAgICAgICAgICAgdHBsRGF0YS5kaXN0cmljdCA9IGRhdGEuZGlzdHJpY3Q7XHJcbiAgICAgICAgICAgIHRwbERhdGEudGFsdWsgPSBkYXRhLnRhbHVrO1xyXG4gICAgICAgICAgICB0cGxEYXRhLnppcGNvZGUgPSBkYXRhLnppcGNvZGU7XHJcbiAgICAgICAgICAgIHRwbERhdGEuaXNBY3RpdmUgPSBkYXRhLmlzQWN0aXZlO1xyXG5cclxuICAgICAgICAgICAgYXdhaXQgdHBsRGF0YS5zYXZlKCk7XHJcblxyXG4gICAgICAgICAgICByZXNwb25zZS5tZXNzYWdlID0gX2lkID8gXCJDdXN0b21lciBpcyBVcGRhdGVkXCIgOiBcIkEgbmV3IGN1c3RvbWVyIGlzIGNyZWF0ZWRcIjtcclxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzQ29kZSA9IDIwMDtcclxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcclxuXHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZSlcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgYXN5bmMgZGVsZXRlQ3VzdG9tZXIoX2lkLCBjb25kKSB7XHJcbiAgICAgICAgY2xlYXJTZWFyY2goeyBjb25kIH0pO1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geyBzdGF0dXNDb2RlOiA0MDAsIG1lc3NhZ2U6ICdFcnJvciEnLCBzdGF0dXM6IGZhbHNlIH07XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGF3YWl0IEN1c3RvbWVyTW9kZWwudXBkYXRlT25lKHsgX2lkLCAuLi5jb25kIH0sIHsgaXNEZWxldGVkOiB0cnVlIH0pO1xyXG5cclxuICAgICAgICAgICAgcmVzcG9uc2UubWVzc2FnZSA9IFwiRGVsZXRlZCBzdWNjZXNzZnVsbHlcIjtcclxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzQ29kZSA9IDIwMDtcclxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG5cclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbiBub3QgZGVsZXRlLiBTb21ldGhpbmcgd2VudCB3cm9uZy5cIilcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgYXN5bmMgZGVsZXRlQ3VzdG9tZXJQZXJtYW5lbnQoY29uZCkge1xyXG4gICAgICAgIGF3YWl0IEN1c3RvbWVyTW9kZWwuZGVsZXRlT25lKHsgLi4uY29uZCB9KTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgc3RhdGljIGFzeW5jIGxpc3RMb2NhdGlvbihxdWVyeSwgY3VzdG9tZXIpIHtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IHtcclxuICAgICAgICAgICAgc3RhdHVzQ29kZTogNDAwLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnRGF0YSBub3QgZm91bmQhJyxcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgZG9jczogW10sXHJcbiAgICAgICAgICAgICAgICBwYWdlOiBxdWVyeS5wYWdlICogMSA+IDAgPyBxdWVyeS5wYWdlICogMSA6IDEsXHJcbiAgICAgICAgICAgICAgICBsaW1pdDogcXVlcnkubGltaXQgKiAxID4gMCA/IHF1ZXJ5LmxpbWl0ICogMSA6IDIwLFxyXG4gICAgICAgICAgICAgICAgdG90YWxEb2NzOiAwLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzdGF0dXM6IGZhbHNlXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3Qgc2VhcmNoID0geyBfaWQ6IHF1ZXJ5Ll9pZCwgaXNEZWxldGVkOiBmYWxzZSwgY3VzdG9tZXIgfTtcclxuICAgICAgICAgICAgY2xlYXJTZWFyY2goc2VhcmNoKTtcclxuXHJcbiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZG9jcyA9IGF3YWl0IEN1c3RvbWVyTG9jYXRpb25Nb2RlbC5maW5kKHNlYXJjaClcclxuICAgICAgICAgICAgICAgIC5zZWxlY3QoJyAgLV9fdicpXHJcbiAgICAgICAgICAgICAgICAubGltaXQocmVzcG9uc2UuZGF0YS5saW1pdClcclxuICAgICAgICAgICAgICAgIC5za2lwKHJlc3BvbnNlLmRhdGEubGltaXQgKiAocmVzcG9uc2UuZGF0YS5wYWdlIC0gMSkpXHJcbiAgICAgICAgICAgICAgICAudGhlbihhc3luYyBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IEN1c3RvbWVyTG9jYXRpb25Nb2RlbC5jb3VudChzZWFyY2gpLnRoZW4oY291bnQgPT4geyByZXNwb25zZS5kYXRhLnRvdGFsRG9jcyA9IGNvdW50IH0pLmNhdGNoKGVyciA9PiB7IHJlc3BvbnNlLmRhdGEudG90YWxEb2NzID0gMCB9KVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChlcnIgPT4geyB0aHJvdyBuZXcgRXJyb3IoZXJyLm1lc3NhZ2UpIH0pXHJcblxyXG4gICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5kb2NzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgcmVzcG9uc2UubWVzc2FnZSA9IFwiRGF0YSBmZXRjaGVkXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzQ29kZSA9IDIwMDtcclxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcclxuXHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZSlcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGFzeW5jIHNhdmVMb2NhdGlvbihkYXRhKSB7XHJcbiAgICAgICAgY29uc3QgX2lkID0gZGF0YS5faWQ7XHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB7IHN0YXR1c0NvZGU6IDQwMCwgbWVzc2FnZTogJ0Vycm9yIScsIHN0YXR1czogZmFsc2UgfTtcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgdHBsRGF0YSA9IF9pZCA/IGF3YWl0IEN1c3RvbWVyTG9jYXRpb25Nb2RlbC5maW5kQnlJZChfaWQpIDogbmV3IEN1c3RvbWVyTG9jYXRpb25Nb2RlbCgpO1xyXG5cclxuICAgICAgICAgICAgdHBsRGF0YS5jdXN0b21lciA9IGRhdGEuY3VzdG9tZXI7XHJcbiAgICAgICAgICAgIHRwbERhdGEubmFtZSA9IGRhdGEubmFtZTtcclxuICAgICAgICAgICAgdHBsRGF0YS5sYXRsb25nID0gZGF0YS5sYXRsb25nO1xyXG5cclxuICAgICAgICAgICAgYXdhaXQgdHBsRGF0YS5zYXZlKCk7XHJcblxyXG4gICAgICAgICAgICByZXNwb25zZS5tZXNzYWdlID0gX2lkID8gXCJMb2NhdGlvbiBpcyBVcGRhdGVkXCIgOiBcIkEgbmV3IGxvY2F0aW9uIGlzIGFkZGVkXCI7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c0NvZGUgPSAyMDA7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcblxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGUpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc3RhdGljIGFzeW5jIGRlbGV0ZUxvY2F0aW9uKF9pZCwgY29uZCkge1xyXG4gICAgICAgIGNvbmQgPSAhY29uZCA/IHt9IDogY29uZDtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IHsgc3RhdHVzQ29kZTogNDAwLCBtZXNzYWdlOiAnRXJyb3IhJywgc3RhdHVzOiBmYWxzZSB9O1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBhd2FpdCBDdXN0b21lckxvY2F0aW9uTW9kZWwudXBkYXRlT25lKHsgX2lkLCAuLi5jb25kIH0sIHsgaXNEZWxldGVkOiB0cnVlIH0pO1xyXG5cclxuICAgICAgICAgICAgcmVzcG9uc2UubWVzc2FnZSA9IFwiRGVsZXRlZCBzdWNjZXNzZnVsbHlcIjtcclxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzQ29kZSA9IDIwMDtcclxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG5cclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbiBub3QgZGVsZXRlLiBTb21ldGhpbmcgd2VudCB3cm9uZy5cIilcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxufSJdfQ==