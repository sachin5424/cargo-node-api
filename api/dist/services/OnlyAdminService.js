"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _modue = _interopRequireDefault(require("../data-base/models/modue"));

var _adminModules = _interopRequireDefault(require("../data-base/models/adminModules"));

var _dataBase = require("../data-base");

var _helper = require("../utls/_helper");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

class AdminService {
  static async listModules(query, params) {
    const isAll = params.isAll === 'ALL';
    const response = {
      statusCode: 400,
      message: 'Data not found!',
      result: {
        data: [],
        page: query.page * 1 > 0 ? query.page * 1 : 1,
        limit: query.limit * 1 > 0 ? query.limit * 1 : 20,
        total: 0
      },
      status: false
    };

    try {
      const search = {
        _id: query._id,
        $or: [{
          title: {
            $regex: '.*' + (query?.key || '') + '.*'
          }
        }, {
          key: {
            $regex: '.*' + (query?.key || '') + '.*'
          }
        }]
      };
      (0, _helper.clearSearch)(search);
      const $aggregate = [{
        $match: search
      }, {
        $sort: {
          _id: -1
        }
      }, {
        $project: {
          title: 1,
          key: 1
        }
      }];
      const counter = await _modue.default.aggregate([...$aggregate, {
        $count: "total"
      }]);
      response.result.total = counter[0]?.total;

      if (isAll) {
        response.result.page = 1;
        response.result.limit = response.result.total;
      }

      response.result.data = await _modue.default.aggregate([...$aggregate, {
        $limit: response.result.limit + response.result.limit * (response.result.page - 1)
      }, {
        $skip: response.result.limit * (response.result.page - 1)
      }]);

      if (response.result.data.length) {
        response.message = "Data fetched";
      }

      response.statusCode = 200;
      response.status = true;
      return response;
    } catch (e) {
      throw new Error(e);
    }
  }

  static async saveModule(data) {
    const _id = data._id;
    const response = {
      statusCode: 400,
      message: 'Error!',
      status: false
    };

    try {
      const tplData = _id ? await _modue.default.findById(_id) : new _modue.default();
      tplData.title = data.title;
      tplData.key = data.key;
      await tplData.save();
      response.message = _id ? "Module is Updated" : "A new module is created";
      response.statusCode = 200;
      response.status = true;
      return response;
    } catch (e) {
      throw new Error(e);
    }
  }

  static async deleteModule(_id) {
    const response = {
      statusCode: 400,
      message: 'Error!',
      status: false
    };

    try {
      await _modue.default.findById(_id).remove();
      response.message = "Deleted successfully1111";
      response.statusCode = 200;
      response.status = true;
      return response;
    } catch (e) {
      throw new Error("Can not delete. Something went wrong.");
    }
  }

  static async adminModules(query) {
    const response = {
      statusCode: 400,
      message: 'Data not found!',
      result: {
        data: [],
        page: query.page * 1 > 0 ? query.page * 1 : 1,
        limit: query.limit * 1 > 0 ? query.limit * 1 : 20,
        total: 0
      },
      status: false
    };

    try {
      const search = {
        typeName: {
          $regex: '.*' + query?.key + '.*'
        },
        typeKey: {
          $ne: 'superAdmin'
        }
      };
      (0, _helper.clearSearch)(search);
      const $aggregate = [{
        $match: search
      }, {
        $lookup: {
          from: "modules",
          localField: "grantedModules",
          foreignField: "key",
          as: "grantedModuleTitles",
          pipeline: [{
            $project: {
              title: 1,
              _id: 0
            }
          }]
        }
      }, {
        $project: {
          grantedModules: 1,
          grantedModuleTitles: 1,
          typeName: 1,
          typeKey: 1
        }
      }];
      response.result.data = await _adminModules.default.aggregate([...$aggregate, {
        $limit: response.result.limit + response.result.limit * (response.result.page - 1)
      }, {
        $skip: response.result.limit * (response.result.page - 1)
      }]).then(async function (data) {
        await _adminModules.default.aggregate([...$aggregate, {
          $count: "total"
        }]).then(count => {
          response.result.total = count[0].total;
        }).catch(err => {
          response.result.total = 0;
        });
        return data;
      }).catch(err => {
        throw new Error(err.message);
      });

      if (response.result.data.length) {
        response.message = "Data fetched";
      }

      response.statusCode = 200;
      response.status = true;
      return response;
    } catch (e) {
      throw new Error(e);
    }
  }

  static async saveAdminModules(data) {
    const typeKey = data.typeKey;
    const response = {
      statusCode: 400,
      message: 'Error!',
      status: false
    };

    try {
      const tplData = await _adminModules.default.findOne({
        typeKey
      });
      tplData.grantedModules = data.grantedModules;
      await tplData.save();
      response.message = "User permission is updated";
      response.statusCode = 200;
      response.status = true;
      return response;
    } catch (e) {
      throw new Error(e);
    }
  }

  static async listAdmin(query, params) {
    const response = {
      statusCode: 400,
      message: 'Data not found!',
      result: {
        data: [],
        page: query.page * 1 > 0 ? query.page * 1 : 1,
        limit: query.limit * 1 > 0 ? query.limit * 1 : 20,
        total: 0
      },
      status: false
    };

    try {
      const search = _objectSpread({
        _id: query._id,
        isDeleted: false,
        $or: [{
          firstName: {
            $regex: '.*' + query?.key + '.*'
          }
        }, {
          lastName: {
            $regex: '.*' + query?.key + '.*'
          }
        }]
      }, getAdminFilter());

      (0, _helper.clearSearch)(search); // const driverFilter ={isDeleted: false, ...getAdminFilter()};
      // clearSearch(driverFilter);

      const $aggregate = [{
        $match: search
      }, {
        $sort: {
          _id: -1
        }
      }, {
        "$project": {
          firstName: 1,
          lastName: 1,
          phoneNo: 1,
          email: 1,
          emailVerified: 1,
          dob: 1,
          type: 1,
          address: 1,
          state: 1,
          district: 1,
          taluk: 1,
          zipcode: 1,
          isActive: 1,
          image: {
            url: {
              $concat: [config.applicationFileUrl + 'customer/photo/', "$photo"]
            },
            name: "$photo"
          }
        }
      }];
      response.result.data = await _dataBase.UserModel.aggregate([...$aggregate, {
        $limit: response.result.limit + response.result.limit * (response.result.page - 1)
      }, {
        $skip: response.result.limit * (response.result.page - 1)
      }]).then(async function (data) {
        await _dataBase.UserModel.aggregate([...$aggregate, {
          $count: "total"
        }]).then(count => {
          response.result.total = count[0].total;
        }).catch(err => {
          response.result.total = 0;
        });
        return data;
      }).catch(err => {
        throw new Error(err.message);
      });

      if (response.result.data.length) {
        response.message = "Data fetched";
      }

      response.statusCode = 200;
      response.status = true;
      return response;
    } catch (e) {
      throw new Error(e);
    }
  }

  static async saveAdmin(data) {
    const _id = data._id;
    const response = {
      statusCode: 400,
      message: 'Error!',
      status: false
    };

    try {
      const tplData = _id ? await _dataBase.UserModel.findById(_id) : new _dataBase.UserModel();
      tplData.firstName = data.firstName;
      tplData.lastName = data.lastName;
      tplData.phoneNo = data.phoneNo;
      tplData.email = data.email;
      !data.password || (tplData.password = data.password);
      tplData.dob = data.dob; // tplData.photo = await uploadFile(data.photo, config.uploadPaths.customer.photo, UserModel, 'photo', _id);

      tplData.address = data.address;
      tplData.state = data.state;
      tplData.district = data.district;
      tplData.taluk = data.taluk;
      tplData.zipcode = data.zipcode;
      tplData.isActive = data.isActive;
      await tplData.save();
      response.message = _id ? "Customer is Updated" : "A new customer is created";
      response.statusCode = 200;
      response.status = true;
      return response;
    } catch (e) {
      throw new Error(e);
    }
  }

  static async deleteAdmin(_id, cond) {
    (0, _helper.clearSearch)({
      cond
    });
    const response = {
      statusCode: 400,
      message: 'Error!',
      status: false
    };

    try {
      await _dataBase.UserModel.updateOne(_objectSpread({
        _id
      }, cond), {
        isDeleted: true
      });
      response.message = "Deleted successfully";
      response.statusCode = 200;
      response.status = true;
      return response;
    } catch (e) {
      throw new Error("Can not delete. Something went wrong.");
    }
  }

}

exports.default = AdminService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXJ2aWNlcy9Pbmx5QWRtaW5TZXJ2aWNlLmpzIl0sIm5hbWVzIjpbIkFkbWluU2VydmljZSIsImxpc3RNb2R1bGVzIiwicXVlcnkiLCJwYXJhbXMiLCJpc0FsbCIsInJlc3BvbnNlIiwic3RhdHVzQ29kZSIsIm1lc3NhZ2UiLCJyZXN1bHQiLCJkYXRhIiwicGFnZSIsImxpbWl0IiwidG90YWwiLCJzdGF0dXMiLCJzZWFyY2giLCJfaWQiLCIkb3IiLCJ0aXRsZSIsIiRyZWdleCIsImtleSIsIiRhZ2dyZWdhdGUiLCIkbWF0Y2giLCIkc29ydCIsIiRwcm9qZWN0IiwiY291bnRlciIsIk1vZHVsZU1vZGVsIiwiYWdncmVnYXRlIiwiJGNvdW50IiwiJGxpbWl0IiwiJHNraXAiLCJsZW5ndGgiLCJlIiwiRXJyb3IiLCJzYXZlTW9kdWxlIiwidHBsRGF0YSIsImZpbmRCeUlkIiwic2F2ZSIsImRlbGV0ZU1vZHVsZSIsInJlbW92ZSIsImFkbWluTW9kdWxlcyIsInR5cGVOYW1lIiwidHlwZUtleSIsIiRuZSIsIiRsb29rdXAiLCJmcm9tIiwibG9jYWxGaWVsZCIsImZvcmVpZ25GaWVsZCIsImFzIiwicGlwZWxpbmUiLCJncmFudGVkTW9kdWxlcyIsImdyYW50ZWRNb2R1bGVUaXRsZXMiLCJBZG1pbk1vZHVsZXNNb2RlbCIsInRoZW4iLCJjb3VudCIsImNhdGNoIiwiZXJyIiwic2F2ZUFkbWluTW9kdWxlcyIsImZpbmRPbmUiLCJsaXN0QWRtaW4iLCJpc0RlbGV0ZWQiLCJmaXJzdE5hbWUiLCJsYXN0TmFtZSIsImdldEFkbWluRmlsdGVyIiwicGhvbmVObyIsImVtYWlsIiwiZW1haWxWZXJpZmllZCIsImRvYiIsInR5cGUiLCJhZGRyZXNzIiwic3RhdGUiLCJkaXN0cmljdCIsInRhbHVrIiwiemlwY29kZSIsImlzQWN0aXZlIiwiaW1hZ2UiLCJ1cmwiLCIkY29uY2F0IiwiY29uZmlnIiwiYXBwbGljYXRpb25GaWxlVXJsIiwibmFtZSIsIlVzZXJNb2RlbCIsInNhdmVBZG1pbiIsInBhc3N3b3JkIiwiZGVsZXRlQWRtaW4iLCJjb25kIiwidXBkYXRlT25lIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7QUFFZSxNQUFNQSxZQUFOLENBQW1CO0FBRU4sZUFBWEMsV0FBVyxDQUFDQyxLQUFELEVBQVFDLE1BQVIsRUFBZ0I7QUFDcEMsVUFBTUMsS0FBSyxHQUFHRCxNQUFNLENBQUNDLEtBQVAsS0FBaUIsS0FBL0I7QUFDQSxVQUFNQyxRQUFRLEdBQUc7QUFDYkMsTUFBQUEsVUFBVSxFQUFFLEdBREM7QUFFYkMsTUFBQUEsT0FBTyxFQUFFLGlCQUZJO0FBR2JDLE1BQUFBLE1BQU0sRUFBRTtBQUNKQyxRQUFBQSxJQUFJLEVBQUUsRUFERjtBQUVKQyxRQUFBQSxJQUFJLEVBQUVSLEtBQUssQ0FBQ1EsSUFBTixHQUFhLENBQWIsR0FBaUIsQ0FBakIsR0FBcUJSLEtBQUssQ0FBQ1EsSUFBTixHQUFhLENBQWxDLEdBQXNDLENBRnhDO0FBR0pDLFFBQUFBLEtBQUssRUFBRVQsS0FBSyxDQUFDUyxLQUFOLEdBQWMsQ0FBZCxHQUFrQixDQUFsQixHQUFzQlQsS0FBSyxDQUFDUyxLQUFOLEdBQWMsQ0FBcEMsR0FBd0MsRUFIM0M7QUFJSkMsUUFBQUEsS0FBSyxFQUFFO0FBSkgsT0FISztBQVNiQyxNQUFBQSxNQUFNLEVBQUU7QUFUSyxLQUFqQjs7QUFZQSxRQUFJO0FBQ0EsWUFBTUMsTUFBTSxHQUFHO0FBQ1hDLFFBQUFBLEdBQUcsRUFBRWIsS0FBSyxDQUFDYSxHQURBO0FBRVhDLFFBQUFBLEdBQUcsRUFBRSxDQUNEO0FBQ0lDLFVBQUFBLEtBQUssRUFBRTtBQUFFQyxZQUFBQSxNQUFNLEVBQUUsUUFBUWhCLEtBQUssRUFBRWlCLEdBQVAsSUFBYyxFQUF0QixJQUE0QjtBQUF0QztBQURYLFNBREMsRUFJRDtBQUNJQSxVQUFBQSxHQUFHLEVBQUU7QUFBRUQsWUFBQUEsTUFBTSxFQUFFLFFBQVFoQixLQUFLLEVBQUVp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LE1BQUFBLFFBQVEsQ0FBQ0MsVUFBVCxHQUFzQixHQUF0QjtBQUNBRCxNQUFBQSxRQUFRLENBQUNRLE1BQVQsR0FBa0IsSUFBbEI7QUFFQSxhQUFPUixRQUFQO0FBRUgsS0F6QkQsQ0F5QkUsT0FBTzBCLENBQVAsRUFBVTtBQUNSLFlBQU0sSUFBSUMsS0FBSixDQUFVRCxDQUFWLENBQU47QUFDSDtBQUNKOztBQUN1QixlQUFYb0QsV0FBVyxDQUFDcEUsR0FBRCxFQUFNcUUsSUFBTixFQUFZO0FBQ2hDLDZCQUFZO0FBQUVBLE1BQUFBO0FBQUYsS0FBWjtBQUNBLFVBQU0vRSxRQUFRLEdBQUc7QUFBRUMsTUFBQUEsVUFBVSxFQUFFLEdBQWQ7QUFBbUJDLE1BQUFBLE9BQU8sRUFBRSxRQUE1QjtBQUFzQ00sTUFBQUEsTUFBTSxFQUFFO0FBQTlDLEtBQWpCOztBQUVBLFFBQUk7QUFDQSxZQUFNbUUsb0JBQVVLLFNBQVY7QUFBc0J0RSxRQUFBQTtBQUF0QixTQUE4QnFFLElBQTlCLEdBQXNDO0FBQUV6QixRQUFBQSxTQUFTLEVBQUU7QUFBYixPQUF0QyxDQUFOO0FBRUF0RCxNQUFBQSxRQUFRLENBQUNFLE9BQVQsR0FBbUIsc0JBQW5CO0FBQ0FGLE1BQUFBLFFBQVEsQ0FBQ0MsVUFBVCxHQUFzQixHQUF0QjtBQUNBRCxNQUFBQSxRQUFRLENBQUNRLE1BQVQsR0FBa0IsSUFBbEI7QUFDQSxhQUFPUixRQUFQO0FBRUgsS0FSRCxDQVFFLE9BQU8wQixDQUFQLEVBQVU7QUFDUixZQUFNLElBQUlDLEtBQUosQ0FBVSx1Q0FBVixDQUFOO0FBQ0g7QUFDSjs7QUE1VTZCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE1vZHVsZU1vZGVsIGZyb20gXCIuLi9kYXRhLWJhc2UvbW9kZWxzL21vZHVlXCI7XHJcbmltcG9ydCBBZG1pbk1vZHVsZXNNb2RlbCBmcm9tIFwiLi4vZGF0YS1iYXNlL21vZGVscy9hZG1pbk1vZHVsZXNcIjtcclxuaW1wb3J0IHsgVXNlck1vZGVsIH0gZnJvbSBcIi4uL2RhdGEtYmFzZVwiO1xyXG5pbXBvcnQgeyBjbGVhclNlYXJjaCB9IGZyb20gXCIuLi91dGxzL19oZWxwZXJcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFkbWluU2VydmljZSB7XHJcblxyXG4gICAgc3RhdGljIGFzeW5jIGxpc3RNb2R1bGVzKHF1ZXJ5LCBwYXJhbXMpIHtcclxuICAgICAgICBjb25zdCBpc0FsbCA9IHBhcmFtcy5pc0FsbCA9PT0gJ0FMTCc7XHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB7XHJcbiAgICAgICAgICAgIHN0YXR1c0NvZGU6IDQwMCxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ0RhdGEgbm90IGZvdW5kIScsXHJcbiAgICAgICAgICAgIHJlc3VsdDoge1xyXG4gICAgICAgICAgICAgICAgZGF0YTogW10sXHJcbiAgICAgICAgICAgICAgICBwYWdlOiBxdWVyeS5wYWdlICogMSA+IDAgPyBxdWVyeS5wYWdlICogMSA6IDEsXHJcbiAgICAgICAgICAgICAgICBsaW1pdDogcXVlcnkubGltaXQgKiAxID4gMCA/IHF1ZXJ5LmxpbWl0ICogMSA6IDIwLFxyXG4gICAgICAgICAgICAgICAgdG90YWw6IDAsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHN0YXR1czogZmFsc2VcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBzZWFyY2ggPSB7XHJcbiAgICAgICAgICAgICAgICBfaWQ6IHF1ZXJ5Ll9pZCxcclxuICAgICAgICAgICAgICAgICRvcjogW1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHsgJHJlZ2V4OiAnLionICsgKHF1ZXJ5Py5rZXkgfHwgJycpICsgJy4qJyB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleTogeyAkcmVnZXg6ICcuKicgKyAocXVlcnk/LmtleSB8fCAnJykgKyAnLionIH1cclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGNsZWFyU2VhcmNoKHNlYXJjaCk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCAkYWdncmVnYXRlID0gW1xyXG4gICAgICAgICAgICAgICAgeyAkbWF0Y2g6IHNlYXJjaCB9LFxyXG4gICAgICAgICAgICAgICAgeyAkc29ydDogeyBfaWQ6IC0xIH0gfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAkcHJvamVjdDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAga2V5OiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIF07XHJcblxyXG5cclxuICAgICAgICAgICAgY29uc3QgY291bnRlciA9IGF3YWl0IE1vZHVsZU1vZGVsLmFnZ3JlZ2F0ZShbLi4uJGFnZ3JlZ2F0ZSwgeyAkY291bnQ6IFwidG90YWxcIiB9XSk7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnJlc3VsdC50b3RhbCA9IGNvdW50ZXJbMF0/LnRvdGFsO1xyXG4gICAgICAgICAgICBpZiAoaXNBbGwpIHtcclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLnJlc3VsdC5wYWdlID0gMTtcclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLnJlc3VsdC5saW1pdCA9IHJlc3BvbnNlLnJlc3VsdC50b3RhbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmVzcG9uc2UucmVzdWx0LmRhdGEgPSBhd2FpdCBNb2R1bGVNb2RlbC5hZ2dyZWdhdGUoXHJcbiAgICAgICAgICAgICAgICBbXHJcbiAgICAgICAgICAgICAgICAgICAgLi4uJGFnZ3JlZ2F0ZSxcclxuICAgICAgICAgICAgICAgICAgICB7ICRsaW1pdDogcmVzcG9uc2UucmVzdWx0LmxpbWl0ICsgcmVzcG9uc2UucmVzdWx0LmxpbWl0ICogKHJlc3BvbnNlLnJlc3VsdC5wYWdlIC0gMSkgfSxcclxuICAgICAgICAgICAgICAgICAgICB7ICRza2lwOiByZXNwb25zZS5yZXN1bHQubGltaXQgKiAocmVzcG9uc2UucmVzdWx0LnBhZ2UgLSAxKSB9XHJcbiAgICAgICAgICAgICAgICBdKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5yZXN1bHQuZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLm1lc3NhZ2UgPSBcIkRhdGEgZmV0Y2hlZFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c0NvZGUgPSAyMDA7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcblxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGUpXHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuICAgIHN0YXRpYyBhc3luYyBzYXZlTW9kdWxlKGRhdGEpIHtcclxuICAgICAgICBjb25zdCBfaWQgPSBkYXRhLl9pZDtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IHsgc3RhdHVzQ29kZTogNDAwLCBtZXNzYWdlOiAnRXJyb3IhJywgc3RhdHVzOiBmYWxzZSB9O1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCB0cGxEYXRhID0gX2lkID8gYXdhaXQgTW9kdWxlTW9kZWwuZmluZEJ5SWQoX2lkKSA6IG5ldyBNb2R1bGVNb2RlbCgpO1xyXG5cclxuICAgICAgICAgICAgdHBsRGF0YS50aXRsZSA9IGRhdGEudGl0bGU7XHJcbiAgICAgICAgICAgIHRwbERhdGEua2V5ID0gZGF0YS5rZXk7XHJcblxyXG4gICAgICAgICAgICBhd2FpdCB0cGxEYXRhLnNhdmUoKTtcclxuXHJcbiAgICAgICAgICAgIHJlc3BvbnNlLm1lc3NhZ2UgPSBfaWQgPyBcIk1vZHVsZSBpcyBVcGRhdGVkXCIgOiBcIkEgbmV3IG1vZHVsZSBpcyBjcmVhdGVkXCI7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c0NvZGUgPSAyMDA7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcblxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGUpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc3RhdGljIGFzeW5jIGRlbGV0ZU1vZHVsZShfaWQpIHtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IHsgc3RhdHVzQ29kZTogNDAwLCBtZXNzYWdlOiAnRXJyb3IhJywgc3RhdHVzOiBmYWxzZSB9O1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBhd2FpdCBNb2R1bGVNb2RlbC5maW5kQnlJZCggX2lkKS5yZW1vdmUoKTtcclxuXHJcbiAgICAgICAgICAgIHJlc3BvbnNlLm1lc3NhZ2UgPSBcIkRlbGV0ZWQgc3VjY2Vzc2Z1bGx5MTExMVwiO1xyXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXNDb2RlID0gMjAwO1xyXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXMgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG5cclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbiBub3QgZGVsZXRlLiBTb21ldGhpbmcgd2VudCB3cm9uZy5cIilcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGFzeW5jIGFkbWluTW9kdWxlcyhxdWVyeSkge1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0ge1xyXG4gICAgICAgICAgICBzdGF0dXNDb2RlOiA0MDAsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdEYXRhIG5vdCBmb3VuZCEnLFxyXG4gICAgICAgICAgICByZXN1bHQ6IHtcclxuICAgICAgICAgICAgICAgIGRhdGE6IFtdLFxyXG4gICAgICAgICAgICAgICAgcGFnZTogcXVlcnkucGFnZSAqIDEgPiAwID8gcXVlcnkucGFnZSAqIDEgOiAxLFxyXG4gICAgICAgICAgICAgICAgbGltaXQ6IHF1ZXJ5LmxpbWl0ICogMSA+IDAgPyBxdWVyeS5saW1pdCAqIDEgOiAyMCxcclxuICAgICAgICAgICAgICAgIHRvdGFsOiAwLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzdGF0dXM6IGZhbHNlXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3Qgc2VhcmNoID0geyB0eXBlTmFtZTogeyAkcmVnZXg6ICcuKicgKyBxdWVyeT8ua2V5ICsgJy4qJyB9LCB0eXBlS2V5OiB7ICRuZTogJ3N1cGVyQWRtaW4nIH0gfTtcclxuICAgICAgICAgICAgY2xlYXJTZWFyY2goc2VhcmNoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0ICRhZ2dyZWdhdGUgPSBbXHJcbiAgICAgICAgICAgICAgICB7ICRtYXRjaDogc2VhcmNoIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGxvb2t1cDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmcm9tOiBcIm1vZHVsZXNcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxGaWVsZDogXCJncmFudGVkTW9kdWxlc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlaWduRmllbGQ6IFwia2V5XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzOiBcImdyYW50ZWRNb2R1bGVUaXRsZXNcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGlwZWxpbmU6IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcHJvamVjdDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2lkOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICRwcm9qZWN0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyYW50ZWRNb2R1bGVzOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBncmFudGVkTW9kdWxlVGl0bGVzOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlTmFtZTogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZUtleTogMSxcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBdO1xyXG5cclxuICAgICAgICAgICAgcmVzcG9uc2UucmVzdWx0LmRhdGEgPSBhd2FpdCBBZG1pbk1vZHVsZXNNb2RlbC5hZ2dyZWdhdGUoXHJcbiAgICAgICAgICAgICAgICBbXHJcbiAgICAgICAgICAgICAgICAgICAgLi4uJGFnZ3JlZ2F0ZSxcclxuICAgICAgICAgICAgICAgICAgICB7ICRsaW1pdDogcmVzcG9uc2UucmVzdWx0LmxpbWl0ICsgcmVzcG9uc2UucmVzdWx0LmxpbWl0ICogKHJlc3BvbnNlLnJlc3VsdC5wYWdlIC0gMSkgfSxcclxuICAgICAgICAgICAgICAgICAgICB7ICRza2lwOiByZXNwb25zZS5yZXN1bHQubGltaXQgKiAocmVzcG9uc2UucmVzdWx0LnBhZ2UgLSAxKSB9XHJcbiAgICAgICAgICAgICAgICBdKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oYXN5bmMgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBBZG1pbk1vZHVsZXNNb2RlbC5hZ2dyZWdhdGUoWy4uLiRhZ2dyZWdhdGUsIHsgJGNvdW50OiBcInRvdGFsXCIgfV0pLnRoZW4oY291bnQgPT4geyByZXNwb25zZS5yZXN1bHQudG90YWwgPSBjb3VudFswXS50b3RhbCB9KS5jYXRjaChlcnIgPT4geyByZXNwb25zZS5yZXN1bHQudG90YWwgPSAwIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7IHRocm93IG5ldyBFcnJvcihlcnIubWVzc2FnZSkgfSlcclxuXHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5yZXN1bHQuZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLm1lc3NhZ2UgPSBcIkRhdGEgZmV0Y2hlZFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c0NvZGUgPSAyMDA7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcblxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGUpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBhc3luYyBzYXZlQWRtaW5Nb2R1bGVzKGRhdGEpIHtcclxuICAgICAgICBjb25zdCB0eXBlS2V5ID0gZGF0YS50eXBlS2V5O1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geyBzdGF0dXNDb2RlOiA0MDAsIG1lc3NhZ2U6ICdFcnJvciEnLCBzdGF0dXM6IGZhbHNlIH07XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRwbERhdGEgPSBhd2FpdCBBZG1pbk1vZHVsZXNNb2RlbC5maW5kT25lKHt0eXBlS2V5fSk7XHJcbiAgICAgICAgICAgIHRwbERhdGEuZ3JhbnRlZE1vZHVsZXMgPSBkYXRhLmdyYW50ZWRNb2R1bGVzO1xyXG5cclxuICAgICAgICAgICAgYXdhaXQgdHBsRGF0YS5zYXZlKCk7XHJcblxyXG4gICAgICAgICAgICByZXNwb25zZS5tZXNzYWdlID0gXCJVc2VyIHBlcm1pc3Npb24gaXMgdXBkYXRlZFwiO1xyXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXNDb2RlID0gMjAwO1xyXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXMgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG5cclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlKVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgYXN5bmMgbGlzdEFkbWluKHF1ZXJ5LCBwYXJhbXMpIHtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IHtcclxuICAgICAgICAgICAgc3RhdHVzQ29kZTogNDAwLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnRGF0YSBub3QgZm91bmQhJyxcclxuICAgICAgICAgICAgcmVzdWx0OiB7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiBbXSxcclxuICAgICAgICAgICAgICAgIHBhZ2U6IHF1ZXJ5LnBhZ2UgKiAxID4gMCA/IHF1ZXJ5LnBhZ2UgKiAxIDogMSxcclxuICAgICAgICAgICAgICAgIGxpbWl0OiBxdWVyeS5saW1pdCAqIDEgPiAwID8gcXVlcnkubGltaXQgKiAxIDogMjAsXHJcbiAgICAgICAgICAgICAgICB0b3RhbDogMCxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc3RhdHVzOiBmYWxzZVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNlYXJjaCA9IHtcclxuICAgICAgICAgICAgICAgIF9pZDogcXVlcnkuX2lkLFxyXG4gICAgICAgICAgICAgICAgaXNEZWxldGVkOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICRvcjogW1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB7ICRyZWdleDogJy4qJyArIHF1ZXJ5Py5rZXkgKyAnLionIH1cclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdE5hbWU6IHsgJHJlZ2V4OiAnLionICsgcXVlcnk/LmtleSArICcuKicgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBdLFxyXG5cclxuICAgICAgICAgICAgICAgIC4uLmdldEFkbWluRmlsdGVyKClcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgY2xlYXJTZWFyY2goc2VhcmNoKTtcclxuICAgICAgICAgICAgLy8gY29uc3QgZHJpdmVyRmlsdGVyID17aXNEZWxldGVkOiBmYWxzZSwgLi4uZ2V0QWRtaW5GaWx0ZXIoKX07XHJcbiAgICAgICAgICAgIC8vIGNsZWFyU2VhcmNoKGRyaXZlckZpbHRlcik7XHJcblxyXG4gICAgICAgICAgICBjb25zdCAkYWdncmVnYXRlID0gW1xyXG4gICAgICAgICAgICAgICAgeyAkbWF0Y2g6IHNlYXJjaCB9LFxyXG4gICAgICAgICAgICAgICAgeyAkc29ydDogeyBfaWQ6IC0xIH0gfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBcIiRwcm9qZWN0XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3ROYW1lOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0TmFtZTogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGhvbmVObzogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW1haWw6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvYjogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWRkcmVzczogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGU6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3RyaWN0OiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWx1azogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgemlwY29kZTogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXNBY3RpdmU6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHsgJGNvbmNhdDogW2NvbmZpZy5hcHBsaWNhdGlvbkZpbGVVcmwgKyAnY3VzdG9tZXIvcGhvdG8vJywgXCIkcGhvdG9cIl0gfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiJHBob3RvXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIF07XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnJlc3VsdC5kYXRhID0gYXdhaXQgVXNlck1vZGVsLmFnZ3JlZ2F0ZShcclxuICAgICAgICAgICAgICAgIFtcclxuICAgICAgICAgICAgICAgICAgICAuLi4kYWdncmVnYXRlLFxyXG4gICAgICAgICAgICAgICAgICAgIHsgJGxpbWl0OiByZXNwb25zZS5yZXN1bHQubGltaXQgKyByZXNwb25zZS5yZXN1bHQubGltaXQgKiAocmVzcG9uc2UucmVzdWx0LnBhZ2UgLSAxKSB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHsgJHNraXA6IHJlc3BvbnNlLnJlc3VsdC5saW1pdCAqIChyZXNwb25zZS5yZXN1bHQucGFnZSAtIDEpIH1cclxuICAgICAgICAgICAgICAgIF0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihhc3luYyBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IFVzZXJNb2RlbC5hZ2dyZWdhdGUoWy4uLiRhZ2dyZWdhdGUsIHsgJGNvdW50OiBcInRvdGFsXCIgfV0pLnRoZW4oY291bnQgPT4geyByZXNwb25zZS5yZXN1bHQudG90YWwgPSBjb3VudFswXS50b3RhbCB9KS5jYXRjaChlcnIgPT4geyByZXNwb25zZS5yZXN1bHQudG90YWwgPSAwIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7IHRocm93IG5ldyBFcnJvcihlcnIubWVzc2FnZSkgfSlcclxuXHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5yZXN1bHQuZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLm1lc3NhZ2UgPSBcIkRhdGEgZmV0Y2hlZFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c0NvZGUgPSAyMDA7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcblxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGUpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc3RhdGljIGFzeW5jIHNhdmVBZG1pbihkYXRhKSB7XHJcbiAgICAgICAgY29uc3QgX2lkID0gZGF0YS5faWQ7XHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB7IHN0YXR1c0NvZGU6IDQwMCwgbWVzc2FnZTogJ0Vycm9yIScsIHN0YXR1czogZmFsc2UgfTtcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgdHBsRGF0YSA9IF9pZCA/IGF3YWl0IFVzZXJNb2RlbC5maW5kQnlJZChfaWQpIDogbmV3IFVzZXJNb2RlbCgpO1xyXG5cclxuICAgICAgICAgICAgdHBsRGF0YS5maXJzdE5hbWUgPSBkYXRhLmZpcnN0TmFtZTtcclxuICAgICAgICAgICAgdHBsRGF0YS5sYXN0TmFtZSA9IGRhdGEubGFzdE5hbWU7XHJcbiAgICAgICAgICAgIHRwbERhdGEucGhvbmVObyA9IGRhdGEucGhvbmVObztcclxuICAgICAgICAgICAgdHBsRGF0YS5lbWFpbCA9IGRhdGEuZW1haWw7XHJcbiAgICAgICAgICAgICghZGF0YS5wYXNzd29yZCB8fCAodHBsRGF0YS5wYXNzd29yZCA9IGRhdGEucGFzc3dvcmQpKTtcclxuICAgICAgICAgICAgdHBsRGF0YS5kb2IgPSBkYXRhLmRvYjtcclxuICAgICAgICAgICAgLy8gdHBsRGF0YS5waG90byA9IGF3YWl0IHVwbG9hZEZpbGUoZGF0YS5waG90bywgY29uZmlnLnVwbG9hZFBhdGhzLmN1c3RvbWVyLnBob3RvLCBVc2VyTW9kZWwsICdwaG90bycsIF9pZCk7XHJcbiAgICAgICAgICAgIHRwbERhdGEuYWRkcmVzcyA9IGRhdGEuYWRkcmVzcztcclxuICAgICAgICAgICAgdHBsRGF0YS5zdGF0ZSA9IGRhdGEuc3RhdGU7XHJcbiAgICAgICAgICAgIHRwbERhdGEuZGlzdHJpY3QgPSBkYXRhLmRpc3RyaWN0O1xyXG4gICAgICAgICAgICB0cGxEYXRhLnRhbHVrID0gZGF0YS50YWx1aztcclxuICAgICAgICAgICAgdHBsRGF0YS56aXBjb2RlID0gZGF0YS56aXBjb2RlO1xyXG4gICAgICAgICAgICB0cGxEYXRhLmlzQWN0aXZlID0gZGF0YS5pc0FjdGl2ZTtcclxuXHJcbiAgICAgICAgICAgIGF3YWl0IHRwbERhdGEuc2F2ZSgpO1xyXG5cclxuICAgICAgICAgICAgcmVzcG9uc2UubWVzc2FnZSA9IF9pZCA/IFwiQ3VzdG9tZXIgaXMgVXBkYXRlZFwiIDogXCJBIG5ldyBjdXN0b21lciBpcyBjcmVhdGVkXCI7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c0NvZGUgPSAyMDA7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcblxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGUpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc3RhdGljIGFzeW5jIGRlbGV0ZUFkbWluKF9pZCwgY29uZCkge1xyXG4gICAgICAgIGNsZWFyU2VhcmNoKHsgY29uZCB9KTtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IHsgc3RhdHVzQ29kZTogNDAwLCBtZXNzYWdlOiAnRXJyb3IhJywgc3RhdHVzOiBmYWxzZSB9O1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBhd2FpdCBVc2VyTW9kZWwudXBkYXRlT25lKHsgX2lkLCAuLi5jb25kIH0sIHsgaXNEZWxldGVkOiB0cnVlIH0pO1xyXG5cclxuICAgICAgICAgICAgcmVzcG9uc2UubWVzc2FnZSA9IFwiRGVsZXRlZCBzdWNjZXNzZnVsbHlcIjtcclxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzQ29kZSA9IDIwMDtcclxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG5cclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbiBub3QgZGVsZXRlLiBTb21ldGhpbmcgd2VudCB3cm9uZy5cIilcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59Il19