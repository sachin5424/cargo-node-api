"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _helper = require("../utls/_helper");

var _state = _interopRequireDefault(require("../data-base/models/state"));

var _serviceType = _interopRequireDefault(require("../data-base/models/serviceType"));

var _wallet = _interopRequireDefault(require("../data-base/models/wallet"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class Service {
  static async listStates(query) {
    const response = {
      statusCode: 400,
      message: 'Data not found!',
      data: {
        docs: [],
        page: query.page * 1 > 0 ? query.page * 1 : 1,
        limit: query.limit * 1 > 0 ? query.limit * 1 : 200,
        totalDocs: 0
      },
      status: false
    };

    try {
      const search = {
        _id: query._id,
        isDeleted: false // name: {$regex: ".*" + query.name + ".*"} 

      };
      (0, _helper.clearSearch)(search);
      response.data.docs = await _state.default.find(search).select('-__v').limit(response.data.limit).skip(response.data.limit * (response.data.page - 1)).then(async function (data) {
        await _state.default.count(search).then(count => {
          response.data.totalDocs = count;
        }).catch(err => {
          response.data.totalDocs = 0;
        });
        return data;
      }).catch(err => {
        throw new Error(err.message);
      });

      if (response.data.docs.length) {
        response.message = "Data fetched";
      }

      response.statusCode = 200;
      response.status = true;
      return response;
    } catch (e) {
      throw new Error(e);
    }
  }

  static async listServiceType() {
    const response = {
      statusCode: 400,
      message: 'Data not found!',
      result: {
        data: []
      },
      status: false
    };

    try {
      response.result.data = await _serviceType.default.find().select({
        name: 1,
        key: 1
      });

      if (response.result.data.length) {
        response.message = "Data fetched";
      }

      response.statusCode = 200;
      response.status = true;
      return response;
    } catch (e) {
      throw new Error(e);
    }
  }

  static async updateWallet(data) {
    try {
      const wallet = await _wallet.default.findById(data.wallet);

      if (data.transactionType === 'credit') {
        wallet.amount = wallet.amount + data.amount;
      } else if (data.transactionType === 'debit') {
        wallet.amount = wallet.amount - data.amount;
      }

      await wallet.save();
    } catch (e) {
      throw new Error('Wallet can not be updated');
    }
  }

}

exports.default = Service;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXJ2aWNlcy9Db21tb25TZXJ2aWNlLmpzIl0sIm5hbWVzIjpbIlNlcnZpY2UiLCJsaXN0U3RhdGVzIiwicXVlcnkiLCJyZXNwb25zZSIsInN0YXR1c0NvZGUiLCJtZXNzYWdlIiwiZGF0YSIsImRvY3MiLCJwYWdlIiwibGltaXQiLCJ0b3RhbERvY3MiLCJzdGF0dXMiLCJzZWFyY2giLCJfaWQiLCJpc0RlbGV0ZWQiLCJTdGF0ZU1vZGVsIiwiZmluZCIsInNlbGVjdCIsInNraXAiLCJ0aGVuIiwiY291bnQiLCJjYXRjaCIsImVyciIsIkVycm9yIiwibGVuZ3RoIiwiZSIsImxpc3RTZXJ2aWNlVHlwZSIsInJlc3VsdCIsIlNlcnZpY2VUeXBlTW9kZWwiLCJuYW1lIiwia2V5IiwidXBkYXRlV2FsbGV0Iiwid2FsbGV0IiwiV2FsbGV0TW9kZWwiLCJmaW5kQnlJZCIsInRyYW5zYWN0aW9uVHlwZSIsImFtb3VudCIsInNhdmUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUVlLE1BQU1BLE9BQU4sQ0FBYztBQUVGLGVBQVZDLFVBQVUsQ0FBQ0MsS0FBRCxFQUFRO0FBQzNCLFVBQU1DLFFBQVEsR0FBRztBQUNiQyxNQUFBQSxVQUFVLEVBQUUsR0FEQztBQUViQyxNQUFBQSxPQUFPLEVBQUUsaUJBRkk7QUFHYkMsTUFBQUEsSUFBSSxFQUFFO0FBQ0ZDLFFBQUFBLElBQUksRUFBRSxFQURKO0FBRUZDLFFBQUFBLElBQUksRUFBRU4sS0FBSyxDQUFDTSxJQUFOLEdBQWEsQ0FBYixHQUFpQixDQUFqQixHQUFxQk4sS0FBSyxDQUFDTSxJQUFOLEdBQWEsQ0FBbEMsR0FBc0MsQ0FGMUM7QUFHRkMsUUFBQUEsS0FBSyxFQUFFUCxLQUFLLENBQUNPLEtBQU4sR0FBYyxDQUFkLEdBQWtCLENBQWxCLEdBQXNCUCxLQUFLLENBQUNPLEtBQU4sR0FBYyxDQUFwQyxHQUF3QyxHQUg3QztBQUlGQyxRQUFBQSxTQUFTLEVB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LE1BQU0sR0FBRyxNQUFNQyxnQkFBWUMsUUFBWixDQUFxQjVCLElBQUksQ0FBQzBCLE1BQTFCLENBQXJCOztBQUNBLFVBQUcxQixJQUFJLENBQUM2QixlQUFMLEtBQXlCLFFBQTVCLEVBQXFDO0FBQ2pDSCxRQUFBQSxNQUFNLENBQUNJLE1BQVAsR0FBZ0JKLE1BQU0sQ0FBQ0ksTUFBUCxHQUFnQjlCLElBQUksQ0FBQzhCLE1BQXJDO0FBQ0gsT0FGRCxNQUVPLElBQUc5QixJQUFJLENBQUM2QixlQUFMLEtBQXlCLE9BQTVCLEVBQW9DO0FBQ3ZDSCxRQUFBQSxNQUFNLENBQUNJLE1BQVAsR0FBZ0JKLE1BQU0sQ0FBQ0ksTUFBUCxHQUFnQjlCLElBQUksQ0FBQzhCLE1BQXJDO0FBQ0g7O0FBQ0QsWUFBTUosTUFBTSxDQUFDSyxJQUFQLEVBQU47QUFDSCxLQVJELENBUUUsT0FBTVosQ0FBTixFQUFRO0FBQ04sWUFBTSxJQUFJRixLQUFKLENBQVUsMkJBQVYsQ0FBTjtBQUNIO0FBQ0o7O0FBaEZ3QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNsZWFyU2VhcmNoIH0gZnJvbSBcIi4uL3V0bHMvX2hlbHBlclwiO1xyXG5pbXBvcnQgU3RhdGVNb2RlbCBmcm9tIFwiLi4vZGF0YS1iYXNlL21vZGVscy9zdGF0ZVwiO1xyXG5pbXBvcnQgU2VydmljZVR5cGVNb2RlbCBmcm9tIFwiLi4vZGF0YS1iYXNlL21vZGVscy9zZXJ2aWNlVHlwZVwiO1xyXG5pbXBvcnQgV2FsbGV0TW9kZWwgZnJvbSBcIi4uL2RhdGEtYmFzZS9tb2RlbHMvd2FsbGV0XCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTZXJ2aWNlIHtcclxuXHJcbiAgICBzdGF0aWMgYXN5bmMgbGlzdFN0YXRlcyhxdWVyeSkge1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0ge1xyXG4gICAgICAgICAgICBzdGF0dXNDb2RlOiA0MDAsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdEYXRhIG5vdCBmb3VuZCEnLFxyXG4gICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICBkb2NzOiBbXSxcclxuICAgICAgICAgICAgICAgIHBhZ2U6IHF1ZXJ5LnBhZ2UgKiAxID4gMCA/IHF1ZXJ5LnBhZ2UgKiAxIDogMSxcclxuICAgICAgICAgICAgICAgIGxpbWl0OiBxdWVyeS5saW1pdCAqIDEgPiAwID8gcXVlcnkubGltaXQgKiAxIDogMjAwLFxyXG4gICAgICAgICAgICAgICAgdG90YWxEb2NzOiAwLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzdGF0dXM6IGZhbHNlXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3Qgc2VhcmNoID0geyBfaWQ6IHF1ZXJ5Ll9pZCwgaXNEZWxldGVkOiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgLy8gbmFtZTogeyRyZWdleDogXCIuKlwiICsgcXVlcnkubmFtZSArIFwiLipcIn0gXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGNsZWFyU2VhcmNoKHNlYXJjaCk7XHJcblxyXG4gICAgICAgICAgICByZXNwb25zZS5kYXRhLmRvY3MgPSBhd2FpdCBTdGF0ZU1vZGVsLmZpbmQoc2VhcmNoKVxyXG4gICAgICAgICAgICAgICAgLnNlbGVjdCgnLV9fdicpXHJcbiAgICAgICAgICAgICAgICAubGltaXQocmVzcG9uc2UuZGF0YS5saW1pdClcclxuICAgICAgICAgICAgICAgIC5za2lwKHJlc3BvbnNlLmRhdGEubGltaXQgKiAocmVzcG9uc2UuZGF0YS5wYWdlIC0gMSkpXHJcbiAgICAgICAgICAgICAgICAudGhlbihhc3luYyBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IFN0YXRlTW9kZWwuY291bnQoc2VhcmNoKS50aGVuKGNvdW50ID0+IHsgcmVzcG9uc2UuZGF0YS50b3RhbERvY3MgPSBjb3VudCB9KS5jYXRjaChlcnIgPT4geyByZXNwb25zZS5kYXRhLnRvdGFsRG9jcyA9IDAgfSlcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyID0+IHsgdGhyb3cgbmV3IEVycm9yKGVyci5tZXNzYWdlKSB9KVxyXG5cclxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZG9jcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLm1lc3NhZ2UgPSBcIkRhdGEgZmV0Y2hlZFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c0NvZGUgPSAyMDA7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcblxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGUpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBhc3luYyBsaXN0U2VydmljZVR5cGUoKSB7XHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB7XHJcbiAgICAgICAgICAgIHN0YXR1c0NvZGU6IDQwMCxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ0RhdGEgbm90IGZvdW5kIScsXHJcbiAgICAgICAgICAgIHJlc3VsdDoge1xyXG4gICAgICAgICAgICAgICAgZGF0YTogW10sXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHN0YXR1czogZmFsc2VcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICByZXNwb25zZS5yZXN1bHQuZGF0YSA9IGF3YWl0IFNlcnZpY2VUeXBlTW9kZWwuZmluZCgpLnNlbGVjdCh7bmFtZTogMSwga2V5OiAxfSk7XHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5yZXN1bHQuZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLm1lc3NhZ2UgPSBcIkRhdGEgZmV0Y2hlZFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c0NvZGUgPSAyMDA7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyA9IHRydWU7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcclxuXHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZSlcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGFzeW5jIHVwZGF0ZVdhbGxldChkYXRhKXtcclxuICAgICAgICB0cnl7XHJcbiAgICAgICAgICAgIGNvbnN0IHdhbGxldCA9IGF3YWl0IFdhbGxldE1vZGVsLmZpbmRCeUlkKGRhdGEud2FsbGV0KTtcclxuICAgICAgICAgICAgaWYoZGF0YS50cmFuc2FjdGlvblR5cGUgPT09ICdjcmVkaXQnKXtcclxuICAgICAgICAgICAgICAgIHdhbGxldC5hbW91bnQgPSB3YWxsZXQuYW1vdW50ICsgZGF0YS5hbW91bnQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZihkYXRhLnRyYW5zYWN0aW9uVHlwZSA9PT0gJ2RlYml0Jyl7XHJcbiAgICAgICAgICAgICAgICB3YWxsZXQuYW1vdW50ID0gd2FsbGV0LmFtb3VudCAtIGRhdGEuYW1vdW50O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGF3YWl0IHdhbGxldC5zYXZlKCk7XHJcbiAgICAgICAgfSBjYXRjaChlKXtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdXYWxsZXQgY2FuIG5vdCBiZSB1cGRhdGVkJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSAgICBcclxufSJdfQ==