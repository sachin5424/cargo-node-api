"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _import = require("../../../settings/import");

var _CustomerService = _interopRequireDefault(require("../../../services/CustomerService"));

var _helper = require("../../../utls/_helper");

var _renderFile = require("../../../views/resetPassword/renderFile");

var _config = _interopRequireDefault(require("../../../utls/config"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class UserController {
  static async login(req, res) {
    try {
      const errors = (0, _import.validationResult)(req);

      if (!errors.isEmpty()) {
        return res.status(422).json({
          message: errors.msg,
          errors: errors.errors
        });
      }

      const srvRes = await _CustomerService.default.customerLogin(req.body);
      return res.status(srvRes.statusCode).json({
        srvRes
      });
    } catch (e) {
      return res.status(400).send({
        message: e.message
      });
    }
  }

  static async verifyEmail(req, res) {
    try {
      let email = '';

      try {
        email = (0, _helper.decryptData)(req.params.email);
      } catch (e) {
        throw new Error('Invalid path');
      }

      const srvRes = await _CustomerService.default.verifyEmail(email);
      return res.status(srvRes.statusCode).json({
        srvRes
      });
    } catch (e) {
      return res.status(400).send({
        message: e.message
      });
    }
  }

  static async genForgetPasswordUrl(req, res) {
    try {
      const email = req.body.email;
      const srvRes = await _CustomerService.default.genForgetPasswordUrl(email);
      return res.status(srvRes.statusCode).json({
        srvRes
      });
    } catch (e) {
      return res.status(400).send({
        message: e.message
      });
    }
  }

  static async resetPasswordForm(req, res) {
    try {
      const originalUrl = req.originalUrl;
      const callbackUrl = _config.default.applicationBaseUrl;
      const callbackUrlText = 'Login Here';
      const html = await (0, _renderFile.renderCustomerResetPasswordForm)({
        originalUrl,
        callbackUrl,
        callbackUrlText
      });
      res.
      /* setHeader('Content-Type', 'text/html'). */
      send(html);
    } catch (e) {
      return res.status(400).send({
        message: 'Error try again!' + e.message
      });
    }
  }

  static async resetPAssword(req, res) {
    try {
      const errors = (0, _import.validationResult)(req);

      if (!errors.isEmpty()) {
        return res.status(422).json({
          message: errors.msg,
          errors: errors.errors
        });
      }

      const key = req.params.key;
      const srvRes = await _CustomerService.default.resetPAssword(key, req.body);
      return res.status(srvRes.statusCode).json({
        srvRes
      });
    } catch (e) {
      return res.status(400).send({
        message: e.message
      });
    }
  }

}

exports.default = UserController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9tb2R1bGVzL2N1c3RvbWVycy91c2VyL1VzZXJDb250ZXJvbGxlci5qcyJdLCJuYW1lcyI6WyJVc2VyQ29udHJvbGxlciIsImxvZ2luIiwicmVxIiwicmVzIiwiZXJyb3JzIiwiaXNFbXB0eSIsInN0YXR1cyIsImpzb24iLCJtZXNzYWdlIiwibXNnIiwic3J2UmVzIiwiU2VydmljZSIsImN1c3RvbWVyTG9naW4iLCJib2R5Iiwic3RhdHVzQ29kZSIsImUiLCJzZW5kIiwidmVyaWZ5RW1haWwiLCJlbWFpbCIsInBhcmFtcyIsIkVycm9yIiwiZ2VuRm9yZ2V0UGFzc3dvcmRVcmwiLCJyZXNldFBhc3N3b3JkRm9ybSIsIm9yaWdpbmFsVXJsIiwiY2FsbGJhY2tVcmwiLCJjb25maWciLCJhcHBsaWNhdGlvbkJhc2VVcmwiLCJjYWxsYmFja1VybFRleHQiLCJodG1sIiwicmVzZXRQQXNzd29yZCIsImtleSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRWUsTUFBTUEsY0FBTixDQUFxQjtBQUVkLGVBQUxDLEtBQUssQ0FBQ0MsR0FBRCxFQUFNQyxHQUFOLEVBQVc7QUFDekIsUUFBSTtBQUNBLFlBQU1DLE1BQU0sR0FBRyw4QkFBaUJGLEdBQWpCLENBQWY7O0FBQ0EsVUFBSSxDQUFDRSxNQUFNLENBQUNDLE9BQVAsRUFBTCxFQUF1QjtBQUNuQixlQUFPRixHQUFHLENBQUNHLE1BQUosQ0FBVyxHQUFYLEVBQWdCQyxJQUFoQixDQUFxQjtBQUN4QkMsVUFBQUEsT0FBTyxFQUFFSixNQUFNLENBQUNLLEdBRFE7QUFFeEJMLFVBQUFBLE1BQU0sRUFBRUEsTUFBTSxDQUFDQTtBQUZTLFNBQXJCLENBQVA7QUFJSDs7QUFFVixZQUFNTSxNQUFNLEdBQUcsTUFBTUMseUJBQVFDLGFBQVIsQ0FBc0JWLEdBQUcsQ0FBQ1csSUFBMUIsQ0FBckI7QUFDUyxhQUFPVixHQUFHLENBQUNHLE1BQUosQ0FB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RyxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUI7QUFDeEJDLFVBQUFBLE9BQU8sRUFBRUosTUFBTSxDQUFDSyxHQURRO0FBRXhCTCxVQUFBQSxNQUFNLEVBQUVBLE1BQU0sQ0FBQ0E7QUFGUyxTQUFyQixDQUFQO0FBSUg7O0FBRUQsWUFBTTBCLEdBQUcsR0FBRzVCLEdBQUcsQ0FBQ2lCLE1BQUosQ0FBV1csR0FBdkI7QUFDVCxZQUFNcEIsTUFBTSxHQUFHLE1BQU1DLHlCQUFRa0IsYUFBUixDQUFzQkMsR0FBdEIsRUFBMkI1QixHQUFHLENBQUNXLElBQS9CLENBQXJCO0FBQ1MsYUFBT1YsR0FBRyxDQUFDRyxNQUFKLENBQVdJLE1BQU0sQ0FBQ0ksVUFBbEIsRUFBOEJQLElBQTlCLENBQW1DO0FBQUVHLFFBQUFBO0FBQUYsT0FBbkMsQ0FBUDtBQUNILEtBWkQsQ0FZRSxPQUFPSyxDQUFQLEVBQVU7QUFDakIsYUFBT1osR0FBRyxDQUFDRyxNQUFKLENBQVcsR0FBWCxFQUFnQlUsSUFBaEIsQ0FBcUI7QUFBQ1IsUUFBQUEsT0FBTyxFQUFFTyxDQUFDLENBQUNQO0FBQVosT0FBckIsQ0FBUDtBQUNBO0FBQ0U7O0FBMUUrQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7dmFsaWRhdGlvblJlc3VsdH0gZnJvbSBcIi4uLy4uLy4uL3NldHRpbmdzL2ltcG9ydFwiO1xyXG5pbXBvcnQgU2VydmljZSBmcm9tIFwiLi4vLi4vLi4vc2VydmljZXMvQ3VzdG9tZXJTZXJ2aWNlXCI7XHJcbmltcG9ydCB7IGRlY3J5cHREYXRhIH0gZnJvbSBcIi4uLy4uLy4uL3V0bHMvX2hlbHBlclwiO1xyXG5pbXBvcnQgeyByZW5kZXJDdXN0b21lclJlc2V0UGFzc3dvcmRGb3JtIH0gZnJvbSBcIi4uLy4uLy4uL3ZpZXdzL3Jlc2V0UGFzc3dvcmQvcmVuZGVyRmlsZVwiO1xyXG5pbXBvcnQgY29uZmlnIGZyb20gXCIuLi8uLi8uLi91dGxzL2NvbmZpZ1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckNvbnRyb2xsZXIge1xyXG5cclxuICAgIHN0YXRpYyBhc3luYyBsb2dpbihyZXEsIHJlcykge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGVycm9ycyA9IHZhbGlkYXRpb25SZXN1bHQocmVxKTtcclxuICAgICAgICAgICAgaWYgKCFlcnJvcnMuaXNFbXB0eSgpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MjIpLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9ycy5tc2csXHJcbiAgICAgICAgICAgICAgICAgICAgZXJyb3JzOiBlcnJvcnMuZXJyb3JzXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuXHRcdFx0Y29uc3Qgc3J2UmVzID0gYXdhaXQgU2VydmljZS5jdXN0b21lckxvZ2luKHJlcS5ib2R5KVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyhzcnZSZXMuc3RhdHVzQ29kZSkuanNvbih7IHNydlJlcyB9KTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcblx0XHRcdHJldHVybiByZXMuc3RhdHVzKDQwMCkuc2VuZCh7bWVzc2FnZTogZS5tZXNzYWdlfSk7XHJcblx0XHR9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGFzeW5jIHZlcmlmeUVtYWlsKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgbGV0IGVtYWlsID0gJyc7XHJcbiAgICAgICAgICAgIHRyeXtcclxuICAgICAgICAgICAgICAgIGVtYWlsID0gZGVjcnlwdERhdGEocmVxLnBhcmFtcy5lbWFpbCk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2goZSl7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcGF0aCcpXHJcbiAgICAgICAgICAgIH1cclxuXHRcdFx0Y29uc3Qgc3J2UmVzID0gYXdhaXQgU2VydmljZS52ZXJpZnlFbWFpbChlbWFpbCk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKHNydlJlcy5zdGF0dXNDb2RlKS5qc29uKHsgc3J2UmVzIH0pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuXHRcdFx0cmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5zZW5kKHttZXNzYWdlOiBlLm1lc3NhZ2V9KTtcclxuXHRcdH1cclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgYXN5bmMgZ2VuRm9yZ2V0UGFzc3dvcmRVcmwocmVxLCByZXMpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBlbWFpbCA9IHJlcS5ib2R5LmVtYWlsO1xyXG5cclxuXHRcdFx0Y29uc3Qgc3J2UmVzID0gYXdhaXQgU2VydmljZS5nZW5Gb3JnZXRQYXNzd29yZFVybChlbWFpbCk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKHNydlJlcy5zdGF0dXNDb2RlKS5qc29uKHsgc3J2UmVzIH0pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuXHRcdFx0cmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5zZW5kKHttZXNzYWdlOiBlLm1lc3NhZ2V9KTtcclxuXHRcdH1cclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgYXN5bmMgcmVzZXRQYXNzd29yZEZvcm0ocmVxLCByZXMpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBvcmlnaW5hbFVybCA9IHJlcS5vcmlnaW5hbFVybDtcclxuICAgICAgICAgICAgY29uc3QgY2FsbGJhY2tVcmwgPSBjb25maWcuYXBwbGljYXRpb25CYXNlVXJsO1xyXG4gICAgICAgICAgICBjb25zdCBjYWxsYmFja1VybFRleHQgPSAnTG9naW4gSGVyZSc7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBodG1sID0gYXdhaXQgcmVuZGVyQ3VzdG9tZXJSZXNldFBhc3N3b3JkRm9ybSh7b3JpZ2luYWxVcmwsIGNhbGxiYWNrVXJsLCBjYWxsYmFja1VybFRleHR9KTtcclxuICAgICAgICAgICAgcmVzLi8qIHNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ3RleHQvaHRtbCcpLiAqL3NlbmQoaHRtbClcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcblx0XHRcdHJldHVybiByZXMuc3RhdHVzKDQwMCkuc2VuZCh7bWVzc2FnZTogJ0Vycm9yIHRyeSBhZ2FpbiEnICsgZS5tZXNzYWdlfSk7XHJcblx0XHR9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGFzeW5jIHJlc2V0UEFzc3dvcmQocmVxLCByZXMpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBlcnJvcnMgPSB2YWxpZGF0aW9uUmVzdWx0KHJlcSk7XHJcbiAgICAgICAgICAgIGlmICghZXJyb3JzLmlzRW1wdHkoKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDIyKS5qc29uKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvcnMubXNnLFxyXG4gICAgICAgICAgICAgICAgICAgIGVycm9yczogZXJyb3JzLmVycm9yc1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGtleSA9IHJlcS5wYXJhbXMua2V5O1xyXG5cdFx0XHRjb25zdCBzcnZSZXMgPSBhd2FpdCBTZXJ2aWNlLnJlc2V0UEFzc3dvcmQoa2V5LCByZXEuYm9keSk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKHNydlJlcy5zdGF0dXNDb2RlKS5qc29uKHsgc3J2UmVzIH0pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuXHRcdFx0cmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5zZW5kKHttZXNzYWdlOiBlLm1lc3NhZ2V9KTtcclxuXHRcdH1cclxuICAgIH1cclxuXHJcbn0iXX0=