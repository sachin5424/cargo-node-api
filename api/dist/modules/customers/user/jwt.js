"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.jwtTokenPermission = void 0;

var _customer = _interopRequireDefault(require("../../../data-base/models/customer"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var jwt = require('jsonwebtoken');

var JWT_SECREATE_kEY = 'testing';

let jwtTokenPermission = async (req, res, next) => {
  try {
    var bearer = req.headers.authorization.split(" ");
    console.log(bearer); // ////console.logreq);

    var token = bearer[1];
    console.log(token);
    var decode = jwt.verify(token, "testing");
    console.log(req.headers, "?????????");

    if (decode.userId) {
      req.userId = decode.userId;
      console.log(req.userId);
      const user = await _customer.default.findOne({
        _id: req.userId
      });

      if (user) {
        ////console.loguser);
        next();
      } else {
        return res.status(401).json({
          status: 401,
          message: "Failed to authenticate token."
        });
      }
    }
  } catch (error) {
    res.status(401).json({
      status: 401,
      message: "Failed to authenticate token."
    });
  }
};

exports.jwtTokenPermission = jwtTokenPermission;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9tb2R1bGVzL2N1c3RvbWVycy91c2VyL2p3dC5qcyJdLCJuYW1lcyI6WyJqd3QiLCJyZXF1aXJlIiwiSldUX1NFQ1JFQVRFX2tFWSIsImp3dFRva2VuUGVybWlzc2lvbiIsInJlcSIsInJlcyIsIm5leHQiLCJiZWFyZXIiLCJoZWFkZXJzIiwiYXV0aG9yaXphdGlvbiIsInNwbGl0IiwiY29uc29sZSIsImxvZyIsInRva2VuIiwiZGVjb2RlIiwidmVyaWZ5IiwidXNlcklkIiwidXNlciIsImN1c3RvbWVyTW9kZWwiLCJmaW5kT25lIiwiX2lkIiwic3RhdHVzIiwianNvbiIsIm1lc3NhZ2UiLCJlcnJvciJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUVBOzs7O0FBRkEsSUFBSUEsR0FBRyxHQUFHQyxPQUFPLENBQUMsY0FBRCxDQUFqQjs7QUFDQSxJQUFJQyxnQkFBZ0IsR0FBRyxTQUF2Qjs7QUFFQSxJQUFJQyxrQkFBa0IsR0FBSSxPQUFPQyxHQUFQLEVBQVlDLEdBQVosRUFBaUJDLElBQWpCLEtBQTBCO0FBQ2hELE1BQUk7QUFFQSxRQUFJQyxNQUFNLEdBQUdILEdBQUcsQ0FBQ0ksT0FBSixDQUFZQyxhQUFaLENBQTBCQyxLQUExQixDQUFnQyxHQUFoQyxDQUFiO0FBQ0FDLElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZTCxNQUFaLEVBSEEsQ0FJQTs7QUFDRCxRQUFLTSxLQUFLLEdBQUdOLE1BQU0sQ0FBQyxDQUFELENBQW5CO0FBQ0NJLElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxLQUFaO0FBQ0EsUUFBSUMsTUFBTSxHQUFHZCxHQUFHLENBQUNlLE1BQUosQ0FBV0YsS0FBWCxFQUFrQixTQUFsQixDQUFiO0FBQ0RGLElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZUixHQUFHLENBQUNJLE9BQWhCLEVBQXdCLFdBQXhCOztBQUNDLFFBQUlNLE1BQU0sQ0FBQ0UsTUFBWCxFQUFtQjtBQUNmWixNQUFBQSxHQUFHLENBQUNZLE1BQUosR0FBYUYsTUFBTSxDQUFDRSxNQUFwQjtBQUNBTCxNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWVIsR0FBRyxDQUFDWSxNQUFoQjtBQUNELFlBQU1DLElBQUksR0FBRyxNQUFNQyxrQkFBY0MsT0FBZCxDQUFzQjtBQUFDQyxRQUFBQSxHQUFHLEVBQUNoQixHQUFHLENBQUNZO0FBQVQsT0FBdEIsQ0FBbkI7O0FBQ0EsVUFBR0MsSUFBSCxFQUFRO0FBQ0o7QUFDSFgsUUFBQUEsSUFBSTtBQUNKLE9BSEQsTUFJSTtBQUNKLGVBQU9ELEdBQUcsQ0FBQ2dCLE1BQUosQ0FBVyxHQUFYLEVBQWdCQyxJQUFoQixDQUFxQjtBQUN2QkQsVUFBQUEsTUFBTSxFQUFFLEdBRGU7QUFFdkJFLFVBQUFBLE9BQU8sRUFBRTtBQUZjLFNBQXJCLENBQVA7QUFJQztBQUNIO0FBQ0osR0F4QkQsQ0F3QkUsT0FBT0MsS0FBUCxFQUFjO0FBQ1puQixJQUFBQSxHQUFHLENBQUNnQixNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUI7QUFDakJELE1BQUFBLE1BQU0sRUFBRSxHQURTO0FBRWpCRSxNQUFBQSxPQUFPLEVBQUU7QUFGUSxLQUFyQjtBQUlIO0FBQ0osQ0EvQkQiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7XHJcbnZhciBKV1RfU0VDUkVBVEVfa0VZID0gJ3Rlc3RpbmcnO1xyXG5pbXBvcnQgY3VzdG9tZXJNb2RlbCBmcm9tICcuLi8uLi8uLi9kYXRhLWJhc2UvbW9kZWxzL2N1c3RvbWVyJztcclxubGV0IGp3dFRva2VuUGVybWlzc2lvbiA9ICBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICBcclxuICAgICAgICB2YXIgYmVhcmVyID0gcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbi5zcGxpdChcIiBcIik7XHJcbiAgICAgICAgY29uc29sZS5sb2coYmVhcmVyKTtcclxuICAgICAgICAvLyAvLy8vY29uc29sZS5sb2dyZXEpO1xyXG4gICAgICAgdmFyICB0b2tlbiA9IGJlYXJlclsxXTtcclxuICAgICAgICBjb25zb2xlLmxvZyh0b2tlbilcclxuICAgICAgICB2YXIgZGVjb2RlID0gand0LnZlcmlmeSh0b2tlbiwgXCJ0ZXN0aW5nXCIpO1xyXG4gICAgICAgY29uc29sZS5sb2cocmVxLmhlYWRlcnMsXCI/Pz8/Pz8/Pz9cIik7XHJcbiAgICAgICAgaWYgKGRlY29kZS51c2VySWQpIHtcclxuICAgICAgICAgICAgcmVxLnVzZXJJZCA9IGRlY29kZS51c2VySWRcclxuICAgICAgICAgICAgY29uc29sZS5sb2cocmVxLnVzZXJJZCk7XHJcbiAgICAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IGN1c3RvbWVyTW9kZWwuZmluZE9uZSh7X2lkOnJlcS51c2VySWR9KTtcclxuICAgICAgICAgICBpZih1c2VyKXtcclxuICAgICAgICAgICAgICAgLy8vL2NvbnNvbGUubG9ndXNlcik7XHJcbiAgICAgICAgICAgIG5leHQoKVxyXG4gICAgICAgICAgIH1cclxuICAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XHJcbiAgICAgICAgICAgICAgICBzdGF0dXM6IDQwMSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGF1dGhlbnRpY2F0ZSB0b2tlbi5cIlxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcclxuICAgICAgICAgICAgc3RhdHVzOiA0MDEsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGF1dGhlbnRpY2F0ZSB0b2tlbi5cIlxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7XHJcbiAgICBqd3RUb2tlblBlcm1pc3Npb25cclxufSJdfQ==