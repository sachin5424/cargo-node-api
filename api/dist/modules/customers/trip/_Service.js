"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _customer = _interopRequireDefault(require("../../../data-base/models/customer"));

var _customerLocation = _interopRequireDefault(require("../../../data-base/models/customerLocation"));

var _helper = require("../../../utls/_helper");

var _config = _interopRequireDefault(require("../../../utls/config"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class Service {
  static async listTrip(query, cuser) {
    const response = {
      statusCode: 400,
      message: 'Data not found!',
      data: {
        docs: [],
        page: query.page * 1 > 0 ? query.page * 1 : 1,
        limit: query.limit * 1 > 0 ? query.limit * 1 : 20,
        totalDocs: 0
      },
      status: false
    };

    try {
      const search = {
        _id: query._id,
        isDeleted: false
        /* ...getAdminFilter(cuser)  */

      };
      (0, _helper.clearSearch)(search);
      response.data.docs = await _customer.default.find(search).select('  -__v').limit(response.data.limit).skip(response.data.limit * (response.data.page - 1)).then(async function (data) {
        await _customer.default.count(search).then(count => {
          response.data.totalDocs = count;
        }).catch(err => {
          response.data.totalDocs = 0;
        });
        return data;
      }).catch(err => {
        throw new Error(err.message);
      });

      if (response.data.docs.length) {
        response.message = "Data fetched";
      }

      response.statusCode = 200;
      response.status = true;
      return response;
    } catch (e) {
      throw new Error(e);
    }
  }

  static async saveTrip(data) {
    const _id = data._id;
    const response = {
      statusCode: 400,
      message: 'Error!',
      status: false
    };

    try {
      const tplData = _id ? await _customer.default.findById(_id) : new _customer.default();
      tplData.firstName = data.firstName;
      tplData.lastName = data.lastName;
      tplData.phoneNo = data.phoneNo;
      tplData.email = data.email;
      tplData.password = data.password;
      tplData.dob = data.dob;
      tplData.photo = await (0, _helper.uploadFile)(data.photo, _config.default.uploadPaths.customer.photo, _customer.default, 'photo', _id);
      tplData.address = data.address;
      tplData.state = data.state;
      tplData.district = data.district;
      tplData.taluk = data.taluk;
      tplData.zipcode = data.zipcode;
      tplData.isActive = data.isActive;
      await tplData.save();
      response.message = _id ? "Customer is Updated" : "A new customer is created";
      response.statusCode = 200;
      response.status = true;
      return response;
    } catch (e) {
      throw new Error(e);
    }
  }

}

exports.default = Service;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9tb2R1bGVzL2N1c3RvbWVycy90cmlwL19TZXJ2aWNlLmpzIl0sIm5hbWVzIjpbIlNlcnZpY2UiLCJsaXN0VHJpcCIsInF1ZXJ5IiwiY3VzZXIiLCJyZXNwb25zZSIsInN0YXR1c0NvZGUiLCJtZXNzYWdlIiwiZGF0YSIsImRvY3MiLCJwYWdlIiwibGltaXQiLCJ0b3RhbERvY3MiLCJzdGF0dXMiLCJzZWFyY2giLCJfaWQiLCJpc0RlbGV0ZWQiLCJDdXN0b21lck1vZGVsIiwiZmluZCIsInNlbGVjdCIsInNraXAiLCJ0aGVuIiwiY291bnQiLCJjYXRjaCIsImVyciIsIkVycm9yIiwibGVuZ3RoIiwiZSIsInNhdmVUcmlwIiwidHBsRGF0YSIsImZpbmRCeUlkIiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJwaG9uZU5vIiwiZW1haWwiLCJwYXNzd29yZCIsImRvYiIsInBob3RvIiwiY29uZmlnIiwidXBsb2FkUGF0aHMiLCJjdXN0b21lciIsImFkZHJlc3MiLCJzdGF0ZSIsImRpc3RyaWN0IiwidGFsdWsiLCJ6aXBjb2RlIiwiaXNBY3RpdmUiLCJzYXZlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBRUE7Ozs7QUFFZSxNQUFNQSxPQUFOLENBQWM7QUFFSixlQUFSQyxRQUFRLENBQUNDLEtBQUQsRUFBUUMsS0FBUixFQUFlO0FBQ2hDLFVBQU1DLFFBQVEsR0FBRztBQUNiQyxNQUFBQSxVQUFVLEVBQUUsR0FEQztBQUViQyxNQUFBQSxPQUFPLEVBQUUsaUJBRkk7QUFHYkMsTUFBQUEsSUFBSSxFQUFFO0FBQ0ZDLFFBQUFBLElBQUksRUFBRSxFQURKO0FBRUZDLFFBQUFBLElBQUksRUFBRVAsS0FBSyxDQUFDTyxJQUFOLEdBQWEsQ0FBYixHQUFpQixDQUFqQixHQUFxQlAsS0FBSyxDQUFDTyxJQUFOLEdBQWEsQ0FBbEMsR0FBc0MsQ0FGMUM7QUFHRkMsUUFBQUEsS0FBSyxFQUFFUixLQUFLLENBQUNRLEtB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O0FBQ0FQLE1BQUFBLE9BQU8sQ0FBQ1EsS0FBUixHQUFnQixNQUFNLHdCQUFXN0IsSUFBSSxDQUFDNkIsS0FBaEIsRUFBdUJDLGdCQUFPQyxXQUFQLENBQW1CQyxRQUFuQixDQUE0QkgsS0FBbkQsRUFBMERwQixpQkFBMUQsRUFBeUUsT0FBekUsRUFBa0ZGLEdBQWxGLENBQXRCO0FBQ0FjLE1BQUFBLE9BQU8sQ0FBQ1ksT0FBUixHQUFrQmpDLElBQUksQ0FBQ2lDLE9BQXZCO0FBQ0FaLE1BQUFBLE9BQU8sQ0FBQ2EsS0FBUixHQUFnQmxDLElBQUksQ0FBQ2tDLEtBQXJCO0FBQ0FiLE1BQUFBLE9BQU8sQ0FBQ2MsUUFBUixHQUFtQm5DLElBQUksQ0FBQ21DLFFBQXhCO0FBQ0FkLE1BQUFBLE9BQU8sQ0FBQ2UsS0FBUixHQUFnQnBDLElBQUksQ0FBQ29DLEtBQXJCO0FBQ0FmLE1BQUFBLE9BQU8sQ0FBQ2dCLE9BQVIsR0FBa0JyQyxJQUFJLENBQUNxQyxPQUF2QjtBQUNBaEIsTUFBQUEsT0FBTyxDQUFDaUIsUUFBUixHQUFtQnRDLElBQUksQ0FBQ3NDLFFBQXhCO0FBRUEsWUFBTWpCLE9BQU8sQ0FBQ2tCLElBQVIsRUFBTjtBQUVBMUMsTUFBQUEsUUFBUSxDQUFDRSxPQUFULEdBQW1CUSxHQUFHLEdBQUcscUJBQUgsR0FBMkIsMkJBQWpEO0FBQ0FWLE1BQUFBLFFBQVEsQ0FBQ0MsVUFBVCxHQUFzQixHQUF0QjtBQUNBRCxNQUFBQSxRQUFRLENBQUNRLE1BQVQsR0FBa0IsSUFBbEI7QUFFQSxhQUFPUixRQUFQO0FBRUgsS0F6QkQsQ0F5QkUsT0FBT3NCLENBQVAsRUFBVTtBQUNSLFlBQU0sSUFBSUYsS0FBSixDQUFVRSxDQUFWLENBQU47QUFDSDtBQUNKOztBQTFFd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQ3VzdG9tZXJNb2RlbCBmcm9tIFwiLi4vLi4vLi4vZGF0YS1iYXNlL21vZGVscy9jdXN0b21lclwiO1xyXG5pbXBvcnQgQ3VzdG9tZXJMb2NhdGlvbk1vZGVsIGZyb20gXCIuLi8uLi8uLi9kYXRhLWJhc2UvbW9kZWxzL2N1c3RvbWVyTG9jYXRpb25cIjtcclxuaW1wb3J0IHsgY2xlYXJTZWFyY2gsIGdldEFkbWluRmlsdGVyIH0gZnJvbSBcIi4uLy4uLy4uL3V0bHMvX2hlbHBlclwiO1xyXG5pbXBvcnQgeyB1cGxvYWRGaWxlIH0gZnJvbSBcIi4uLy4uLy4uL3V0bHMvX2hlbHBlclwiO1xyXG5pbXBvcnQgY29uZmlnIGZyb20gXCIuLi8uLi8uLi91dGxzL2NvbmZpZ1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VydmljZSB7XHJcblxyXG4gICAgc3RhdGljIGFzeW5jIGxpc3RUcmlwKHF1ZXJ5LCBjdXNlcikge1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0ge1xyXG4gICAgICAgICAgICBzdGF0dXNDb2RlOiA0MDAsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdEYXRhIG5vdCBmb3VuZCEnLFxyXG4gICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICBkb2NzOiBbXSxcclxuICAgICAgICAgICAgICAgIHBhZ2U6IHF1ZXJ5LnBhZ2UgKiAxID4gMCA/IHF1ZXJ5LnBhZ2UgKiAxIDogMSxcclxuICAgICAgICAgICAgICAgIGxpbWl0OiBxdWVyeS5saW1pdCAqIDEgPiAwID8gcXVlcnkubGltaXQgKiAxIDogMjAsXHJcbiAgICAgICAgICAgICAgICB0b3RhbERvY3M6IDAsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHN0YXR1czogZmFsc2VcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBzZWFyY2ggPSB7IF9pZDogcXVlcnkuX2lkLCBpc0RlbGV0ZWQ6IGZhbHNlLCAvKiAuLi5nZXRBZG1pbkZpbHRlcihjdXNlcikgICovfTtcclxuICAgICAgICAgICAgY2xlYXJTZWFyY2goc2VhcmNoKTtcclxuXHJcbiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZG9jcyA9IGF3YWl0IEN1c3RvbWVyTW9kZWwuZmluZChzZWFyY2gpXHJcbiAgICAgICAgICAgICAgICAuc2VsZWN0KCcgIC1fX3YnKVxyXG4gICAgICAgICAgICAgICAgLmxpbWl0KHJlc3BvbnNlLmRhdGEubGltaXQpXHJcbiAgICAgICAgICAgICAgICAuc2tpcChyZXNwb25zZS5kYXRhLmxpbWl0ICogKHJlc3BvbnNlLmRhdGEucGFnZSAtIDEpKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oYXN5bmMgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBDdXN0b21lck1vZGVsLmNvdW50KHNlYXJjaCkudGhlbihjb3VudCA9PiB7IHJlc3BvbnNlLmRhdGEudG90YWxEb2NzID0gY291bnQgfSkuY2F0Y2goZXJyID0+IHsgcmVzcG9uc2UuZGF0YS50b3RhbERvY3MgPSAwIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7IHRocm93IG5ldyBFcnJvcihlcnIubWVzc2FnZSkgfSlcclxuXHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmRvY3MubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICByZXNwb25zZS5tZXNzYWdlID0gXCJEYXRhIGZldGNoZWRcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXNDb2RlID0gMjAwO1xyXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXMgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG5cclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlKVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgYXN5bmMgc2F2ZVRyaXAoZGF0YSkge1xyXG4gICAgICAgIGNvbnN0IF9pZCA9IGRhdGEuX2lkO1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geyBzdGF0dXNDb2RlOiA0MDAsIG1lc3NhZ2U6ICdFcnJvciEnLCBzdGF0dXM6IGZhbHNlIH07XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRwbERhdGEgPSBfaWQgPyBhd2FpdCBDdXN0b21lck1vZGVsLmZpbmRCeUlkKF9pZCkgOiBuZXcgQ3VzdG9tZXJNb2RlbCgpO1xyXG5cclxuICAgICAgICAgICAgdHBsRGF0YS5maXJzdE5hbWUgPSBkYXRhLmZpcnN0TmFtZTtcclxuICAgICAgICAgICAgdHBsRGF0YS5sYXN0TmFtZSA9IGRhdGEubGFzdE5hbWU7XHJcbiAgICAgICAgICAgIHRwbERhdGEucGhvbmVObyA9IGRhdGEucGhvbmVObztcclxuICAgICAgICAgICAgdHBsRGF0YS5lbWFpbCA9IGRhdGEuZW1haWw7XHJcbiAgICAgICAgICAgIHRwbERhdGEucGFzc3dvcmQgPSBkYXRhLnBhc3N3b3JkO1xyXG4gICAgICAgICAgICB0cGxEYXRhLmRvYiA9IGRhdGEuZG9iO1xyXG4gICAgICAgICAgICB0cGxEYXRhLnBob3RvID0gYXdhaXQgdXBsb2FkRmlsZShkYXRhLnBob3RvLCBjb25maWcudXBsb2FkUGF0aHMuY3VzdG9tZXIucGhvdG8sIEN1c3RvbWVyTW9kZWwsICdwaG90bycsIF9pZCk7XHJcbiAgICAgICAgICAgIHRwbERhdGEuYWRkcmVzcyA9IGRhdGEuYWRkcmVzcztcclxuICAgICAgICAgICAgdHBsRGF0YS5zdGF0ZSA9IGRhdGEuc3RhdGU7XHJcbiAgICAgICAgICAgIHRwbERhdGEuZGlzdHJpY3QgPSBkYXRhLmRpc3RyaWN0O1xyXG4gICAgICAgICAgICB0cGxEYXRhLnRhbHVrID0gZGF0YS50YWx1aztcclxuICAgICAgICAgICAgdHBsRGF0YS56aXBjb2RlID0gZGF0YS56aXBjb2RlO1xyXG4gICAgICAgICAgICB0cGxEYXRhLmlzQWN0aXZlID0gZGF0YS5pc0FjdGl2ZTtcclxuXHJcbiAgICAgICAgICAgIGF3YWl0IHRwbERhdGEuc2F2ZSgpO1xyXG5cclxuICAgICAgICAgICAgcmVzcG9uc2UubWVzc2FnZSA9IF9pZCA/IFwiQ3VzdG9tZXIgaXMgVXBkYXRlZFwiIDogXCJBIG5ldyBjdXN0b21lciBpcyBjcmVhdGVkXCI7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c0NvZGUgPSAyMDA7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcblxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGUpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59Il19