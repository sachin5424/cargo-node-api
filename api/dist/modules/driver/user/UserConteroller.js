"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _expressValidator = require("express-validator");

var _DriverService = _interopRequireDefault(require("../../../services/DriverService"));

var _helper = require("../../../utls/_helper");

var _renderFile = require("../../../views/resetPassword/renderFile");

var _config = _interopRequireDefault(require("../../../utls/config"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class UserController {
  static async login(req, res) {
    try {
      const errors = (0, _expressValidator.validationResult)(req);

      if (!errors.isEmpty()) {
        return res.status(422).json({
          message: errors.msg,
          errors: errors.errors
        });
      }

      const srvRes = await _DriverService.default.driverLogin(req.body);
      return res.status(srvRes.statusCode).json({
        srvRes
      });
    } catch (e) {
      return res.status(400).send({
        message: e.message
      });
    }
  }

  static async verifyEmail(req, res) {
    try {
      let email = '';

      try {
        email = (0, _helper.decryptData)(req.params.email);
      } catch (e) {
        throw new Error('Invalid path');
      }

      const srvRes = await _DriverService.default.verifyEmail(email);
      return res.status(srvRes.statusCode).json({
        srvRes
      });
    } catch (e) {
      return res.status(400).send({
        message: e.message
      });
    }
  }

  static async genForgetPasswordUrl(req, res) {
    try {
      const email = req.params.email;
      const srvRes = await _DriverService.default.genForgetPasswordUrl(email);
      return res.status(srvRes.statusCode).json({
        srvRes
      });
    } catch (e) {
      return res.status(400).send({
        message: e.message
      });
    }
  }

  static async resetPasswordForm(req, res) {
    try {
      const originalUrl = req.originalUrl;
      const callbackUrl = _config.default.applicationBaseUrl;
      const callbackUrlText = 'Login Here';
      const html = await (0, _renderFile.renderDriverResetPasswordForm)({
        originalUrl,
        callbackUrl,
        callbackUrlText
      });
      res.setHeader('Content-Type', 'text/html').send(html);
    } catch (e) {
      return res.status(400).send({
        message: 'Error try again!'
      });
    }
  }

  static async resetPAssword(req, res) {
    try {
      const errors = (0, _expressValidator.validationResult)(req);

      if (!errors.isEmpty()) {
        return res.status(422).json({
          message: errors.msg,
          errors: errors.errors
        });
      }

      const key = req.params.key;
      const srvRes = await _DriverService.default.resetPAssword(key, req.body);
      return res.status(srvRes.statusCode).json({
        srvRes
      });
    } catch (e) {
      return res.status(400).send({
        message: e.message
      });
    }
  }

}

exports.default = UserController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9tb2R1bGVzL2RyaXZlci91c2VyL1VzZXJDb250ZXJvbGxlci5qcyJdLCJuYW1lcyI6WyJVc2VyQ29udHJvbGxlciIsImxvZ2luIiwicmVxIiwicmVzIiwiZXJyb3JzIiwiaXNFbXB0eSIsInN0YXR1cyIsImpzb24iLCJtZXNzYWdlIiwibXNnIiwic3J2UmVzIiwiU2VydmljZSIsImRyaXZlckxvZ2luIiwiYm9keSIsInN0YXR1c0NvZGUiLCJlIiwic2VuZCIsInZlcmlmeUVtYWlsIiwiZW1haWwiLCJwYXJhbXMiLCJFcnJvciIsImdlbkZvcmdldFBhc3N3b3JkVXJsIiwicmVzZXRQYXNzd29yZEZvcm0iLCJvcmlnaW5hbFVybCIsImNhbGxiYWNrVXJsIiwiY29uZmlnIiwiYXBwbGljYXRpb25CYXNlVXJsIiwiY2FsbGJhY2tVcmxUZXh0IiwiaHRtbCIsInNldEhlYWRlciIsInJlc2V0UEFzc3dvcmQiLCJrZXkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUVlLE1BQU1BLGNBQU4sQ0FBcUI7QUFFZCxlQUFMQyxLQUFLLENBQUNDLEdBQUQsRUFBTUMsR0FBTixFQUFXO0FBQ3pCLFFBQUk7QUFDQSxZQUFNQyxNQUFNLEdBQUcsd0NBQWlCRixHQUFqQixDQUFmOztBQUNBLFVBQUksQ0FBQ0UsTUFBTSxDQUFDQyxPQUFQLEVBQUwsRUFBdUI7QUFDbkIsZUFBT0YsR0FBRyxDQUFDRyxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUI7QUFDeEJDLFVBQUFBLE9BQU8sRUFBRUosTUFBTSxDQUFDSyxHQURRO0FBRXhCTCxVQUFBQSxNQUFNLEVBQUVBLE1BQU0sQ0FBQ0E7QUFGUyxTQUFyQixDQUFQO0FBSUg7O0FBRVYsWUFBTU0sTUFBTSxHQUFHLE1BQU1DLHVCQUFRQyxXQUFSLENBQW9CVixHQUFHLENBQUNXLElBQXhCLENBQXJCO0FBQ1MsYUFBT1YsR0FBRyxDQUFDRyxN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RixHQUFHLENBQUNHLE1BQUosQ0FBVyxHQUFYLEVBQWdCQyxJQUFoQixDQUFxQjtBQUN4QkMsVUFBQUEsT0FBTyxFQUFFSixNQUFNLENBQUNLLEdBRFE7QUFFeEJMLFVBQUFBLE1BQU0sRUFBRUEsTUFBTSxDQUFDQTtBQUZTLFNBQXJCLENBQVA7QUFJSDs7QUFFRCxZQUFNMkIsR0FBRyxHQUFHN0IsR0FBRyxDQUFDaUIsTUFBSixDQUFXWSxHQUF2QjtBQUVULFlBQU1yQixNQUFNLEdBQUcsTUFBTUMsdUJBQVFtQixhQUFSLENBQXNCQyxHQUF0QixFQUEyQjdCLEdBQUcsQ0FBQ1csSUFBL0IsQ0FBckI7QUFDUyxhQUFPVixHQUFHLENBQUNHLE1BQUosQ0FBV0ksTUFBTSxDQUFDSSxVQUFsQixFQUE4QlAsSUFBOUIsQ0FBbUM7QUFBRUcsUUFBQUE7QUFBRixPQUFuQyxDQUFQO0FBQ0gsS0FiRCxDQWFFLE9BQU9LLENBQVAsRUFBVTtBQUNqQixhQUFPWixHQUFHLENBQUNHLE1BQUosQ0FBVyxHQUFYLEVBQWdCVSxJQUFoQixDQUFxQjtBQUFDUixRQUFBQSxPQUFPLEVBQUVPLENBQUMsQ0FBQ1A7QUFBWixPQUFyQixDQUFQO0FBQ0E7QUFDRTs7QUEzRStCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdmFsaWRhdGlvblJlc3VsdCB9IGZyb20gXCJleHByZXNzLXZhbGlkYXRvclwiO1xyXG5pbXBvcnQgU2VydmljZSBmcm9tIFwiLi4vLi4vLi4vc2VydmljZXMvRHJpdmVyU2VydmljZVwiO1xyXG5pbXBvcnQgeyBkZWNyeXB0RGF0YSB9IGZyb20gXCIuLi8uLi8uLi91dGxzL19oZWxwZXJcIjtcclxuaW1wb3J0IHsgcmVuZGVyRHJpdmVyUmVzZXRQYXNzd29yZEZvcm0gfSBmcm9tIFwiLi4vLi4vLi4vdmlld3MvcmVzZXRQYXNzd29yZC9yZW5kZXJGaWxlXCI7XHJcbmltcG9ydCBjb25maWcgZnJvbSBcIi4uLy4uLy4uL3V0bHMvY29uZmlnXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VyQ29udHJvbGxlciB7XHJcblxyXG4gICAgc3RhdGljIGFzeW5jIGxvZ2luKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgZXJyb3JzID0gdmFsaWRhdGlvblJlc3VsdChyZXEpO1xyXG4gICAgICAgICAgICBpZiAoIWVycm9ycy5pc0VtcHR5KCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQyMikuanNvbih7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3JzLm1zZyxcclxuICAgICAgICAgICAgICAgICAgICBlcnJvcnM6IGVycm9ycy5lcnJvcnNcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG5cdFx0XHRjb25zdCBzcnZSZXMgPSBhd2FpdCBTZXJ2aWNlLmRyaXZlckxvZ2luKHJlcS5ib2R5KVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyhzcnZSZXMuc3RhdHVzQ29kZSkuanNvbih7IHNydlJlcyB9KTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcblx0XHRcdHJldHVybiByZXMuc3RhdHVzKDQwMCkuc2VuZCh7bWVzc2FnZTogZS5tZXNzYWdlfSk7XHJcblx0XHR9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGFzeW5jIHZlcmlmeUVtYWlsKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgbGV0IGVtYWlsID0gJyc7XHJcbiAgICAgICAgICAgIHRyeXtcclxuICAgICAgICAgICAgICAgIGVtYWlsID0gZGVjcnlwdERhdGEocmVxLnBhcmFtcy5lbWFpbCk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2goZSl7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcGF0aCcpXHJcbiAgICAgICAgICAgIH1cclxuXHRcdFx0Y29uc3Qgc3J2UmVzID0gYXdhaXQgU2VydmljZS52ZXJpZnlFbWFpbChlbWFpbCk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKHNydlJlcy5zdGF0dXNDb2RlKS5qc29uKHsgc3J2UmVzIH0pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuXHRcdFx0cmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5zZW5kKHttZXNzYWdlOiBlLm1lc3NhZ2V9KTtcclxuXHRcdH1cclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgYXN5bmMgZ2VuRm9yZ2V0UGFzc3dvcmRVcmwocmVxLCByZXMpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBlbWFpbCA9IHJlcS5wYXJhbXMuZW1haWw7XHJcblxyXG5cdFx0XHRjb25zdCBzcnZSZXMgPSBhd2FpdCBTZXJ2aWNlLmdlbkZvcmdldFBhc3N3b3JkVXJsKGVtYWlsKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoc3J2UmVzLnN0YXR1c0NvZGUpLmpzb24oeyBzcnZSZXMgfSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG5cdFx0XHRyZXR1cm4gcmVzLnN0YXR1cyg0MDApLnNlbmQoe21lc3NhZ2U6IGUubWVzc2FnZX0pO1xyXG5cdFx0fVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBhc3luYyByZXNldFBhc3N3b3JkRm9ybShyZXEsIHJlcykge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsVXJsID0gcmVxLm9yaWdpbmFsVXJsO1xyXG4gICAgICAgICAgICBjb25zdCBjYWxsYmFja1VybCA9IGNvbmZpZy5hcHBsaWNhdGlvbkJhc2VVcmw7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhbGxiYWNrVXJsVGV4dCA9ICdMb2dpbiBIZXJlJztcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGh0bWwgPSBhd2FpdCByZW5kZXJEcml2ZXJSZXNldFBhc3N3b3JkRm9ybSh7b3JpZ2luYWxVcmwsIGNhbGxiYWNrVXJsLCBjYWxsYmFja1VybFRleHR9KTtcclxuICAgICAgICAgICAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ3RleHQvaHRtbCcpLnNlbmQoaHRtbClcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcblx0XHRcdHJldHVybiByZXMuc3RhdHVzKDQwMCkuc2VuZCh7bWVzc2FnZTogJ0Vycm9yIHRyeSBhZ2FpbiEnfSk7XHJcblx0XHR9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGFzeW5jIHJlc2V0UEFzc3dvcmQocmVxLCByZXMpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBlcnJvcnMgPSB2YWxpZGF0aW9uUmVzdWx0KHJlcSk7XHJcbiAgICAgICAgICAgIGlmICghZXJyb3JzLmlzRW1wdHkoKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDIyKS5qc29uKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvcnMubXNnLFxyXG4gICAgICAgICAgICAgICAgICAgIGVycm9yczogZXJyb3JzLmVycm9yc1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGtleSA9IHJlcS5wYXJhbXMua2V5O1xyXG5cclxuXHRcdFx0Y29uc3Qgc3J2UmVzID0gYXdhaXQgU2VydmljZS5yZXNldFBBc3N3b3JkKGtleSwgcmVxLmJvZHkpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyhzcnZSZXMuc3RhdHVzQ29kZSkuanNvbih7IHNydlJlcyB9KTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcblx0XHRcdHJldHVybiByZXMuc3RhdHVzKDQwMCkuc2VuZCh7bWVzc2FnZTogZS5tZXNzYWdlfSk7XHJcblx0XHR9XHJcbiAgICB9XHJcblxyXG59Il19