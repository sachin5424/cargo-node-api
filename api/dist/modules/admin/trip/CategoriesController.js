"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _expressValidator = require("express-validator");

var _index = require("../../../data-base/index");

var _test = require("../../../services/test");

var _helper = require("../../../utls/_helper");

class CategoriesController {
  static async addVehicalCategorie(req, res) {
    try {
      const errors = (0, _expressValidator.validationResult)(req);

      if (!errors.isEmpty()) {
        return res.status(422).json({
          message: errors.msg,
          errors: errors.errors
        });
      } else {
        const payload = req.body;
        const userRequest = req;
        let logData = {
          name: payload.name,
          icon: payload.icon,
          isdeleted: 0,
          active: 1
        };
        let options = {
          name: payload.name,
          icon: payload.icon,
          isdeleted: 0,
          active: 1,
          slug: (0, _helper.slug)(payload.name),
          activeLog: [{
            userId: userRequest.userId,
            method: 'POST',
            newData: JSON.stringify(logData)
          }]
        };
        await (0, _test.createData)(_index.tripCategorieModel, options);
        return res.status(200).json({
          message: "create vehicale categoires"
        });
      }
    } catch (error) {
      return res.status(200).json({
        error
      });
    }
  }

  static async getVehicalCategorie(req, res) {
    try {
      const _id = req.query.id;
      const logs = req.query.logs;
      const getquery = req.query;
      let select = '';
      logs ? '' : select = '-activeLog';
      let query = {
        select: select
      };
      let options = {
        page: getquery.page ? parseInt(getquery.page) : 1,
        limit: getquery.limit ? parseInt(getquery.limit) : 50,
        sort: {
          _id: -1
        }
      }; // const data = await  tripCategorieModel.find(query).select(select)

      const data = await (0, _test.listPaginate)(_index.tripCategorieModel, query, options);
      return res.status(200).json({
        data
      });
    } catch (error) {
      return res.status(500).json({
        error
      });
    }
  }

  static async detailsVehicalCategorie(req, res) {
    try {
      const _id = req.params.id;
      const data = await _index.tripCategorieModel.findOne({
        _id
      });
      return res.status(200).json({
        data
      });
    } catch (error) {
      return res.status(500).json({
        error
      });
    }
  }

  static async updateVehicalCategorie(req, res) {
    try {
      const errors = (0, _expressValidator.validationResult)(req);

      if (!errors.isEmpty()) {
        return res.status(422).json({
          message: errors.msg,
          errors: errors.errors
        });
      } else {
        const _id = req.params.id;
        const payload = req.body;

        if (payload) {
          const test_select = Object.keys(payload);
          const chech_data = await _index.tripCategorieModel.findOne({
            _id
          }).select(test_select);
          const userRequest = req;
          let update = [{
            userId: userRequest.userId,
            method: 'UPDATE',
            oldData: JSON.stringify(chech_data),
            newData: JSON.stringify(payload)
          }];
          await _index.tripCategorieModel.updateOne({
            _id
          }, payload);
          await _index.tripCategorieModel.updateOne({
            _id
          }, {
            $push: {
              activeLog: update
            }
          });
        }

        return res.status(200).json({
          message: "update data"
        });
      }
    } catch (error) {
      return res.status(500).json({
        error
      });
    }
  }

  static async deleteVehicalCategorie(req, res) {
    try {
      const _id = req.params.id;
      const payload = req.body;
      const userRequest = req;
      let update = [{
        userId: userRequest.userId,
        method: 'DELETED',
        newData: JSON.stringify(payload)
      }];
      await _index.tripCategorieModel.updateOne({
        _id
      }, {
        isdeleted: 1
      });
      await _index.tripCategorieModel.updateOne({
        _id
      });
      return res.status(200).json({
        message: "delete data"
      });
    } catch (error) {
      return res.status(500).json({
        error
      });
    }
  }

}

exports.default = CategoriesController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9tb2R1bGVzL2FkbWluL3RyaXAvQ2F0ZWdvcmllc0NvbnRyb2xsZXIuanMiXSwibmFtZXMiOlsiQ2F0ZWdvcmllc0NvbnRyb2xsZXIiLCJhZGRWZWhpY2FsQ2F0ZWdvcmllIiwicmVxIiwicmVzIiwiZXJyb3JzIiwiaXNFbXB0eSIsInN0YXR1cyIsImpzb24iLCJtZXNzYWdlIiwibXNnIiwicGF5bG9hZCIsImJvZHkiLCJ1c2VyUmVxdWVzdCIsImxvZ0RhdGEiLCJuYW1lIiwiaWNvbiIsImlzZGVsZXRlZCIsImFjdGl2ZSIsIm9wdGlvbnMiLCJzbHVnIiwiYWN0aXZlTG9nIiwidXNlcklkIiwibWV0aG9kIiwibmV3RGF0YSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0cmlwQ2F0ZWdvcmllTW9kZWwiLCJlcnJvciIsImdldFZlaGljYWxDYXRlZ29yaWUiLCJfaWQiLCJxdWVyeSIsImlkIiwibG9ncyIsImdldHF1ZXJ5Iiwic2VsZWN0IiwicGFnZSIsInBhcnNlSW50IiwibGltaXQiLCJzb3J0IiwiZGF0YSIsImRldGFpbHNWZWhpY2FsQ2F0ZWdvcmllIiwicGFyYW1zIiwiZmluZE9uZSIsInVwZGF0ZVZlaGljYWxDYXRlZ29yaWUiLCJ0ZXN0X3NlbGVjdCIsIk9iamVjdCIsImtleXMiLCJjaGVjaF9kYXRhIiwidXBkYXRlIiwib2xkRGF0YSIsInVwZGF0ZU9uZSIsIiRwdXNoIiwiZGVsZXRlVmVoaWNhbENhdGVnb3JpZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUVlLE1BQU1BLG9CQUFOLENBQTJCO0FBRU4sZUFBbkJDLG1CQUFtQixDQUFDQyxHQUFELEVBQU1DLEdBQU4sRUFBVztBQUN2QyxRQUFJO0FBQ0EsWUFBTUMsTUFBTSxHQUFHLHdDQUFpQkYsR0FBakIsQ0FBZjs7QUFDQSxVQUFJLENBQUNFLE1BQU0sQ0FBQ0MsT0FBUCxFQUFMLEVBQXVCO0FBQ25CLGVBQU9GLEdBQUcsQ0FBQ0cs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eUIsc0JBQXNCLENBQUNsRCxHQUFELEVBQU1DLEdBQU4sRUFBVztBQUMxQyxRQUFJO0FBQ0EsWUFBTTBCLEdBQUcsR0FBRzNCLEdBQUcsQ0FBQ3VDLE1BQUosQ0FBV1YsRUFBdkI7QUFDQSxZQUFNckIsT0FBTyxHQUFHUixHQUFHLENBQUNTLElBQXBCO0FBQ0EsWUFBTUMsV0FBVyxHQUFHVixHQUFwQjtBQUNBLFVBQUk4QyxNQUFNLEdBQUcsQ0FDVDtBQUNJM0IsUUFBQUEsTUFBTSxFQUFFVCxXQUFXLENBQUNTLE1BRHhCO0FBRUlDLFFBQUFBLE1BQU0sRUFBRSxTQUZaO0FBR0lDLFFBQUFBLE9BQU8sRUFBRUMsSUFBSSxDQUFDQyxTQUFMLENBQWVmLE9BQWY7QUFIYixPQURTLENBQWI7QUFPQSxZQUFNZ0IsMEJBQW1Cd0IsU0FBbkIsQ0FBNkI7QUFBRXJCLFFBQUFBO0FBQUYsT0FBN0IsRUFBc0M7QUFBRWIsUUFBQUEsU0FBUyxFQUFFO0FBQWIsT0FBdEMsQ0FBTjtBQUNBLFlBQU1VLDBCQUFtQndCLFNBQW5CLENBQTZCO0FBQUVyQixRQUFBQTtBQUFGLE9BQTdCLENBQU47QUFDQSxhQUFPMUIsR0FBRyxDQUFDRyxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUI7QUFBRUMsUUFBQUEsT0FBTyxFQUFFO0FBQVgsT0FBckIsQ0FBUDtBQUNILEtBZEQsQ0FlQSxPQUFPbUIsS0FBUCxFQUFjO0FBQ1YsYUFBT3hCLEdBQUcsQ0FBQ0csTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCO0FBQUVvQixRQUFBQTtBQUFGLE9BQXJCLENBQVA7QUFDSDtBQUNKOztBQWxJcUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB2YWxpZGF0aW9uUmVzdWx0IH0gZnJvbSAnZXhwcmVzcy12YWxpZGF0b3InO1xyXG5pbXBvcnQgeyB0cmlwQ2F0ZWdvcmllTW9kZWwgfSBmcm9tICcuLi8uLi8uLi9kYXRhLWJhc2UvaW5kZXgnO1xyXG5pbXBvcnQgeyBjcmVhdGVEYXRhLCBsaXN0UGFnaW5hdGUgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy90ZXN0JztcclxuaW1wb3J0IHsgc2x1ZyB9IGZyb20gJy4uLy4uLy4uL3V0bHMvX2hlbHBlcic7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDYXRlZ29yaWVzQ29udHJvbGxlciB7XHJcbiAgICBcclxuICAgIHN0YXRpYyBhc3luYyBhZGRWZWhpY2FsQ2F0ZWdvcmllKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgZXJyb3JzID0gdmFsaWRhdGlvblJlc3VsdChyZXEpO1xyXG4gICAgICAgICAgICBpZiAoIWVycm9ycy5pc0VtcHR5KCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQyMikuanNvbih7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3JzLm1zZyxcclxuICAgICAgICAgICAgICAgICAgICBlcnJvcnM6IGVycm9ycy5lcnJvcnNcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHJlcS5ib2R5O1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdXNlclJlcXVlc3QgPSByZXE7XHJcbiAgICAgICAgICAgICAgICBsZXQgbG9nRGF0YSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBwYXlsb2FkLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogcGF5bG9hZC5pY29uLFxyXG4gICAgICAgICAgICAgICAgICAgIGlzZGVsZXRlZDogMCxcclxuICAgICAgICAgICAgICAgICAgICBhY3RpdmU6IDEsXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgbGV0IG9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogcGF5bG9hZC5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIGljb246IHBheWxvYWQuaWNvbixcclxuICAgICAgICAgICAgICAgICAgICBpc2RlbGV0ZWQ6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIHNsdWc6IHNsdWcocGF5bG9hZC5uYW1lKSxcclxuICAgICAgICAgICAgICAgICAgICBhY3RpdmVMb2c6IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklkOiB1c2VyUmVxdWVzdC51c2VySWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0RhdGE6IEpTT04uc3RyaW5naWZ5KGxvZ0RhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgY3JlYXRlRGF0YSh0cmlwQ2F0ZWdvcmllTW9kZWwsIG9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgbWVzc2FnZTogXCJjcmVhdGUgdmVoaWNhbGUgY2F0ZWdvaXJlc1wiIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBlcnJvciB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgYXN5bmMgZ2V0VmVoaWNhbENhdGVnb3JpZShyZXEsIHJlcykge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IF9pZCA9IHJlcS5xdWVyeS5pZDtcclxuICAgICAgICAgICAgY29uc3QgbG9ncyA9IHJlcS5xdWVyeS5sb2dzO1xyXG4gICAgICAgICAgICBjb25zdCBnZXRxdWVyeSA9IHJlcS5xdWVyeTtcclxuICAgICAgICAgICAgbGV0IHNlbGVjdCA9ICcnO1xyXG4gICAgICAgICAgICBsb2dzID8gJycgOiBzZWxlY3QgPSAnLWFjdGl2ZUxvZyc7XHJcbiAgICAgICAgICAgIGxldCBxdWVyeSA9IHtcclxuICAgICAgICAgICAgICAgIHNlbGVjdDogc2VsZWN0XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGxldCBvcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgcGFnZTogZ2V0cXVlcnkucGFnZSA/IHBhcnNlSW50KGdldHF1ZXJ5LnBhZ2UpIDogMSxcclxuICAgICAgICAgICAgICAgIGxpbWl0OiBnZXRxdWVyeS5saW1pdCA/IHBhcnNlSW50KGdldHF1ZXJ5LmxpbWl0KSA6IDUwLFxyXG4gICAgICAgICAgICAgICAgc29ydDoge1xyXG4gICAgICAgICAgICAgICAgICAgIF9pZDogLTFcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgLy8gY29uc3QgZGF0YSA9IGF3YWl0ICB0cmlwQ2F0ZWdvcmllTW9kZWwuZmluZChxdWVyeSkuc2VsZWN0KHNlbGVjdClcclxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGxpc3RQYWdpbmF0ZSh0cmlwQ2F0ZWdvcmllTW9kZWwsIHF1ZXJ5LCBvcHRpb25zKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgZGF0YSB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHN0YXRpYyBhc3luYyBkZXRhaWxzVmVoaWNhbENhdGVnb3JpZShyZXEsIHJlcykge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IF9pZCA9IHJlcS5wYXJhbXMuaWQ7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0cmlwQ2F0ZWdvcmllTW9kZWwuZmluZE9uZSh7IF9pZCB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgZGF0YSB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHN0YXRpYyBhc3luYyB1cGRhdGVWZWhpY2FsQ2F0ZWdvcmllKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgZXJyb3JzID0gdmFsaWRhdGlvblJlc3VsdChyZXEpO1xyXG4gICAgICAgICAgICBpZiAoIWVycm9ycy5pc0VtcHR5KCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQyMikuanNvbih7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3JzLm1zZyxcclxuICAgICAgICAgICAgICAgICAgICBlcnJvcnM6IGVycm9ycy5lcnJvcnNcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgX2lkID0gcmVxLnBhcmFtcy5pZDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSByZXEuYm9keTtcclxuICAgICAgICAgICAgICAgIGlmIChwYXlsb2FkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGVzdF9zZWxlY3QgPSBPYmplY3Qua2V5cyhwYXlsb2FkKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGVjaF9kYXRhID0gYXdhaXQgdHJpcENhdGVnb3JpZU1vZGVsLmZpbmRPbmUoeyBfaWQgfSkuc2VsZWN0KHRlc3Rfc2VsZWN0KTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB1c2VyUmVxdWVzdCA9IHJlcTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgdXBkYXRlID0gW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJSZXF1ZXN0LnVzZXJJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1VQREFURScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGREYXRhOiBKU09OLnN0cmluZ2lmeShjaGVjaF9kYXRhKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0RhdGE6IEpTT04uc3RyaW5naWZ5KHBheWxvYWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRyaXBDYXRlZ29yaWVNb2RlbC51cGRhdGVPbmUoeyBfaWQgfSwgcGF5bG9hZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdHJpcENhdGVnb3JpZU1vZGVsLnVwZGF0ZU9uZSh7IF9pZCB9LCB7ICRwdXNoOiB7IGFjdGl2ZUxvZzogdXBkYXRlIH0gfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBtZXNzYWdlOiBcInVwZGF0ZSBkYXRhXCIgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHN0YXRpYyBhc3luYyBkZWxldGVWZWhpY2FsQ2F0ZWdvcmllKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgX2lkID0gcmVxLnBhcmFtcy5pZDtcclxuICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHJlcS5ib2R5O1xyXG4gICAgICAgICAgICBjb25zdCB1c2VyUmVxdWVzdCA9IHJlcTtcclxuICAgICAgICAgICAgbGV0IHVwZGF0ZSA9IFtcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJSZXF1ZXN0LnVzZXJJZCxcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdERUxFVEVEJyxcclxuICAgICAgICAgICAgICAgICAgICBuZXdEYXRhOiBKU09OLnN0cmluZ2lmeShwYXlsb2FkKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICBhd2FpdCB0cmlwQ2F0ZWdvcmllTW9kZWwudXBkYXRlT25lKHsgX2lkIH0sIHsgaXNkZWxldGVkOiAxIH0pO1xyXG4gICAgICAgICAgICBhd2FpdCB0cmlwQ2F0ZWdvcmllTW9kZWwudXBkYXRlT25lKHsgX2lkIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBtZXNzYWdlOiBcImRlbGV0ZSBkYXRhXCIgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvciB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iXX0=