"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.userValidation = exports.userLoginValidation = void 0;

var _import = require("../settings/import");

var _dataBase = require("../data-base");

var _state = _interopRequireDefault(require("../data-base/models/state"));

var _district = _interopRequireDefault(require("../data-base/models/district"));

var _taluk = _interopRequireDefault(require("../data-base/models/taluk"));

var _helper = require("../utls/_helper");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

const userLoginValidation = [(0, _import.check)('email').notEmpty().withMessage("Email is required").isEmail().withMessage("Provide a valid email").custom(async v => {
  try {
    const r = await _dataBase.UserModel.findOne({
      email: v,
      isDeleted: false
    });

    if (!r) {
      throw new Error("Data not found");
    }
  } catch (e) {
    throw new Error("Email is not registered");
  }
}), (0, _import.check)('password').notEmpty().withMessage("Password is required")];
exports.userLoginValidation = userLoginValidation;
const userValidation = [(0, _import.check)('_id').optional().notEmpty().withMessage("Provide / Select a valid data").custom(async v => {
  try {
    const r = await _dataBase.UserModel.findOne(_objectSpread({
      _id: v,
      isDeleted: false
    }, (0, _helper.getAdminFilter)()));

    if (!r) {
      throw new Error("Data not found");
    }
  } catch (e) {
    throw new Error("This data does not exit. Please check or refresh");
  }
}), (0, _import.check)('firstName').notEmpty().withMessage("The 'First Name' field is required").isString().withMessage("The 'First Name' field is not valid"), (0, _import.check)('lastName').notEmpty().withMessage("The 'Last Name' field is required").isString().withMessage("The 'Last Name' field is not valid"), (0, _import.check)('phoneNo').notEmpty().withMessage("The 'Phone Number' field is required").matches(/^[3-9]{1}[0-9]{9}$/).withMessage("The 'Phone Number' field is not valid").custom(async (value, {
  req
}) => {
  const body = req.body;
  const result = await _dataBase.UserModel.findOne({
    isDeleted: false,
    phoneNo: value
  });

  if (result) {
    if (body._id) {
      if (result._id != body._id) {
        throw new Error("A user already exist with this phone number");
      }
    } else {
      throw new Error("A user already exist with this phone number");
    }
  }
}), (0, _import.check)('email').notEmpty().withMessage("The 'Email' field is required").isEmail().withMessage("The 'Email' field is not valid").custom(async (value, {
  req
}) => {
  const body = req.body;
  const result = await _dataBase.UserModel.findOne({
    isDeleted: false,
    email: value
  });

  if (result) {
    if (body._id) {
      if (result._id != body._id) {
        throw new Error("A user already exist with this email");
      }
    } else {
      throw new Error("A user already exist with this email");
    }
  }
}), (0, _import.check)('password').custom((v, {
  req
}) => {
  if (!req.body._id) {
    if (!req.body.password) {
      throw new Error("The 'Password' field is required");
    }
  }

  return true;
}), (0, _import.check)('dob').notEmpty().withMessage("The 'Date of Birth' field is required").matches(/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])$/).withMessage("The 'Date of Birth' field is not valid"), (0, _import.check)('photo').custom((v, {
  req
}) => {
  if (!req.body._id) {
    if (!req.body.photo) {
      throw new Error("The 'Photo' field is required");
    }
  }

  return true;
}).optional().matches(/data:image\/[^;]+;base64[^"]+/).withMessage("Photo is not an image"), (0, _import.check)('type').notEmpty().withMessage("The 'User Type' field is required").isIn(['stateAdmin', 'districtAdmin', 'talukAdmin']).withMessage("The 'User Type' field is not valid"), (0, _import.check)('address').notEmpty().withMessage("The 'Address' field is required").isString().withMessage("The 'Address' field is not valid"), (0, _import.check)('state').optional().notEmpty().withMessage("'State' field is required").custom(async value => {
  try {
    const result = await _state.default.findById(value);

    if (!result) {
      throw new Error("Data not found");
    }
  } catch (e) {
    throw new Error("'State' field is not valid");
  }
}), (0, _import.check)('district').optional().notEmpty().withMessage("'District' is required").custom(async (value, {
  req
}) => {
  try {
    const result = await _district.default.findById(value);

    if (!result) {
      throw new Error("Data not found");
    }

    req.body.state = result.state;
  } catch (e) {
    throw new Error("'District' is not valid");
  }
}), (0, _import.check)('taluk').optional().notEmpty().withMessage("'Taluk' field is required").custom(async (value, {
  req
}) => {
  try {
    const result = await _taluk.default.findById(value);

    if (!result) {
      throw new Error("Data not found");
    }

    req.body.district = result.district;
    const resultDistrict = await _district.default.findById(result.district);
    req.body.state = resultDistrict.state;
  } catch (e) {
    throw new Error("'Taluk' field is not valid");
  }
}), (0, _import.check)('zipcode').notEmpty().withMessage("The 'Zipcode' field is required").matches(/^[1-9]{1}[0-9]{5}$/).withMessage("The 'Zipcode' field is not valid"), (0, _import.check)('adharNo').notEmpty().withMessage("The 'Adhar Number' field is required") // .matches(/^[2-9]{1}[0-9]{3}[0-9]{4}[0-9]{4}$/).withMessage("The 'Adhar Number' field is not valid")
.custom(async (value, {
  req
}) => {
  const body = req.body;
  const result = await _dataBase.UserModel.findOne({
    adharNo: value
  });

  if (result) {
    if (body._id) {
      if (result._id != body._id) {
        throw new Error("A user already exist with this adhar number");
      }
    } else {
      throw new Error("A user already exist with this adhar number");
    }
  }
}), (0, _import.check)('adharCardPhoto').custom((v, {
  req
}) => {
  if (!req.body._id) {
    if (!req.body.adharCardPhoto) {
      throw new Error("The 'Adhar Card Photo' field is required");
    }
  }

  return true;
}).optional().matches(/data:image\/[^;]+;base64[^"]+/).withMessage("Adhar Card Photo is not an image"), (0, _import.check)('panNo').notEmpty().withMessage("The 'Pan Number' field is required") // .matches(/[A-Z]{5}[0-9]{4}[A-Z]{1}$/).withMessage("The 'Pan Number' field is not valid")
.custom(async (value, {
  req
}) => {
  const body = req.body;
  const result = await _dataBase.UserModel.findOne({
    panNo: value
  });

  if (result) {
    if (body._id) {
      if (result._id != body._id) {
        throw new Error("A user already exist with this pan number");
      }
    } else {
      throw new Error("A user already exist with this pan number");
    }
  }
}), (0, _import.check)('panCardPhoto').custom((v, {
  req
}) => {
  if (!req.body._id) {
    if (!req.body.panCardPhoto) {
      throw new Error("The 'Pan Card Photo' field is required");
    }
  }

  return true;
}).optional().matches(/data:image\/[^;]+;base64[^"]+/).withMessage("Pan Card Photo is not an image"), (0, _import.check)('isActive').notEmpty().withMessage("The 'active' field is required").toBoolean(1 ? true : false)];
exports.userValidation = userValidation;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy92YWxpZGF0aW9uL1VzZXJWYWxpZGF0aW9ucy5qcyJdLCJuYW1lcyI6WyJ1c2VyTG9naW5WYWxpZGF0aW9uIiwibm90RW1wdHkiLCJ3aXRoTWVzc2FnZSIsImlzRW1haWwiLCJjdXN0b20iLCJ2IiwiciIsIlVzZXJNb2RlbCIsImZpbmRPbmUiLCJlbWFpbCIsImlzRGVsZXRlZCIsIkVycm9yIiwiZSIsInVzZXJWYWxpZGF0aW9uIiwib3B0aW9uYWwiLCJfaWQiLCJpc1N0cmluZyIsIm1hdGNoZXMiLCJ2YWx1ZSIsInJlcSIsImJvZHkiLCJyZXN1bHQiLCJwaG9uZU5vIiwicGFzc3dvcmQiLCJwaG90byIsImlzSW4iLCJTdGF0ZU1vZGVsIiwiZmluZEJ5SWQiLCJEaXN0cmljdE1vZGVsIiwic3RhdGUiLCJUYWx1a01vZGVsIiwiZGlzdHJpY3QiLCJyZXN1bHREaXN0cmljdCIsImFkaGFyTm8iLCJhZGhhckNhcmRQaG90byIsInBhbk5vIiwicGFuQ2FyZFBob3RvIiwidG9Cb29sZWFuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7QUFFTyxNQUFNQSxtQkFBbUIsR0FBRyxDQUMvQixtQkFBTSxPQUFOLEVBQ0tDLFFBREwsR0FDZ0JDLFdBRGhCLENBQzRCLG1CQUQ1QixFQUVLQyxPQUZMLEdBRWVELFdBRmYsQ0FFMkIsdUJBRjNCLEVBR0tFLE1BSEwsQ0FHWSxNQUFPQyxDQUFQLElBQWE7QUFDakIsTUFBSTtBQUNBLFVBQU1DLENBQUMsR0FBRyxNQUFNQyxvQkFBVUMsT0FBVixDQUFrQjtBQUFFQyxNQUFBQSxLQUFLLEVBQUVKLENBQVQ7QUFBWUssTUFBQUEsU0FBUyxFQUFFO0FBQXZCLEtBQWxCLENBQWhCOztBQUNBLFFBQUksQ0FBQ0osQ0FBTCxFQUFRO0FBQ0osWUFBTSxJQUFJSyxLQUFKLENBQVUsZ0JBQVYsQ0FBTjtBQUNIO0FBQ0osR0FMRCxDQUtFLE9BQU9DLENB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QVUsMkNBQVYsQ0FBTjtBQUNIO0FBQ0o7QUFFSixDQWxCTCxDQS9LMEIsRUFtTTFCLG1CQUFNLGNBQU4sRUFDS1AsTUFETCxDQUNZLENBQUNDLENBQUQsRUFBSTtBQUFFYyxFQUFBQTtBQUFGLENBQUosS0FBZ0I7QUFDcEIsTUFBSSxDQUFDQSxHQUFHLENBQUNDLElBQUosQ0FBU0wsR0FBZCxFQUFtQjtBQUNmLFFBQUksQ0FBQ0ksR0FBRyxDQUFDQyxJQUFKLENBQVNnQixZQUFkLEVBQTRCO0FBQ3hCLFlBQU0sSUFBSXpCLEtBQUosQ0FBVSx3Q0FBVixDQUFOO0FBQ0g7QUFDSjs7QUFDRCxTQUFPLElBQVA7QUFDSCxDQVJMLEVBU0tHLFFBVEwsR0FVS0csT0FWTCxDQVVhLCtCQVZiLEVBVThDZixXQVY5QyxDQVUwRCxnQ0FWMUQsQ0FuTTBCLEVBK00xQixtQkFBTSxVQUFOLEVBQ0lELFFBREosR0FDZUMsV0FEZixDQUMyQixnQ0FEM0IsRUFFS21DLFNBRkwsQ0FFZSxJQUFJLElBQUosR0FBVyxLQUYxQixDQS9NMEIsQ0FBdkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjaGVjayB9IGZyb20gJy4uL3NldHRpbmdzL2ltcG9ydCc7XHJcbmltcG9ydCB7IFVzZXJNb2RlbCB9IGZyb20gJy4uL2RhdGEtYmFzZSc7XHJcbmltcG9ydCBTdGF0ZU1vZGVsIGZyb20gJy4uL2RhdGEtYmFzZS9tb2RlbHMvc3RhdGUnO1xyXG5pbXBvcnQgRGlzdHJpY3RNb2RlbCBmcm9tICcuLi9kYXRhLWJhc2UvbW9kZWxzL2Rpc3RyaWN0JztcclxuaW1wb3J0IFRhbHVrTW9kZWwgZnJvbSAnLi4vZGF0YS1iYXNlL21vZGVscy90YWx1ayc7XHJcbmltcG9ydCB7IGdldEFkbWluRmlsdGVyIH0gZnJvbSAnLi4vdXRscy9faGVscGVyJztcclxuXHJcbmV4cG9ydCBjb25zdCB1c2VyTG9naW5WYWxpZGF0aW9uID0gW1xyXG4gICAgY2hlY2soJ2VtYWlsJylcclxuICAgICAgICAubm90RW1wdHkoKS53aXRoTWVzc2FnZShcIkVtYWlsIGlzIHJlcXVpcmVkXCIpXHJcbiAgICAgICAgLmlzRW1haWwoKS53aXRoTWVzc2FnZShcIlByb3ZpZGUgYSB2YWxpZCBlbWFpbFwiKVxyXG4gICAgICAgIC5jdXN0b20oYXN5bmMgKHYpID0+IHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBhd2FpdCBVc2VyTW9kZWwuZmluZE9uZSh7IGVtYWlsOiB2LCBpc0RlbGV0ZWQ6IGZhbHNlIH0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YSBub3QgZm91bmRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkVtYWlsIGlzIG5vdCByZWdpc3RlcmVkXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSksXHJcblxyXG4gICAgY2hlY2soJ3Bhc3N3b3JkJylcclxuICAgICAgICAubm90RW1wdHkoKS53aXRoTWVzc2FnZShcIlBhc3N3b3JkIGlzIHJlcXVpcmVkXCIpLFxyXG5cclxuXTtcclxuXHJcbmV4cG9ydCBjb25zdCB1c2VyVmFsaWRhdGlvbiA9IFtcclxuXHJcbiAgICBjaGVjaygnX2lkJylcclxuICAgICAgICAub3B0aW9uYWwoKVxyXG4gICAgICAgIC5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKFwiUHJvdmlkZSAvIFNlbGVjdCBhIHZhbGlkIGRhdGFcIilcclxuICAgICAgICAuY3VzdG9tKGFzeW5jICh2KSA9PiB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByID0gYXdhaXQgVXNlck1vZGVsLmZpbmRPbmUoe19pZDogdiwgaXNEZWxldGVkOiBmYWxzZSwgLi4uZ2V0QWRtaW5GaWx0ZXIoKX0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YSBub3QgZm91bmRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoaXMgZGF0YSBkb2VzIG5vdCBleGl0LiBQbGVhc2UgY2hlY2sgb3IgcmVmcmVzaFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pLFxyXG5cclxuICAgIGNoZWNrKCdmaXJzdE5hbWUnKVxyXG4gICAgICAgIC5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKFwiVGhlICdGaXJzdCBOYW1lJyBmaWVsZCBpcyByZXF1aXJlZFwiKVxyXG4gICAgICAgIC5pc1N0cmluZygpLndpdGhNZXNzYWdlKFwiVGhlICdGaXJzdCBOYW1lJyBmaWVsZCBpcyBub3QgdmFsaWRcIiksXHJcblxyXG4gICAgY2hlY2soJ2xhc3ROYW1lJylcclxuICAgICAgICAubm90RW1wdHkoKS53aXRoTWVzc2FnZShcIlRoZSAnTGFzdCBOYW1lJyBmaWVsZCBpcyByZXF1aXJlZFwiKVxyXG4gICAgICAgIC5pc1N0cmluZygpLndpdGhNZXNzYWdlKFwiVGhlICdMYXN0IE5hbWUnIGZpZWxkIGlzIG5vdCB2YWxpZFwiKSxcclxuXHJcbiAgICBjaGVjaygncGhvbmVObycpXHJcbiAgICAgICAgLm5vdEVtcHR5KCkud2l0aE1lc3NhZ2UoXCJUaGUgJ1Bob25lIE51bWJlcicgZmllbGQgaXMgcmVxdWlyZWRcIilcclxuICAgICAgICAubWF0Y2hlcygvXlszLTldezF9WzAtOV17OX0kLykud2l0aE1lc3NhZ2UoXCJUaGUgJ1Bob25lIE51bWJlcicgZmllbGQgaXMgbm90IHZhbGlkXCIpXHJcbiAgICAgICAgLmN1c3RvbShhc3luYyAodmFsdWUsIHsgcmVxIH0pID0+IHtcclxuICAgICAgICAgICAgY29uc3QgYm9keSA9IHJlcS5ib2R5O1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBVc2VyTW9kZWwuZmluZE9uZSh7IGlzRGVsZXRlZDogZmFsc2UsIHBob25lTm86IHZhbHVlIH0pO1xyXG4gICAgICAgICAgICBpZiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYm9keS5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0Ll9pZCAhPSBib2R5Ll9pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBIHVzZXIgYWxyZWFkeSBleGlzdCB3aXRoIHRoaXMgcGhvbmUgbnVtYmVyXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQSB1c2VyIGFscmVhZHkgZXhpc3Qgd2l0aCB0aGlzIHBob25lIG51bWJlclwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pLFxyXG5cclxuICAgIGNoZWNrKCdlbWFpbCcpXHJcbiAgICAgICAgLm5vdEVtcHR5KCkud2l0aE1lc3NhZ2UoXCJUaGUgJ0VtYWlsJyBmaWVsZCBpcyByZXF1aXJlZFwiKVxyXG4gICAgICAgIC5pc0VtYWlsKCkud2l0aE1lc3NhZ2UoXCJUaGUgJ0VtYWlsJyBmaWVsZCBpcyBub3QgdmFsaWRcIilcclxuICAgICAgICAuY3VzdG9tKGFzeW5jICh2YWx1ZSwgeyByZXEgfSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBib2R5ID0gcmVxLmJvZHk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFVzZXJNb2RlbC5maW5kT25lKHsgaXNEZWxldGVkOiBmYWxzZSwgZW1haWw6IHZhbHVlIH0pO1xyXG4gICAgICAgICAgICBpZiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYm9keS5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0Ll9pZCAhPSBib2R5Ll9pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBIHVzZXIgYWxyZWFkeSBleGlzdCB3aXRoIHRoaXMgZW1haWxcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBIHVzZXIgYWxyZWFkeSBleGlzdCB3aXRoIHRoaXMgZW1haWxcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KSxcclxuXHJcbiAgICBjaGVjaygncGFzc3dvcmQnKVxyXG4gICAgICAgIC5jdXN0b20oKHYsIHsgcmVxIH0pID0+IHtcclxuICAgICAgICAgICAgaWYgKCFyZXEuYm9keS5faWQpIHtcclxuICAgICAgICAgICAgICAgIGlmICghcmVxLmJvZHkucGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgJ1Bhc3N3b3JkJyBmaWVsZCBpcyByZXF1aXJlZFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9KSxcclxuXHJcbiAgICBjaGVjaygnZG9iJylcclxuICAgICAgICAubm90RW1wdHkoKS53aXRoTWVzc2FnZShcIlRoZSAnRGF0ZSBvZiBCaXJ0aCcgZmllbGQgaXMgcmVxdWlyZWRcIilcclxuICAgICAgICAubWF0Y2hlcygvXlxcZHs0fS0oMFsxLTldfDFbMC0yXSktKDBbMS05XXxbMTJdWzAtOV18M1swMV0pJC8pLndpdGhNZXNzYWdlKFwiVGhlICdEYXRlIG9mIEJpcnRoJyBmaWVsZCBpcyBub3QgdmFsaWRcIiksXHJcblxyXG4gICAgY2hlY2soJ3Bob3RvJylcclxuICAgICAgICAuY3VzdG9tKCh2LCB7IHJlcSB9KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghcmVxLmJvZHkuX2lkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlcS5ib2R5LnBob3RvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlICdQaG90bycgZmllbGQgaXMgcmVxdWlyZWRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAub3B0aW9uYWwoKVxyXG4gICAgICAgIC5tYXRjaGVzKC9kYXRhOmltYWdlXFwvW147XSs7YmFzZTY0W15cIl0rLykud2l0aE1lc3NhZ2UoXCJQaG90byBpcyBub3QgYW4gaW1hZ2VcIiksXHJcblxyXG4gICAgY2hlY2soJ3R5cGUnKVxyXG4gICAgICAgIC5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKFwiVGhlICdVc2VyIFR5cGUnIGZpZWxkIGlzIHJlcXVpcmVkXCIpXHJcbiAgICAgICAgLmlzSW4oWydzdGF0ZUFkbWluJywgJ2Rpc3RyaWN0QWRtaW4nLCAndGFsdWtBZG1pbiddKS53aXRoTWVzc2FnZShcIlRoZSAnVXNlciBUeXBlJyBmaWVsZCBpcyBub3QgdmFsaWRcIiksXHJcblxyXG4gICAgY2hlY2soJ2FkZHJlc3MnKVxyXG4gICAgICAgIC5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKFwiVGhlICdBZGRyZXNzJyBmaWVsZCBpcyByZXF1aXJlZFwiKVxyXG4gICAgICAgIC5pc1N0cmluZygpLndpdGhNZXNzYWdlKFwiVGhlICdBZGRyZXNzJyBmaWVsZCBpcyBub3QgdmFsaWRcIiksXHJcblxyXG4gICAgY2hlY2soJ3N0YXRlJylcclxuICAgICAgICAub3B0aW9uYWwoKVxyXG4gICAgICAgIC5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKFwiJ1N0YXRlJyBmaWVsZCBpcyByZXF1aXJlZFwiKVxyXG4gICAgICAgIC5jdXN0b20oYXN5bmMgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBTdGF0ZU1vZGVsLmZpbmRCeUlkKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGlmICghcmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YSBub3QgZm91bmRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIidTdGF0ZScgZmllbGQgaXMgbm90IHZhbGlkXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSksXHJcblxyXG4gICAgY2hlY2soJ2Rpc3RyaWN0JylcclxuICAgICAgICAub3B0aW9uYWwoKVxyXG4gICAgICAgIC5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKFwiJ0Rpc3RyaWN0JyBpcyByZXF1aXJlZFwiKVxyXG4gICAgICAgIC5jdXN0b20oYXN5bmMgKHZhbHVlLCB7cmVxfSkgPT4ge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRGlzdHJpY3RNb2RlbC5maW5kQnlJZCh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGEgbm90IGZvdW5kXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmVxLmJvZHkuc3RhdGUgPSByZXN1bHQuc3RhdGU7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIidEaXN0cmljdCcgaXMgbm90IHZhbGlkXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSksXHJcblxyXG4gICAgY2hlY2soJ3RhbHVrJylcclxuICAgICAgICAub3B0aW9uYWwoKVxyXG4gICAgICAgIC5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKFwiJ1RhbHVrJyBmaWVsZCBpcyByZXF1aXJlZFwiKVxyXG4gICAgICAgIC5jdXN0b20oYXN5bmMgKHZhbHVlLCB7cmVxfSkgPT4ge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgVGFsdWtNb2RlbC5maW5kQnlJZCh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGEgbm90IGZvdW5kXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmVxLmJvZHkuZGlzdHJpY3QgPSByZXN1bHQuZGlzdHJpY3Q7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHREaXN0cmljdCA9IGF3YWl0IERpc3RyaWN0TW9kZWwuZmluZEJ5SWQocmVzdWx0LmRpc3RyaWN0KTtcclxuICAgICAgICAgICAgICAgIHJlcS5ib2R5LnN0YXRlID0gcmVzdWx0RGlzdHJpY3Quc3RhdGU7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiJ1RhbHVrJyBmaWVsZCBpcyBub3QgdmFsaWRcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KSxcclxuXHJcbiAgICBjaGVjaygnemlwY29kZScpXHJcbiAgICAgICAgLm5vdEVtcHR5KCkud2l0aE1lc3NhZ2UoXCJUaGUgJ1ppcGNvZGUnIGZpZWxkIGlzIHJlcXVpcmVkXCIpXHJcbiAgICAgICAgLm1hdGNoZXMoL15bMS05XXsxfVswLTldezV9JC8pLndpdGhNZXNzYWdlKFwiVGhlICdaaXBjb2RlJyBmaWVsZCBpcyBub3QgdmFsaWRcIiksXHJcblxyXG4gICAgY2hlY2soJ2FkaGFyTm8nKVxyXG4gICAgICAgIC5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKFwiVGhlICdBZGhhciBOdW1iZXInIGZpZWxkIGlzIHJlcXVpcmVkXCIpXHJcbiAgICAgICAgLy8gLm1hdGNoZXMoL15bMi05XXsxfVswLTldezN9WzAtOV17NH1bMC05XXs0fSQvKS53aXRoTWVzc2FnZShcIlRoZSAnQWRoYXIgTnVtYmVyJyBmaWVsZCBpcyBub3QgdmFsaWRcIilcclxuICAgICAgICAuY3VzdG9tKGFzeW5jICh2YWx1ZSwgeyByZXEgfSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgY29uc3QgYm9keSA9IHJlcS5ib2R5O1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBVc2VyTW9kZWwuZmluZE9uZSh7IGFkaGFyTm86IHZhbHVlIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGJvZHkuX2lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5faWQgIT0gYm9keS5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQSB1c2VyIGFscmVhZHkgZXhpc3Qgd2l0aCB0aGlzIGFkaGFyIG51bWJlclwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkEgdXNlciBhbHJlYWR5IGV4aXN0IHdpdGggdGhpcyBhZGhhciBudW1iZXJcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSksXHJcblxyXG4gICAgY2hlY2soJ2FkaGFyQ2FyZFBob3RvJylcclxuICAgICAgICAuY3VzdG9tKCh2LCB7IHJlcSB9KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghcmVxLmJvZHkuX2lkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlcS5ib2R5LmFkaGFyQ2FyZFBob3RvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlICdBZGhhciBDYXJkIFBob3RvJyBmaWVsZCBpcyByZXF1aXJlZFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5vcHRpb25hbCgpXHJcbiAgICAgICAgLm1hdGNoZXMoL2RhdGE6aW1hZ2VcXC9bXjtdKztiYXNlNjRbXlwiXSsvKS53aXRoTWVzc2FnZShcIkFkaGFyIENhcmQgUGhvdG8gaXMgbm90IGFuIGltYWdlXCIpLFxyXG5cclxuICAgIGNoZWNrKCdwYW5ObycpXHJcbiAgICAgICAgLm5vdEVtcHR5KCkud2l0aE1lc3NhZ2UoXCJUaGUgJ1BhbiBOdW1iZXInIGZpZWxkIGlzIHJlcXVpcmVkXCIpXHJcbiAgICAgICAgLy8gLm1hdGNoZXMoL1tBLVpdezV9WzAtOV17NH1bQS1aXXsxfSQvKS53aXRoTWVzc2FnZShcIlRoZSAnUGFuIE51bWJlcicgZmllbGQgaXMgbm90IHZhbGlkXCIpXHJcbiAgICAgICAgLmN1c3RvbShhc3luYyAodmFsdWUsIHsgcmVxIH0pID0+IHtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGJvZHkgPSByZXEuYm9keTtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgVXNlck1vZGVsLmZpbmRPbmUoeyBwYW5ObzogdmFsdWUgfSk7XHJcblxyXG4gICAgICAgICAgICBpZiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYm9keS5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0Ll9pZCAhPSBib2R5Ll9pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBIHVzZXIgYWxyZWFkeSBleGlzdCB3aXRoIHRoaXMgcGFuIG51bWJlclwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkEgdXNlciBhbHJlYWR5IGV4aXN0IHdpdGggdGhpcyBwYW4gbnVtYmVyXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0pLFxyXG5cclxuICAgIGNoZWNrKCdwYW5DYXJkUGhvdG8nKVxyXG4gICAgICAgIC5jdXN0b20oKHYsIHsgcmVxIH0pID0+IHtcclxuICAgICAgICAgICAgaWYgKCFyZXEuYm9keS5faWQpIHtcclxuICAgICAgICAgICAgICAgIGlmICghcmVxLmJvZHkucGFuQ2FyZFBob3RvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlICdQYW4gQ2FyZCBQaG90bycgZmllbGQgaXMgcmVxdWlyZWRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAub3B0aW9uYWwoKVxyXG4gICAgICAgIC5tYXRjaGVzKC9kYXRhOmltYWdlXFwvW147XSs7YmFzZTY0W15cIl0rLykud2l0aE1lc3NhZ2UoXCJQYW4gQ2FyZCBQaG90byBpcyBub3QgYW4gaW1hZ2VcIiksXHJcblxyXG4gICAgY2hlY2soJ2lzQWN0aXZlJykuXHJcbiAgICAgICAgbm90RW1wdHkoKS53aXRoTWVzc2FnZShcIlRoZSAnYWN0aXZlJyBmaWVsZCBpcyByZXF1aXJlZFwiKVxyXG4gICAgICAgIC50b0Jvb2xlYW4oMSA/IHRydWUgOiBmYWxzZSksXHJcbl07XHJcbiJdfQ==