"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.locationValidation = exports.locationSearch = exports.customerValidation = exports.customerResetPasswordValidation = exports.customerLoginValidation = void 0;

var _import = require("../settings/import");

var _customer = _interopRequireDefault(require("../data-base/models/customer"));

var _customerLocation = _interopRequireDefault(require("../data-base/models/customerLocation"));

var _state = _interopRequireDefault(require("../data-base/models/state"));

var _district = _interopRequireDefault(require("../data-base/models/district"));

var _taluk = _interopRequireDefault(require("../data-base/models/taluk"));

var _helper = require("../utls/_helper");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const customerLoginValidation = [(0, _import.check)('email').notEmpty().withMessage("Email is required").isEmail().withMessage("Provide a valid email").custom(async v => {
  try {
    const r = await _customer.default.findOne({
      email: v,
      isDeleted: false
    });

    if (!r) {
      throw new Error("Data not found");
    }
  } catch (e) {
    throw new Error("Email is not registered");
  }
}), (0, _import.check)('password').notEmpty().withMessage("Password is required")];
exports.customerLoginValidation = customerLoginValidation;
const customerValidation = [(0, _import.check)('_id').optional().notEmpty().withMessage("Provide / Select a valid data").custom(async (v, {
  req
}) => {
  try {
    const search = {
      _id: v,
      isDeleted: false,
      state: global.state,
      district: global.district,
      taluk: global.taluk
    };
    (0, _helper.clearSearch)(search);
    const r = await _customer.default.findOne(search);

    if (!r) {
      throw new Error("Data not found");
    }
  } catch (e) {
    throw new Error("This data does not exit. Please check or refresh");
  }
}), (0, _import.check)('firstName').notEmpty().withMessage("The 'First Name' field is required").isString().withMessage("The 'First Name' field is not valid"), (0, _import.check)('lastName').notEmpty().withMessage("The 'Last Name' field is required").isString().withMessage("The 'Last Name' field is not valid"), (0, _import.check)('phoneNo').notEmpty().withMessage("The 'Phone Number' field is required").matches(/^[3-9]{1}[0-9]{9}$/).withMessage("The 'Phone Number' field is not valid").custom(async (value, {
  req
}) => {
  const body = req.body;
  const result = await _customer.default.findOne({
    isDeleted: false,
    phoneNo: value
  });

  if (result) {
    if (body._id) {
      if (result._id != body._id) {
        throw new Error("A customer already exist with this phone number");
      }
    } else {
      throw new Error("A customer already exist with this phone number");
    }
  }
}), (0, _import.check)('email').notEmpty().withMessage("The 'Email' field is required").isEmail().withMessage("The 'Email' field is not valid").custom(async (value, {
  req
}) => {
  const body = req.body;
  const result = await _customer.default.findOne({
    isDeleted: false,
    email: value
  });

  if (result) {
    if (body._id) {
      if (result._id != body._id) {
        throw new Error("A customer already exist with this email");
      }
    } else {
      throw new Error("A customer already exist with this email");
    }
  }
}), (0, _import.check)('password').custom((v, {
  req
}) => {
  if (!req.body._id) {
    if (!req.body.password) {
      throw new Error("The 'Password' field is required");
    }
  }

  return true;
}), (0, _import.check)('dob').notEmpty().withMessage("The 'Date of Birth' field is required").matches(/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])$/).withMessage("The 'Date of Birth' field is not valid"), (0, _import.check)('photo').custom((v, {
  req
}) => {
  if (!req.body._id) {
    if (!req.body.photo) {
      throw new Error("The 'Photo' field is required");
    }
  }

  return true;
}).optional().matches(/data:image\/[^;]+;base64[^"]+/).withMessage("Photo is not an image"), (0, _import.check)('address').notEmpty().withMessage("The 'Address' field is required").isString().withMessage("The 'Address' field is not valid"), (0, _import.check)('state').notEmpty().withMessage("The 'State' field is required") // .isString().withMessage("The 'State' field is not valid")
.custom(async value => {
  try {
    const result = await _state.default.findById(value);

    if (!result) {
      throw new Error("Data not found");
    }
  } catch (e) {
    throw new Error("State is not valid");
  }
}), (0, _import.check)('district').notEmpty().withMessage("The 'District' field is required").isString().withMessage("The 'District' field is not valid").custom(async value => {
  try {
    const result = await _district.default.findById(value);

    if (!result) {
      throw new Error("Data not found");
    }
  } catch (e) {
    throw new Error("District is not valid");
  }
}), (0, _import.check)('taluk').notEmpty().withMessage("The 'Taluk' field is required").isString().withMessage("The 'Taluk' field is not valid").custom(async value => {
  try {
    const result = await _taluk.default.findById(value);

    if (!result) {
      throw new Error("Data not found");
    }
  } catch (e) {
    throw new Error("Taluk is not valid");
  }
}), (0, _import.check)('zipcode').notEmpty().withMessage("The 'Zipcode' field is required").matches(/^[1-9]{1}[0-9]{5}$/).withMessage("The 'Zipcode' field is not valid"), (0, _import.check)('isActive').optional().notEmpty().withMessage("The 'active' field is required").toBoolean(1 ? true : false)];
exports.customerValidation = customerValidation;
const locationSearch = [(0, _import.check)('customer').notEmpty().withMessage("A customer is required").custom(async v => {
  try {
    const r = await _customer.default.findById(v);

    if (!r) {
      throw new Error("Customer is not valid");
    }
  } catch (e) {
    throw new Error("Customer is not valid");
  }
})];
exports.locationSearch = locationSearch;
const locationValidation = [(0, _import.check)('_id').optional().notEmpty().withMessage("Provide / Select a valid data").custom(async v => {
  try {
    const r = await _customerLocation.default.findById(v);

    if (!r) {
      throw new Error("Data not found");
    }
  } catch (e) {
    throw new Error("This data does not exit. Please check or refresh");
  }
}), (0, _import.check)('customer').notEmpty().withMessage("Select a customer").custom(async v => {
  try {
    const r = await _customer.default.findById(v);

    if (!r) {
      throw new Error("Customer not found");
    }
  } catch (e) {
    throw new Error("Customer does not exit. Please check or refresh");
  }
}), (0, _import.check)('name').notEmpty().withMessage("The 'Name' field is required").isString().withMessage("The 'Name' field is not valid"), (0, _import.check)('latlong').notEmpty().withMessage("The 'Latitude & Longitude' field is required").isLatLong().withMessage("The 'Latitude & Longitude' field is not valid")];
exports.locationValidation = locationValidation;
const customerResetPasswordValidation = [(0, _import.check)('password').notEmpty().withMessage("Fill the password"), (0, _import.check)('confirmPassword').notEmpty().withMessage("Fill the confirm password").custom(async (value, {
  req
}) => {
  const password = req.body.password;
  const confirmPassword = req.body.confirmPassword;

  if (password !== confirmPassword) {
    throw new Error("Both password does not match");
  }
})];
exports.customerResetPasswordValidation = customerResetPasswordValidation;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy92YWxpZGF0aW9uL0N1c3RvbWVyVmFsaWRhdGlvbnMuanMiXSwibmFtZXMiOlsiY3VzdG9tZXJMb2dpblZhbGlkYXRpb24iLCJub3RFbXB0eSIsIndpdGhNZXNzYWdlIiwiaXNFbWFpbCIsImN1c3RvbSIsInYiLCJyIiwiQ3VzdG9tZXJNb2RlbCIsImZpbmRPbmUiLCJlbWFpbCIsImlzRGVsZXRlZCIsIkVycm9yIiwiZSIsImN1c3RvbWVyVmFsaWRhdGlvbiIsIm9wdGlvbmFsIiwicmVxIiwic2VhcmNoIiwiX2lkIiwic3RhdGUiLCJnbG9iYWwiLCJkaXN0cmljdCIsInRhbHVrIiwiaXNTdHJpbmciLCJtYXRjaGVzIiwidmFsdWUiLCJib2R5IiwicmVzdWx0IiwicGhvbmVObyIsInBhc3N3b3JkIiwicGhvdG8iLCJTdGF0ZU1vZGVsIiwiZmluZEJ5SWQiLCJEaXN0cmljdE1vZGVsIiwiVGFsdWtNb2RlbCIsInRvQm9vbGVhbiIsImxvY2F0aW9uU2VhcmNoIiwibG9jYXRpb25WYWxpZGF0aW9uIiwiQ3VzdG9tZXJMb2NhdGlvbk1vZGVsIiwiaXNMYXRMb25nIiwiY3VzdG9tZXJSZXNldFBhc3N3b3JkVmFsaWRhdGlvbiIsImNvbmZpcm1QYXNzd29yZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBR08sTUFBTUEsdUJBQXVCLEdBQUcsQ0FDbkMsbUJBQU0sT0FBTixFQUNLQyxRQURMLEdBQ2dCQyxXQURoQixDQUM0QixtQkFENUIsRUFFS0MsT0FGTCxHQUVlRCxXQUZmLENBRTJCLHVCQUYzQixFQUdLRSxNQUhMLENBR1ksTUFBT0MsQ0FBUCxJQUFhO0FBQ2pCLE1BQUk7QUFDQSxVQUFNQyxDQUFDLEdBQUcsTUFBTUMsa0JBQWNDLE9BQWQsQ0FBc0I7QUFBRUMsTUFBQUEsS0FBSyxFQUFFSixDQUFUO0FBQVlLLE1BQUFBLFNBQVMsRUFBRTtBQUF2QixLQUF0QixDQUFo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O0FBd0NBLE1BQU1xQywrQkFBK0IsR0FBRyxDQUMzQyxtQkFBTSxVQUFOLEVBQ0t0QyxRQURMLEdBQ2dCQyxXQURoQixDQUM0QixtQkFENUIsQ0FEMkMsRUFHM0MsbUJBQU0saUJBQU4sRUFDS0QsUUFETCxHQUNnQkMsV0FEaEIsQ0FDNEIsMkJBRDVCLEVBRUtFLE1BRkwsQ0FFWSxPQUFPb0IsS0FBUCxFQUFjO0FBQUVULEVBQUFBO0FBQUYsQ0FBZCxLQUEwQjtBQUM5QixRQUFNYSxRQUFRLEdBQUdiLEdBQUcsQ0FBQ1UsSUFBSixDQUFTRyxRQUExQjtBQUNBLFFBQU1ZLGVBQWUsR0FBR3pCLEdBQUcsQ0FBQ1UsSUFBSixDQUFTZSxlQUFqQzs7QUFFQSxNQUFJWixRQUFRLEtBQUtZLGVBQWpCLEVBQWtDO0FBQzlCLFVBQU0sSUFBSTdCLEtBQUosQ0FBVSw4QkFBVixDQUFOO0FBQ0g7QUFDSixDQVRMLENBSDJDLENBQXhDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY2hlY2sgfSBmcm9tICcuLi9zZXR0aW5ncy9pbXBvcnQnO1xyXG5pbXBvcnQgQ3VzdG9tZXJNb2RlbCBmcm9tICcuLi9kYXRhLWJhc2UvbW9kZWxzL2N1c3RvbWVyJztcclxuaW1wb3J0IEN1c3RvbWVyTG9jYXRpb25Nb2RlbCBmcm9tICcuLi9kYXRhLWJhc2UvbW9kZWxzL2N1c3RvbWVyTG9jYXRpb24nO1xyXG5pbXBvcnQgU3RhdGVNb2RlbCBmcm9tICcuLi9kYXRhLWJhc2UvbW9kZWxzL3N0YXRlJztcclxuaW1wb3J0IERpc3RyaWN0TW9kZWwgZnJvbSAnLi4vZGF0YS1iYXNlL21vZGVscy9kaXN0cmljdCc7XHJcbmltcG9ydCBUYWx1a01vZGVsIGZyb20gJy4uL2RhdGEtYmFzZS9tb2RlbHMvdGFsdWsnO1xyXG5pbXBvcnQgeyBjbGVhclNlYXJjaCB9IGZyb20gJy4uL3V0bHMvX2hlbHBlcic7XHJcblxyXG5cclxuZXhwb3J0IGNvbnN0IGN1c3RvbWVyTG9naW5WYWxpZGF0aW9uID0gW1xyXG4gICAgY2hlY2soJ2VtYWlsJylcclxuICAgICAgICAubm90RW1wdHkoKS53aXRoTWVzc2FnZShcIkVtYWlsIGlzIHJlcXVpcmVkXCIpXHJcbiAgICAgICAgLmlzRW1haWwoKS53aXRoTWVzc2FnZShcIlByb3ZpZGUgYSB2YWxpZCBlbWFpbFwiKVxyXG4gICAgICAgIC5jdXN0b20oYXN5bmMgKHYpID0+IHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBhd2FpdCBDdXN0b21lck1vZGVsLmZpbmRPbmUoeyBlbWFpbDogdiwgaXNEZWxldGVkOiBmYWxzZSB9KTtcclxuICAgICAgICAgICAgICAgIGlmICghcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGEgbm90IGZvdW5kXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFbWFpbCBpcyBub3QgcmVnaXN0ZXJlZFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pLFxyXG5cclxuICAgIGNoZWNrKCdwYXNzd29yZCcpXHJcbiAgICAgICAgLm5vdEVtcHR5KCkud2l0aE1lc3NhZ2UoXCJQYXNzd29yZCBpcyByZXF1aXJlZFwiKSxcclxuXHJcbl07XHJcblxyXG5leHBvcnQgY29uc3QgY3VzdG9tZXJWYWxpZGF0aW9uID0gW1xyXG5cclxuICAgIGNoZWNrKCdfaWQnKVxyXG4gICAgICAgIC5vcHRpb25hbCgpXHJcbiAgICAgICAgLm5vdEVtcHR5KCkud2l0aE1lc3NhZ2UoXCJQcm92aWRlIC8gU2VsZWN0IGEgdmFsaWQgZGF0YVwiKVxyXG4gICAgICAgIC5jdXN0b20oYXN5bmMgKHYsIHsgcmVxIH0pID0+IHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNlYXJjaCA9IHsgX2lkOiB2LCBpc0RlbGV0ZWQ6IGZhbHNlLCBzdGF0ZTogZ2xvYmFsLnN0YXRlLCBkaXN0cmljdDogZ2xvYmFsLmRpc3RyaWN0LCB0YWx1azogZ2xvYmFsLnRhbHVrIH07XHJcbiAgICAgICAgICAgICAgICBjbGVhclNlYXJjaChzZWFyY2gpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgciA9IGF3YWl0IEN1c3RvbWVyTW9kZWwuZmluZE9uZShzZWFyY2gpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YSBub3QgZm91bmRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoaXMgZGF0YSBkb2VzIG5vdCBleGl0LiBQbGVhc2UgY2hlY2sgb3IgcmVmcmVzaFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pLFxyXG5cclxuICAgIGNoZWNrKCdmaXJzdE5hbWUnKVxyXG4gICAgICAgIC5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKFwiVGhlICdGaXJzdCBOYW1lJyBmaWVsZCBpcyByZXF1aXJlZFwiKVxyXG4gICAgICAgIC5pc1N0cmluZygpLndpdGhNZXNzYWdlKFwiVGhlICdGaXJzdCBOYW1lJyBmaWVsZCBpcyBub3QgdmFsaWRcIiksXHJcblxyXG4gICAgY2hlY2soJ2xhc3ROYW1lJylcclxuICAgICAgICAubm90RW1wdHkoKS53aXRoTWVzc2FnZShcIlRoZSAnTGFzdCBOYW1lJyBmaWVsZCBpcyByZXF1aXJlZFwiKVxyXG4gICAgICAgIC5pc1N0cmluZygpLndpdGhNZXNzYWdlKFwiVGhlICdMYXN0IE5hbWUnIGZpZWxkIGlzIG5vdCB2YWxpZFwiKSxcclxuXHJcbiAgICBjaGVjaygncGhvbmVObycpXHJcbiAgICAgICAgLm5vdEVtcHR5KCkud2l0aE1lc3NhZ2UoXCJUaGUgJ1Bob25lIE51bWJlcicgZmllbGQgaXMgcmVxdWlyZWRcIilcclxuICAgICAgICAubWF0Y2hlcygvXlszLTldezF9WzAtOV17OX0kLykud2l0aE1lc3NhZ2UoXCJUaGUgJ1Bob25lIE51bWJlcicgZmllbGQgaXMgbm90IHZhbGlkXCIpXHJcbiAgICAgICAgLmN1c3RvbShhc3luYyAodmFsdWUsIHsgcmVxIH0pID0+IHtcclxuICAgICAgICAgICAgY29uc3QgYm9keSA9IHJlcS5ib2R5O1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBDdXN0b21lck1vZGVsLmZpbmRPbmUoeyBpc0RlbGV0ZWQ6IGZhbHNlLCBwaG9uZU5vOiB2YWx1ZSB9KTtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGJvZHkuX2lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5faWQgIT0gYm9keS5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQSBjdXN0b21lciBhbHJlYWR5IGV4aXN0IHdpdGggdGhpcyBwaG9uZSBudW1iZXJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBIGN1c3RvbWVyIGFscmVhZHkgZXhpc3Qgd2l0aCB0aGlzIHBob25lIG51bWJlclwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pLFxyXG5cclxuICAgIGNoZWNrKCdlbWFpbCcpXHJcbiAgICAgICAgLm5vdEVtcHR5KCkud2l0aE1lc3NhZ2UoXCJUaGUgJ0VtYWlsJyBmaWVsZCBpcyByZXF1aXJlZFwiKVxyXG4gICAgICAgIC5pc0VtYWlsKCkud2l0aE1lc3NhZ2UoXCJUaGUgJ0VtYWlsJyBmaWVsZCBpcyBub3QgdmFsaWRcIilcclxuICAgICAgICAuY3VzdG9tKGFzeW5jICh2YWx1ZSwgeyByZXEgfSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBib2R5ID0gcmVxLmJvZHk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEN1c3RvbWVyTW9kZWwuZmluZE9uZSh7IGlzRGVsZXRlZDogZmFsc2UsIGVtYWlsOiB2YWx1ZSB9KTtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGJvZHkuX2lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5faWQgIT0gYm9keS5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQSBjdXN0b21lciBhbHJlYWR5IGV4aXN0IHdpdGggdGhpcyBlbWFpbFwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkEgY3VzdG9tZXIgYWxyZWFkeSBleGlzdCB3aXRoIHRoaXMgZW1haWxcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KSxcclxuXHJcbiAgICBjaGVjaygncGFzc3dvcmQnKVxyXG4gICAgICAgIC5jdXN0b20oKHYsIHsgcmVxIH0pID0+IHtcclxuICAgICAgICAgICAgaWYgKCFyZXEuYm9keS5faWQpIHtcclxuICAgICAgICAgICAgICAgIGlmICghcmVxLmJvZHkucGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgJ1Bhc3N3b3JkJyBmaWVsZCBpcyByZXF1aXJlZFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9KSxcclxuXHJcbiAgICBjaGVjaygnZG9iJylcclxuICAgICAgICAubm90RW1wdHkoKS53aXRoTWVzc2FnZShcIlRoZSAnRGF0ZSBvZiBCaXJ0aCcgZmllbGQgaXMgcmVxdWlyZWRcIilcclxuICAgICAgICAubWF0Y2hlcygvXlxcZHs0fS0oMFsxLTldfDFbMC0yXSktKDBbMS05XXxbMTJdWzAtOV18M1swMV0pJC8pLndpdGhNZXNzYWdlKFwiVGhlICdEYXRlIG9mIEJpcnRoJyBmaWVsZCBpcyBub3QgdmFsaWRcIiksXHJcblxyXG4gICAgY2hlY2soJ3Bob3RvJylcclxuICAgICAgICAuY3VzdG9tKCh2LCB7IHJlcSB9KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghcmVxLmJvZHkuX2lkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlcS5ib2R5LnBob3RvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlICdQaG90bycgZmllbGQgaXMgcmVxdWlyZWRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAub3B0aW9uYWwoKVxyXG4gICAgICAgIC5tYXRjaGVzKC9kYXRhOmltYWdlXFwvW147XSs7YmFzZTY0W15cIl0rLykud2l0aE1lc3NhZ2UoXCJQaG90byBpcyBub3QgYW4gaW1hZ2VcIiksXHJcblxyXG4gICAgY2hlY2soJ2FkZHJlc3MnKVxyXG4gICAgICAgIC5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKFwiVGhlICdBZGRyZXNzJyBmaWVsZCBpcyByZXF1aXJlZFwiKVxyXG4gICAgICAgIC5pc1N0cmluZygpLndpdGhNZXNzYWdlKFwiVGhlICdBZGRyZXNzJyBmaWVsZCBpcyBub3QgdmFsaWRcIiksXHJcblxyXG4gICAgY2hlY2soJ3N0YXRlJylcclxuICAgICAgICAubm90RW1wdHkoKS53aXRoTWVzc2FnZShcIlRoZSAnU3RhdGUnIGZpZWxkIGlzIHJlcXVpcmVkXCIpXHJcbiAgICAgICAgLy8gLmlzU3RyaW5nKCkud2l0aE1lc3NhZ2UoXCJUaGUgJ1N0YXRlJyBmaWVsZCBpcyBub3QgdmFsaWRcIilcclxuICAgICAgICAuY3VzdG9tKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgU3RhdGVNb2RlbC5maW5kQnlJZCh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGEgbm90IGZvdW5kXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTdGF0ZSBpcyBub3QgdmFsaWRcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KSxcclxuXHJcbiAgICBjaGVjaygnZGlzdHJpY3QnKVxyXG4gICAgICAgIC5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKFwiVGhlICdEaXN0cmljdCcgZmllbGQgaXMgcmVxdWlyZWRcIilcclxuICAgICAgICAuaXNTdHJpbmcoKS53aXRoTWVzc2FnZShcIlRoZSAnRGlzdHJpY3QnIGZpZWxkIGlzIG5vdCB2YWxpZFwiKVxyXG4gICAgICAgIC5jdXN0b20oYXN5bmMgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBEaXN0cmljdE1vZGVsLmZpbmRCeUlkKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGlmICghcmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YSBub3QgZm91bmRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRpc3RyaWN0IGlzIG5vdCB2YWxpZFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pLFxyXG5cclxuICAgIGNoZWNrKCd0YWx1aycpXHJcbiAgICAgICAgLm5vdEVtcHR5KCkud2l0aE1lc3NhZ2UoXCJUaGUgJ1RhbHVrJyBmaWVsZCBpcyByZXF1aXJlZFwiKVxyXG4gICAgICAgIC5pc1N0cmluZygpLndpdGhNZXNzYWdlKFwiVGhlICdUYWx1aycgZmllbGQgaXMgbm90IHZhbGlkXCIpXHJcbiAgICAgICAgLmN1c3RvbShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFRhbHVrTW9kZWwuZmluZEJ5SWQodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhIG5vdCBmb3VuZFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGFsdWsgaXMgbm90IHZhbGlkXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSksXHJcblxyXG4gICAgY2hlY2soJ3ppcGNvZGUnKVxyXG4gICAgICAgIC5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKFwiVGhlICdaaXBjb2RlJyBmaWVsZCBpcyByZXF1aXJlZFwiKVxyXG4gICAgICAgIC5tYXRjaGVzKC9eWzEtOV17MX1bMC05XXs1fSQvKS53aXRoTWVzc2FnZShcIlRoZSAnWmlwY29kZScgZmllbGQgaXMgbm90IHZhbGlkXCIpLFxyXG5cclxuICAgIGNoZWNrKCdpc0FjdGl2ZScpXHJcbiAgICAgICAgLm9wdGlvbmFsKClcclxuICAgICAgICAubm90RW1wdHkoKS53aXRoTWVzc2FnZShcIlRoZSAnYWN0aXZlJyBmaWVsZCBpcyByZXF1aXJlZFwiKVxyXG4gICAgICAgIC50b0Jvb2xlYW4oMSA/IHRydWUgOiBmYWxzZSksXHJcbl07XHJcblxyXG5leHBvcnQgY29uc3QgbG9jYXRpb25TZWFyY2ggPSBbXHJcbiAgICBjaGVjaygnY3VzdG9tZXInKVxyXG4gICAgICAgIC5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKFwiQSBjdXN0b21lciBpcyByZXF1aXJlZFwiKVxyXG4gICAgICAgIC5jdXN0b20oYXN5bmMgKHYpID0+IHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBhd2FpdCBDdXN0b21lck1vZGVsLmZpbmRCeUlkKHYpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ3VzdG9tZXIgaXMgbm90IHZhbGlkXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDdXN0b21lciBpcyBub3QgdmFsaWRcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KSxcclxuXTtcclxuXHJcbmV4cG9ydCBjb25zdCBsb2NhdGlvblZhbGlkYXRpb24gPSBbXHJcblxyXG4gICAgY2hlY2soJ19pZCcpXHJcbiAgICAgICAgLm9wdGlvbmFsKClcclxuICAgICAgICAubm90RW1wdHkoKS53aXRoTWVzc2FnZShcIlByb3ZpZGUgLyBTZWxlY3QgYSB2YWxpZCBkYXRhXCIpXHJcbiAgICAgICAgLmN1c3RvbShhc3luYyAodikgPT4ge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgciA9IGF3YWl0IEN1c3RvbWVyTG9jYXRpb25Nb2RlbC5maW5kQnlJZCh2KTtcclxuICAgICAgICAgICAgICAgIGlmICghcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGEgbm90IGZvdW5kXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGlzIGRhdGEgZG9lcyBub3QgZXhpdC4gUGxlYXNlIGNoZWNrIG9yIHJlZnJlc2hcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KSxcclxuXHJcbiAgICBjaGVjaygnY3VzdG9tZXInKVxyXG4gICAgICAgIC5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKFwiU2VsZWN0IGEgY3VzdG9tZXJcIilcclxuICAgICAgICAuY3VzdG9tKGFzeW5jICh2KSA9PiB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByID0gYXdhaXQgQ3VzdG9tZXJNb2RlbC5maW5kQnlJZCh2KTtcclxuICAgICAgICAgICAgICAgIGlmICghcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkN1c3RvbWVyIG5vdCBmb3VuZFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ3VzdG9tZXIgZG9lcyBub3QgZXhpdC4gUGxlYXNlIGNoZWNrIG9yIHJlZnJlc2hcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KSxcclxuXHJcbiAgICBjaGVjaygnbmFtZScpXHJcbiAgICAgICAgLm5vdEVtcHR5KCkud2l0aE1lc3NhZ2UoXCJUaGUgJ05hbWUnIGZpZWxkIGlzIHJlcXVpcmVkXCIpXHJcbiAgICAgICAgLmlzU3RyaW5nKCkud2l0aE1lc3NhZ2UoXCJUaGUgJ05hbWUnIGZpZWxkIGlzIG5vdCB2YWxpZFwiKSxcclxuXHJcbiAgICBjaGVjaygnbGF0bG9uZycpXHJcbiAgICAgICAgLm5vdEVtcHR5KCkud2l0aE1lc3NhZ2UoXCJUaGUgJ0xhdGl0dWRlICYgTG9uZ2l0dWRlJyBmaWVsZCBpcyByZXF1aXJlZFwiKVxyXG4gICAgICAgIC5pc0xhdExvbmcoKS53aXRoTWVzc2FnZShcIlRoZSAnTGF0aXR1ZGUgJiBMb25naXR1ZGUnIGZpZWxkIGlzIG5vdCB2YWxpZFwiKSxcclxuXHJcbl07XHJcblxyXG5cclxuZXhwb3J0IGNvbnN0IGN1c3RvbWVyUmVzZXRQYXNzd29yZFZhbGlkYXRpb24gPSBbXHJcbiAgICBjaGVjaygncGFzc3dvcmQnKVxyXG4gICAgICAgIC5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKFwiRmlsbCB0aGUgcGFzc3dvcmRcIiksXHJcbiAgICBjaGVjaygnY29uZmlybVBhc3N3b3JkJylcclxuICAgICAgICAubm90RW1wdHkoKS53aXRoTWVzc2FnZShcIkZpbGwgdGhlIGNvbmZpcm0gcGFzc3dvcmRcIilcclxuICAgICAgICAuY3VzdG9tKGFzeW5jICh2YWx1ZSwgeyByZXEgfSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBwYXNzd29yZCA9IHJlcS5ib2R5LnBhc3N3b3JkO1xyXG4gICAgICAgICAgICBjb25zdCBjb25maXJtUGFzc3dvcmQgPSByZXEuYm9keS5jb25maXJtUGFzc3dvcmQ7XHJcblxyXG4gICAgICAgICAgICBpZiAocGFzc3dvcmQgIT09IGNvbmZpcm1QYXNzd29yZCkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQm90aCBwYXNzd29yZCBkb2VzIG5vdCBtYXRjaFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pLFxyXG5dO1xyXG4iXX0=